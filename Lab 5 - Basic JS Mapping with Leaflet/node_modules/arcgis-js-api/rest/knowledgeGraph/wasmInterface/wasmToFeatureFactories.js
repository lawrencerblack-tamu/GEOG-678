/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../ProtoFeatureCollection","./WasmDataModelWrapperInterfaces","./WasmSerializedLayerData"],(function(e,t,s,a){"use strict";function o(e){const a=new t.ProtoFeatureCollection;a.version=e.version;const o=e.get_query_result();if(0!==o.results_type.value)throw new Error("Got a non-feature collection type");const d=o.get_feature_result(),u=a.queryResult.featureResult;u.objectIdFieldName=d.objectid_field_name,u.exceededTransferLimit=d.exceeded_transfer_limit,u.hasM=d.has_m,u.hasZ=d.has_z,u.geometryType=s.EsriGeometryTypes[d.geometry_type.value],u.globalIdFieldName=d.globalid_field_name,u.geohashFieldName=d.geohash_field_name;const c=u.uniqueIdField,m=d.unique_id_field;c.name=m.name,c.isSystemMaintained=m.isSystemMaintained;const f=u.geometryProperties,y=d.geometry_properties;f.shapeAreaFieldName=y.shapeAreaFieldName,f.shapeLengthFieldName=y.shapeLengthFieldName,f.units=y.units;const g=u.spatialReference,p=d.spatial_reference;g.wkid=p.wkid,g.latestWkid=p.latestWkid,g.vcsWkid=p.vcsWkid,g.latestVcsWkid=p.latestVcsWkid,g.wkt=p.wkt,u.transform=l(d.transform);const _=u.fields,h=u.fieldNameToAttributeIndexMap,T=d.fields,F=T.size();for(let t=0;t<F;t++){const e=T.get(t),s=n(e);_.push(s),h[s.name]=t,e.delete()}T.delete();const w=u.values,v=d.values_count();for(let t=0;t<v;t++)w.push(d.get_value_at(t));const S=u.features,b=d.features,z=b.size();if(z>0)for(const s of t.ProtoInboundFeatureCollectionRequiredAttributes)if(void 0===h[s])throw new Error(`Feature collection missing required attribute: ${s}`);for(let s=0;s<z;s++){const e=new t.Feature,a=b.get(s),o=e.attributes,n=a.attributes_count();for(let t=0;t<n;t++)o.push(a.get_attribute_at(t));const i=a.get_compressed_geometry();i&&(e.compressedGeometry=r(i),e.centroid=r(a.get_centroid()));const l=e.aggregateGeometries,d=a.aggregate_geometries,u=d.size();for(let t=0;t<u;t++){const e=d.get(t),s=r(e);l.push(s),e.delete()}d.delete(),S.push(e),a.delete()}b.delete();const q=u.geometryFields,k=d.geometry_fields,W=k.size();for(let t=0;t<W;t++){const e=k.get(t),s=i(e);q.push(s),e.delete()}return k.delete(),a}function r(e){const a=new t.CompressedGeometry;a.geometryType=s.EsriGeometryTypes[e.geometry_type.value];const o=[],r=[];for(let t=0;t<e.lengths.length;t++)o.push(e.lengths[t]);for(let t=0;t<e.coords.length;t++)r.push(e.coords[t]);return a.lengths=o,a.coords=r,a}function n(e){const o=new t.Field;return o.name=e.name,o.alias=e.alias,o.fieldType=s.EsriFieldTypes[e.field_type.value],o.sqlType=a.SqlTypeCode[e.sql_type.value],o.domain=e.domain,o.defaultValue=e.default_value,o}function i(e){const t=n(e);return t.geometryType=s.EsriGeometryTypes[e.geometry_type.value],t}function l(e){const s=new t.Transform;s.quantizeOriginPosition=a.WasmQuantizeOriginPositionTypeCode[e.quantizeOriginPosition.value];const o=s.scale,r=e.scale;o.xScale=r.xScale,o.yScale=r.yScale,o.mScale=r.mScale,o.zScale=r.zScale;const n=s.translate,i=e.translate;return n.xTranslate=i.xTranslate,n.yTranslate=i.yTranslate,n.mTranslate=i.mTranslate,n.zTranslate=i.zTranslate,s}e.wasmToCompressedGeometry=r,e.wasmToField=n,e.wasmToGeometryField=i,e.wasmToProtoFeatureCollection=o,e.wasmToTransform=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
