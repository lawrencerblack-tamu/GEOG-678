/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../request","../../core/Error","../../core/urlUtils"],(function(e,t,r,o){"use strict";async function s(e,t={},r){await e.load(r);const s=o.join(e.itemUrl,"resources"),{start:n=1,num:a=10,sortOrder:c="asc",sortField:i="resource"}=t,l={query:{start:n,num:a,sortOrder:c,sortField:i,token:e.apiKey},signal:r?.signal},u=await e.portal.request(s,l);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map((({created:t,size:r,resource:o})=>({created:new Date(t),size:r,resource:e.resourceFromPath(o)})))}}async function n(e,t,s,n){const a=new Map;for(const{resource:o,content:l,compress:u,access:p}of t){if(!o.hasPath())throw new r(`portal-item-resource-${s}:invalid-path`,"Resource does not have a valid path");const[e,t]=i(o.path),n=`${e}/${u??""}/${p??""}`;a.has(n)||a.set(n,{prefix:e,compress:u,access:p,files:[]});a.get(n).files.push({fileName:t,content:l})}await e.load(n);const c=o.join(e.userItemUrl,"add"===s?"addResources":"updateResources");for(const{prefix:r,compress:o,access:i,files:l}of a.values()){const t=25;for(let s=0;s<l.length;s+=t){const a=l.slice(s,s+t),u=new FormData;r&&"."!==r&&u.append("resourcesPrefix",r),o&&u.append("compress","true"),i&&u.append("access",i);let p=0;for(const{fileName:e,content:t}of a)u.append("file"+ ++p,t,e);u.append("f","json"),await e.portal.request(c,{method:"post",body:u,signal:n?.signal})}}}async function a(e,t,s){if(!t.hasPath())throw new r("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const n=o.join(e.userItemUrl,"removeResources");await e.portal.request(n,{method:"post",query:{resource:t.path},signal:s?.signal}),t.portalItem=null}async function c(e,t){await e.load(t);const r=o.join(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t?.signal})}function i(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function l(e){const[t,r]=u(e),[o,s]=i(t);return[o,s,r]}function u(e){const t=o.getPathExtension(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function p(e){if("blob"===e.type)return e.blob;if("json"===e.type)return new Blob([e.jsonString],{type:"application/json"});return(await t(e.url,{responseType:"blob"})).data}function f(e,t){if(!e.hasPath())return null;const[r,,s]=l(e.path);return e.portalItem.resourceFromPath(o.join(r,t+s))}function d(e,t){if(!e.hasPath())return null;const[r,,s]=l(e.path);return e.portalItem.resourceFromPath(o.join(r,t+s))}e.addOrUpdateResources=n,e.contentToBlob=p,e.fetchResources=s,e.getSiblingOfSameType=f,e.getSiblingOfSameTypeI=d,e.removeAllResources=c,e.removeResource=a,e.splitPrefixFileNameAndExtension=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
