/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../layers/support/associatedFeatureServiceUtils"],(function(e,t){"use strict";function a(e){const t={id:e.id,name:e.name};return"Oriented Imagery Layer"===e.type&&(t.layerType="OrientedImageryLayer"),t}async function r(e,t,r){if(null==e?.layers||null==e?.tables){const l=await r.fetchServiceMetadata(t,{customParameters:s(e)?.customParameters});(e=e||{}).layers=e.layers||l?.layers?.map(a),e.tables=e.tables||l?.tables?.map(a)}return e}function l(e){const{layers:t,tables:a}=e;return t?.length?t[0].id:a?.length?a[0].id:null}function s(e){if(!e)return null;const{layers:t,tables:a}=e;return t?.length?t[0]:a?.length?a[0]:null}function n(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function u(e){const t=[];return e?.layers?.forEach((e=>{"SubtypeGroupLayer"===e.layerType&&t.push(e.id)})),t}function i(e){return e?.layers?.filter((({layerType:e})=>"OrientedImageryLayer"===e)).map((({id:e})=>e))}function c(e){return e?.layers?.filter((({layerType:e})=>"CatalogLayer"===e)).map((({id:e})=>e))}async function y(e,r,l){if(!e?.url)return r??{};if(r??={},!r.layers){const t=await l.fetchServiceMetadata(e.url);r.layers=t.layers?.map(a)}const{serverUrl:n,portalItem:u}=await t.findAssociatedFeatureService(e.url,{sceneLayerItem:e,customParameters:s(r)?.customParameters}).catch((()=>({serverUrl:null,portalItem:null})));if(null==n)return r.tables=[],r;if(!r.tables&&u){const e=await u.fetchData();if(e?.tables)r.tables=e.tables.map(a);else{const t=await l.fetchServiceMetadata(n,{customParameters:s(e)?.customParameters});r.tables=t?.tables?.map(a)}}if(r.tables)for(const t of r.tables)t.url=`${n}/${t.id}`;return r}e.createSublayerData=a,e.getCatalogLayerIds=c,e.getFirstLayerOrTable=s,e.getFirstLayerOrTableId=l,e.getNumLayersAndTables=n,e.getOrientedImageryLayerIds=i,e.getSubtypeGroupLayerIds=u,e.populateSceneServiceItemData=y,e.preprocessFSItemData=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
