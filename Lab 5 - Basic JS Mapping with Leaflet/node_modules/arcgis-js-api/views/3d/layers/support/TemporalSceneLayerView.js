/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../layers/graphics/data/timeSupport","../../../../layers/support/commonProperties","../../../../layers/support/FeatureFilter","../i3s/I3SUtil"],(function(e,t,r,i,n,s,l,o,u,a,c){"use strict";const p=e=>{let i=class extends e{constructor(){super(...arguments),this.timeExtent=null}get mergedFilter(){const{filter:e,timeExtent:t}=this;if(null==t)return e;const r=e?.clone()??new a;return null!=t&&(r.timeExtent=r.timeExtent?.intersection(t)??t),r}getTimeFilterDependencies(){const{timeInfo:e}=this.i3slayer;if(null==e)return[];const{startField:t,endField:r}=e;return[t,r]}addTimeFilter(e,t){if(null==t)return;const{timeInfo:r}=this.i3slayer;if(null==r)return;const{startField:i,endField:n,useTime:s}=r;if(!s||null==i&&null==n)return;const l=r.toJSON(),o=t.toJSON();e.push(((e,t)=>this._timeFilter(e,t,l,o)))}_timeFilter(e,t,r,i){const n=t.attributeInfo?.attributeData;if(null==n)return;const{startTimeField:s,endTimeField:l}=r;if(!!(null!=s&&null==n[s]||null!=l&&null==n[l]))return;const u=o.getTimeOperator(r,i,new d(n));if(null==u)return;const{featureIds:a}=t;c.filterInPlace(e,a,u)}};return t.__decorate([r.property(u.combinedViewLayerTimeExtentProperty)],i.prototype,"timeExtent",void 0),t.__decorate([r.property()],i.prototype,"mergedFilter",null),i=t.__decorate([l.subclass("esri.views.3d.layers.support.TemporalSceneLayerView")],i),i};class d{constructor(e){this.attributeData=e}getAttribute(e,t){return c.getCachedAttributeValue(this.attributeData[t],e)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}}e.TemporalSceneLayerView=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
