/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/plane","../../../ViewingMode"],(function(e,t,o,r,a,c,s,n,l,i,m){"use strict";function d(e,t,r,a,c=1){if(r.isGeographic&&a===m.ViewingMode.Global){const e=l.newDoubleArray(t.length),o=t.length,a=s.getReferenceEllipsoid(r);for(let r=0;r<o;r+=3)n.lonLatToWebMercatorComparable(t,r,e,r,a);t=e}o.set(p,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<t.length;o+=3)p[0]=Math.min(p[0],t[o]),p[1]=Math.min(p[1],t[o+1]);const i=p[0]%c,d=p[1]%c,I=p[0]-i,f=p[1]-d;for(let o=0;o<t.length;o+=3){const r=o/3*4;e[r]=(t[o]-I)/c,e[r+1]=(t[o+1]-f)/c,e[r+2]=I/c,e[r+3]=f/c}}function I(e,t,r,c,s=1){a.set(b,1,0,0),a.set(N,0,1,0),a.set(h,0,0,1),P(f,r),i.fromArray(u,r)&&V(u,b,N,h,c,f),o.set(p,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o.set(M,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let o=0;o<r.length;o+=3){a.set(g,r[o],r[o+1],r[o+2]);const e=a.dot(b,g),t=a.dot(N,g);p[0]=Math.min(p[0],e),p[1]=Math.min(p[1],t),M[0]=Math.max(M[0],e),M[1]=Math.max(M[1],t)}const n=a.dot(h,f);_(T,p[0],p[1],n,b,N,h),_(y,M[0],p[1],n,b,N,h),_(A,p[0],M[1],n,b,N,h),a.subtract(y,y,T),a.scale(y,y,.5),a.subtract(A,A,T),a.scale(A,A,.5),a.add(T,T,y),a.add(T,T,A);const l=p[0]%s,m=p[1]%s,d=p[0]-l,I=p[1]-m;for(let o=0;o<r.length;o+=3){a.set(g,r[o],r[o+1],r[o+2]);const c=o/3,n=4*c;e[n]=(a.dot(b,g)-d)/s,e[n+1]=(a.dot(N,g)-I)/s,e[n+2]=d/s,e[n+3]=I/s;const l=9*c;for(let e=0;e<3;e++)t[l+e]=T[e],t[l+e+3]=y[e],t[l+e+6]=A[e]}}const f=c.create(),g=c.create(),u=i.create(),b=c.create(),N=c.create(),h=c.create(),p=r.create(),M=r.create(),T=c.create(),y=c.create(),A=c.create();function V(e,t,o,r,c,s){null!=c?(c.basisMatrixAtPosition(s,E),a.set(x,E[0],E[1],E[2]),a.set(S,E[4],E[5],E[6]),a.set(F,E[8],E[9],E[10])):(a.set(x,1,0,0),a.set(S,0,1,0),a.set(F,0,0,1));const n=i.getNormal(e);a.dot(n,F)<0&&a.scale(n,n,-1),a.copy(r,n);const l=a.dot(n,S),m=a.dot(n,x);Math.abs(l)>Math.abs(m)?(a.scaleAndAdd(t,x,n,-m),a.normalize(t,t),a.cross(o,t,n),a.normalize(o,o),a.scale(o,o,-1)):(a.scaleAndAdd(o,S,n,-l),a.normalize(o,o),a.cross(t,o,n),a.normalize(t,t))}const E=t.create(),x=c.create(),S=c.create(),F=c.create();function P(e,t){a.set(Y,0,0,0);for(let o=0;o<t.length-3;o+=3)Y[0]+=t[o],Y[1]+=t[o+1],Y[2]+=t[o+2];a.scale(e,Y,1/(t.length/3-1))}const Y=c.create();function _(e,t,o,r,c,s,n){a.set(e,t*c[0]+o*s[0]+r*n[0],t*c[1]+o*s[1]+r*n[1],t*c[2]+o*s[2]+r*n[2])}e.createMapSpaceUVCoords=I,e.createMapSpaceUVCoordsDraped=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
