/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../layers/ILyr3DWasmPerSceneView","../../../libs/lyr3d/Lyr3DModule"],(function(s,t,e){"use strict";let r,n;async function i(s){if(await u(),s.inputs.length<1)return{result:{status:t.Lyr3DWasmWorkerOutputStatus.Failed,error:"",jobDescJson:"",data:new Uint8Array(0),missingInputUrls:[]},transferList:[]};const e={ptrs:[],sizes:[]};for(const t of s.inputs){const s=n._malloc(t.byteLength);new Uint8Array(n.HEAPU8.buffer,s,t.byteLength).set(new Uint8Array(t)),e.ptrs.push(s),e.sizes.push(t.byteLength)}const r=n.process(s.jobDescJson,e,s.isMissingResourceCase),i=r.status===t.Lyr3DWasmWorkerOutputStatus.Succeeded&&r.data,o=r.status===t.Lyr3DWasmWorkerOutputStatus.MissingInputs&&r.missingInputUrls.length>0;if(i){const s=r.data.slice();r.data=s}else o&&(r.jobDescJson=r.jobDescJson.slice(0),r.originalInputs=s.inputs);for(let t=0;t<e.ptrs.length;++t)n._free(e.ptrs[t]);const a=[];if(i)a.push(r.data.buffer);else if(o)for(const t of s.inputs)a.push(t);return{result:r,transferList:a}}function o(){n&&(n.uninitialize_lyr3d_worker_wasm(),n=null)}function u(){return n?Promise.resolve():(r||(r=e.loadLyr3DWorkerWASM().then((s=>{n=s,n.initialize_lyr3d_worker_wasm(),r=null}))),r)}s.destroyWasm=o,s.initialize=u,s.process=i,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));
