/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","./VisualElement","../../webgl-engine/lib/Object3D","../../webgl-engine/lib/UpdatePolicy","../../webgl-engine/lib/WebGLLayer"],(function(e,s,t,r,i,o,a){"use strict";class c extends r.VisualElement{constructor(e){super(e),this._resources=null,this._transform=t.create()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){s.copy(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,s=this.view._stage;s.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,s.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const s=new a.WebGLLayer(e,{pickable:!1,updatePolicy:o.UpdatePolicy.SYNC}),t=new i.Object3D({castShadow:!1});t.transformation=this._transform,this.createExternalResources(),this.createGeometries(t),e.addMany(t.geometries),this.forEachExternalMaterial((s=>e.add(s))),e.add(t),s.add(t),t.visible=this.visible,this._resources={layer:s,object:t}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((s=>{e.remove(s)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}e.Object3DVisualElement=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
