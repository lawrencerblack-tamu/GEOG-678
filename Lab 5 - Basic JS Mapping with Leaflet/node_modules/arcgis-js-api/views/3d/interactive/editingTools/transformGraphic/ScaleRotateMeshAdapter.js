/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/axisAngleDegrees","./undoRecords"],(function(e,t,r,a,o,n,i,s,c,l,p,g){"use strict";e.ScaleRotateMeshAdapter=class extends r{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([o.when((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),o.sync),o.when((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),o.sync)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry.transform;if(null==e)return this._interactionState?.angle??0;const t=p.axis(e.rotation)[2];return Math.abs(t)>.999999?a.deg2rad(p.angle(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new h({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return g.createGraphicGeometryUndoRecord(this.graphic)}_updateMeshRotation(e){const{angle:t,previousAngle:r}=e;e.previousAngle=t;const o=a.rad2deg(t-r),{geometry:n}=this,i=n.anchor;n.rotate(0,0,o,{origin:i}),n.transform&&n.vertexSpace.origin?this.graphic.notifyMeshTransformChanged():this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const{scale:t,previousScale:r}=e;e.previousScale=t;const{geometry:a}=this,o=t/r,n=this.geometry.anchor;this.geometry.scale(o,{origin:n}),a.transform&&a.vertexSpace.origin?this.graphic.notifyMeshTransformChanged():this.graphic.notifyGeometryChanged()}},t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"graphic",void 0),t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"geometry",void 0),t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"viewingMode",void 0),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"initialAngle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"angle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"angleClockwise",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngleClockwise",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"scale",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"_interactionState",void 0),e.ScaleRotateMeshAdapter=t.__decorate([l.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],e.ScaleRotateMeshAdapter);let h=class extends r{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};t.__decorate([n.property()],h.prototype,"angle",void 0),t.__decorate([n.property()],h.prototype,"initialAngle",void 0),t.__decorate([n.property()],h.prototype,"previousAngle",void 0),t.__decorate([n.property()],h.prototype,"previousScale",void 0),t.__decorate([n.property()],h.prototype,"scale",void 0),t.__decorate([n.property()],h.prototype,"state",null),h=t.__decorate([l.subclass("InteractionState")],h),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
