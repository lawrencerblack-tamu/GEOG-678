/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass"],(function(e,t,o,l,r,i,a,n,c,s){"use strict";function p(e){return-l.deg2rad(e)}e.ScaleRotateObjectSymbol3DAdapter=class extends o{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(r.when((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),r.sync))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?p(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),o=this._graphicSymbol;if(null==t||null==o||"point-3d"!==o.type)return null;const l=t.getSymbolLayerSize(o,e);if("size"in l&&null!=l.size)return l.size;const r=this.sizeAxis;return!("width"in l)||null==l.width||null!=r&&"width"!==r&&"all"!==r&&"width-and-depth"!==r?!("depth"in l)||null==e.depth||null!=r&&"depth"!==r&&"all"!==r&&"width-and-depth"!==r?!("height"in l)||null==e.height||null!=r&&"height"!==r&&"all"!==r?null:l.height:l.depth:l.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}get _graphicSymbol(){return null!=this.graphic?.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return y;const o=e.symbolLayers.map((o=>"object"===o.type?t.getSymbolLayerSize(e,o):null)).toArray(),l=e.clone(),r=this.angle,i=new h({originalSymbol:l,angle:r,initialSizes:o});this._interactionState=i;const a=()=>{this._interactionState=null};return{state:i,done:a,cancel:()=>{this._graphicSymbol=l,a()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:o=>{t=o.symbol,o.symbol=e},redo:o=>{e=o.symbol,o.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:o,initialSizes:r}){const i=this._graphicSymbol;if(null==i||"point-3d"!==i.type)return;const a=i.clone(),n=-l.rad2deg(t-this.initialAngle);let c=!1;this._forEachObjectSymbolLayerPair(o,a,((t,o,l)=>{const i=(t.heading??0)+n;o.heading!==i&&(o.heading=i,c=!0);const a=r[l];if(null!=a&&"width"in a){a.width=this.sizeFilter(a.width),a.height=this.sizeFilter(a.height),a.depth=this.sizeFilter(a.depth);const t=a.width*e;o.width!==t&&(o.width=t,c=!0);const l=a.depth*e;o.depth!==l&&(o.depth=l,c=!0);const r=a.height*e;o.height!==r&&(o.height=r,c=!0)}})),c&&(this._graphicSymbol=a)}_forEachObjectSymbolLayerPair(e,t,o){e.symbolLayers.forEach(((e,l)=>{const r=t.symbolLayers.at(l);"object"===e.type&&"object"===r.type&&o(e,r,l)}))}},t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"initialAngle",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angle",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angleClockwise",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"orientation",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"orientationClockwise",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"relativeAngle",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"relativeAngleClockwise",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"scale",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"size",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeAxis",void 0),t.__decorate([i.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"graphic",void 0),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_interactionState",void 0),t.__decorate([i.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"findLayerView",void 0),t.__decorate([i.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeFilter",void 0),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_sizeReferenceSymbolLayer",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_orientationReferenceSymbolLayer",null),t.__decorate([i.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_graphicSymbol",null),e.ScaleRotateObjectSymbol3DAdapter=t.__decorate([s.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],e.ScaleRotateObjectSymbol3DAdapter);const y={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let h=class extends o{get state(){const{originalSymbol:e,angle:t,initialAngle:o,scale:l,initialSizes:r}=this;return{originalSymbol:e,angle:t,initialAngle:o,scale:l,initialSizes:r}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};t.__decorate([i.property()],h.prototype,"originalSymbol",void 0),t.__decorate([i.property()],h.prototype,"angle",void 0),t.__decorate([i.property()],h.prototype,"initialAngle",void 0),t.__decorate([i.property()],h.prototype,"initialSizes",void 0),t.__decorate([i.property()],h.prototype,"scale",void 0),t.__decorate([i.property()],h.prototype,"state",null),h=t.__decorate([s.subclass("InteractionState")],h),e.headingToAngle=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
