/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Logger","../../../../core/PooledArray","../../../webgl/checkWebGLError"],(function(e,o,s,r){"use strict";class t{constructor(e){this._context=e,this._nodes=new s}destroy(){this._nodes.forEach((e=>e.destroy())),this._nodes.clear()}add(e){this._nodes.push(e),r.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map((({declaredClass:e})=>e)).join(", ")}`)}remove(e){this._nodes.remove(e),r.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map((({declaredClass:e})=>e)).join(", ")}`)}produces(e){return this._nodes.some((({produces:o})=>o===e))}require(e,o){return this._nodes.reduce(((s,{consumes:r,produces:t})=>s+(r.required.includes(e)&&t===o?1:0)),0)}optional(e,o){return this._nodes.reduce(((s,{consumes:r,produces:t})=>s+(r.optional?.includes(e)&&t===o?1:0)),0)}updateAnimation(){return this._nodes.reduce(((e,o)=>o.updateAnimation()||e),!1)}render(e,s,r){const t=e.name,n=this._nodes.filter((({produces:e})=>e===t));return 0===n.length||(n.forEach((n=>{const d=[e];for(const e of n.consumes.required){if(e===t)continue;const o=s.get(e);if(!o)return void r(d);d.push(o)}if(n.consumes.optional)for(const e of n.consumes.optional){if(e===t)continue;const o=s.get(e);o&&d.push(o)}try{const o=n.doRender(d,this._context);o&&o!==e&&(e.release(),e=o,s.set(t,e))}catch(c){o.getLogger(n).errorOnce(c)}r(d)})),this._context.rctx.enforceState()),e}}e.RenderNodes=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
