/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/has","../../../../core/time","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../core/shaderLibrary/ShaderOutput","../lib/AnimationTimer","../lib/Material","../lib/OrderIndependentTransparency","../lib/RenderSlot","./DefaultBufferWriter","./DefaultLayouts","./TriangleMaterial","./WaterGLMaterial","./WaterTechnique"],(function(e,t,a,i,r,s,n,o,l,h,c,u,d,p,f,m){"use strict";class g extends p.TriangleMaterial{constructor(e){super(e,new S),this._configuration=new m.WaterTechniqueConfiguration,this._animation=new o.AnimationTimer,this.produces=new Map([[c.RenderSlot.OPAQUE_MATERIAL,e=>n.isColorOrAlpha(e)&&!this.parameters.transparent||n.isOIDorHighlight(e)],[c.RenderSlot.TRANSPARENT_MATERIAL,e=>n.isColorOrAlpha(e)&&this.parameters.transparent||n.isOIDorHighlight(e)],[c.RenderSlot.DRAPED_MATERIAL,e=>this.parameters.draped&&e===n.ShaderOutput.Color||n.isOIDorHighlight(e)],[c.RenderSlot.DRAPED_WATER,e=>e===n.ShaderOutput.Normal]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<h.OITPolygonOffsetLimit,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<_;const i=this._animation.advance(e);return this.setParameters({timeElapsed:a.secondsFromMilliseconds(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&i}createGLMaterial(e){return new f.WaterGLMaterial(e)}createBufferWriter(){return new u.DefaultBufferWriter(t("enable-feature:objectAndLayerId-rendering")?d.PositionUVLayoutObjectAndLayerId:d.PositionUVLayout)}get test(){return{animationEnabled:this._animation.enabled}}}class S extends l.MaterialParameters{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=i.fromValues(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=s.fromValues(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=r.create(),this.modelTransformation=null}}const _=35e3;e.WaterMaterial=g,e.WaterMaterialParameters=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
