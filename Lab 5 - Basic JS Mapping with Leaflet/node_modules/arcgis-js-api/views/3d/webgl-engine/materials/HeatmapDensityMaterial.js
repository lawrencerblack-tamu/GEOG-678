/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","../lib/Material","../lib/RenderSlot","../lib/VertexAttribute","./internal/bufferWriterUtils","../shaders/HeatmapDensityTechnique"],(function(t,e,r,i,s,a,n,u,o,l,c){"use strict";const b=2;class f extends c.HeatmapDensityPassParameters{constructor(){super(...arguments),this.isAttributeDriven=!1,this.usesHalfFloats=!1}}class h extends n.Material{constructor(t){super(t,new f),this.produces=new Map([[u.RenderSlot.DRAPED_MATERIAL,t=>t===s.ShaderOutput.Color]]),this._configuration=new c.HeatmapDensityTechniqueConfiguration}getConfiguration(){return this._configuration.isAttributeDriven=this.parameters.isAttributeDriven,this._configuration.usesHalfFloat=this.parameters.usesHalfFloats,this._configuration}createGLMaterial(t){return new d(t)}intersect(){}intersectDraped(t,r,i,s,a,n){const u=t.attributes.get(o.VertexAttribute.POSITION),{parameters:l}=this,{searchRadius:c}=l,{screenToWorldRatio:f}=t,h=c*f+b*f,d=h*h,A=u.data.length/u.size;for(let o=0;o<A;o++){const t=o*u.size,r=e.set(m,u.data[t],u.data[t+1]);e.squaredDistance(r,s)<d&&a(n.dist,n.normal,-1,!1)}}createBufferWriter(){return new A(this.parameters.isAttributeDriven?p:T)}}class d extends a{beginSlot(t){return this.ensureTechnique(c.HeatmapDensityTechnique,t)}}class A{constructor(t){this.vertexBufferLayout=t}elementCount(t){return t.attributes.get(o.VertexAttribute.POSITION).indices.length*g}write(t,e,r,i,s){l.writePosition(r.attributes.get(o.VertexAttribute.POSITION),t,i.position,s,g);const a=r.attributes.get(o.VertexAttribute.POSITION).indices.length,n=i.uv0;let u=s;for(let o=0;o<a;++o)n.setValues(u++,-1,-1),n.setValues(u++,1,-1),n.setValues(u++,1,1),n.setValues(u++,1,1),n.setValues(u++,-1,1),n.setValues(u++,-1,-1);const c=o.VertexAttribute.FEATUREATTRIBUTE in i?i.featureAttribute:null;c&&l.writeBufferFloat(r.attributes.get(o.VertexAttribute.FEATUREATTRIBUTE),c,s,g)}}const T=i.newLayout().vec3f(o.VertexAttribute.POSITION).vec2f(o.VertexAttribute.UV0),p=T.clone().f32(o.VertexAttribute.FEATUREATTRIBUTE),g=6,m=r.create();t.HeatmapDensityMaterial=h,t.HeatmapDensityMaterialParameters=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
