/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Logger","../../../../core/NestedMap","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/buffer/BufferView"],(function(e,r,t,o,i){"use strict";class d{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new i.BufferViewVec4u8(new ArrayBuffer(4)),this._layerToOidToColor=new t.NestedMap,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new t.NestedMap,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,t,o,i,d=null,a=null,s=null){e&&r&&t&&o&&(this._layerUidToId.set(o,t),this._layerUidToPopupEnabled.set(o,i),i&&this._layerUidToGraphicsUidToObjectId.set(o,r,{objectId:e,attributeNodeId:d,attributeIndex:a,subLayerId:s}))}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return o.fromValues(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const t=this._layerUidToPopupEnabled.get(e.layerUid);if(void 0===t)return r.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(!1===t)return this.colorZero;const o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid)?.objectId;if(!o)return this.colorZero;let d=this._layerToOidToColor.get(e.layerUid,o);if(!d){for(;!d;){const e=Math.floor(16777214*Math.random())+1;this._colorToUID.has(e)||(d=e)}if(d>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,o,d),this._colorToUID.set(d,e)}const a=new ArrayBuffer(4);new DataView(a).setUint32(0,d,!1);return new i.BufferViewVec4u8(a)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[t,o]of this._colorToUID.entries()){const i=this._layerUidToGraphicsUidToObjectId.get(o.layerUid,o.graphicUid);i||r.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+o.graphicUid);const d=this._layerUidToId.get(o.layerUid);d||r.getLogger(this).warn("no layerId found for uid "+o.layerUid),i&&d&&e.set(t,i.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:i.objectId,lid:d,attrId:i.attributeNodeId,attrIdx:i.attributeIndex,subLayerId:i.subLayerId}:{type:"object-and-layer-id",oid:i.objectId,lid:d})}return e}}e.ObjectAndLayerIdRenderHelper=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
