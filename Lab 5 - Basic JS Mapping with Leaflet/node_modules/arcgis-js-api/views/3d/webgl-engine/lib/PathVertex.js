/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat2","../../../../core/libs/gl-matrix-2/factories/mat2f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./PathExtruder","./PathGeometry"],(function(t,e,r,a,i,s,h,o,n,c){"use strict";class g{constructor(){this.vLeft=o.create(),this.vRight=o.create(),this.vMinSiblingLength=0,this.frame=new n.Frame2D}setFrameFromUpVector(t){h.copy(this.frame.up,t),h.add(L,this.vLeft,this.vRight),h.normalize(L,L),h.scale(A,this.frame.up,h.dot(L,this.frame.up)),h.subtract(P,L,A),h.normalize(P,P),h.cross(this.frame.right,P,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class l extends g{get rotationFrameUp(){return this.frame.up}get rotationRight(){return s.UNIT_X}get rotationAngle(){h.scale(x,this.frame.up,h.dot(this.frame.up,this.vLeft)),h.subtract(x,this.vLeft,x),h.negate(x,x),h.normalize(x,x),h.scale(R,this.frame.up,h.dot(this.frame.up,this.vRight)),h.subtract(R,this.vRight,R),h.normalize(R,R),h.cross(b,this.rotationFrameUp,this.vLeft);return Math.sign(h.dot(b,this.vRight))*(Math.PI-e.acosClamped(h.dot(x,R)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(t,r){const a=this.rotationAngle;if(Math.abs(a)<=0)return r;const s=e.reciprocalClamped(Math.cos(.5*a));return i.set(t,(s-1+1)*r[0],r[1])}}class m extends g{get rotationFrameUp(){const t=Math.sign(h.dot(this.frame.right,this.vRight));return h.cross(p,this.vRight,this.vLeft),h.scale(p,p,t),h.normalize(p,p)}get rotationRight(){const t=this.rotationFrameUp,e=h.dot(t,this.frame.up),r=h.dot(t,this.frame.right);return h.scale(v,this.frame.up,-r),h.scale(M,this.frame.right,e),h.add(v,v,M),h.normalize(v,v),f(d,this.frame,v),d}get rotationAngle(){const t=Math.sign(h.dot(this.frame.right,this.vRight));return h.negate(b,this.vLeft),-t*(Math.PI-e.acosClamped(h.dot(b,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*e.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(t,a){const s=this.rotationAngle;if(0===Math.abs(s))return a;const h=e.reciprocalClamped(Math.cos(.5*s)),o=this.rotationRight,n=r.set(S,1+(h-1)*o[0]*o[0],(h-1)*o[0]*o[1],(h-1)*o[0]*o[1],1+(h-1)*o[1]*o[1]);return i.transformMat2(t,a,n)}}function f(t,e,r){i.set(t,h.dot(r,e.right),h.dot(r,e.up))}function u(t){switch(t){case c.UpVectorAlignment.World:return new l;case c.UpVectorAlignment.Path:return new m}}const p=o.create(),d=s.create(),v=o.create(),M=o.create(),b=o.create(),x=o.create(),R=o.create(),A=o.create(),L=o.create(),P=o.create(),S=a.create();t.PathVertex=g,t.newPathVertex=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
