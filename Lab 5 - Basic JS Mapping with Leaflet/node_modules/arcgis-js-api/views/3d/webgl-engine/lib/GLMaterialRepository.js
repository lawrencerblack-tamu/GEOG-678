/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],(function(e,t,r,i,s){"use strict";class o{constructor(e,t,r,s){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new i.NestedMap}dispose(){this._textureRepository.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(!i||!i(r))return null;let s=this._id2glMaterialRef.get(r,e.id);if(null==s){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:r});s=new a(t),this._id2glMaterialRef.set(r,e.id,s)}return s.ref(),s.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);null!=i&&(i.unref(),i.referenced||(r.disposeMaybe(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&t.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class a{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,s.assert(this._refCnt>=0)}get referenced(){return this._refCnt>0}}e.GLMaterialRepository=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
