/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/RandomLCG","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../support/buffer/glUtil","../Normals","./bufferLayouts"],(function(t,e,o,r,n,i,s){"use strict";class a{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?l:f}write(t,e,o){const r=this._edgeHashFunction(o);L.seed=r;const n=L.getIntRange(0,255),i=L.getIntRange(0,this.settings.variants-1),s=.7,a=L.getFloat(),c=255*(.5*g(-(1-Math.min(a/s,1))+Math.max(0,a-s)/(1-s),1.2)+.5);t.position0.setVec(e,o.position0),t.position1.setVec(e,o.position1),t.componentIndex.set(e,o.componentIndex),t.variantOffset.set(e,n),t.variantStroke.set(e,i),t.variantExtension.set(e,c)}trim(t,e){return t.slice(0,e)}}const c=new Float32Array(6),u=new Uint32Array(c.buffer),m=new Uint32Array(1);function f(t){const e=c;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],m[0]=5381;for(let o=0;o<u.length;o++)m[0]=31*m[0]+u[o];return m[0]}function l(t){const e=c;e[0]=p(t.position0[0]),e[1]=p(t.position0[1]),e[2]=p(t.position0[2]),e[3]=p(t.position1[0]),e[4]=p(t.position1[1]),e[5]=p(t.position1[2]),m[0]=5381;for(let o=0;o<u.length;o++)m[0]=31*m[0]+u[o];return m[0]}const d=1e4;function p(t){return Math.round(t*d)/d}function g(t,e){const o=t<0?-1:1;return Math.abs(t)**e*o}class h{constructor(){this._commonWriter=new a}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return s.RegularEdgeInstancesLayout.createBuffer(t)}write(t,e,r){this._commonWriter.write(t,e,r),o.add(S,r.faceNormal0,r.faceNormal1),o.normalize(S,S);const{typedBuffer:n,typedBufferStride:s}=t.normalCompressed;i.compressNormal(n,e,S[0],S[1],S[2],s)}trim(t,e){return this._commonWriter.trim(t,e)}}h.Layout=s.RegularEdgeInstancesLayout,h.glLayout=n.glLayout(s.RegularEdgeInstancesLayout,1);class y{constructor(){this._commonWriter=new a}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return s.SilhouetteEdgeInstancesLayout.createBuffer(t)}write(t,e,o){this._commonWriter.write(t,e,o);{const{typedBuffer:r,typedBufferStride:n}=t.normalCompressed;i.compressNormal(r,e,o.faceNormal0[0],o.faceNormal0[1],o.faceNormal0[2],n)}{const{typedBuffer:r,typedBufferStride:n}=t.normal2Compressed;i.compressNormal(r,e,o.faceNormal1[0],o.faceNormal1[1],o.faceNormal1[2],n)}}trim(t,e){return this._commonWriter.trim(t,e)}}y.Layout=s.SilhouetteEdgeInstancesLayout,y.glLayout=n.glLayout(s.SilhouetteEdgeInstancesLayout,1);const S=r.create(),L=new e;t.CommonBufferWriter=a,t.RegularEdgeBufferWriter=h,t.SilhouetteEdgeBufferWriter=y,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
