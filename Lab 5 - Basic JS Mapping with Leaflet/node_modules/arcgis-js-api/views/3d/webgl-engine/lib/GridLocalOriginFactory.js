/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/uid","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/projection/projectBuffer","./Attribute","./ContentObjectType","./Geometry","./LocalOriginFactory","./Object3D","./testUtils","./VertexAttribute","./WebGLLayer","../materials/RibbonLineMaterial"],(function(t,e,i,r,o,s,n,a,c,h,g,d,l,u,b){"use strict";class _{constructor(t){this._originSR=t,this._rootOriginId="root/"+e.generateUID(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(t){const e=this._origins.get(this._rootOriginId);if(null==e){const e=d.gridLocalOriginFactory.rootOrigin;if(null!=e)return this._origins.set(this._rootOriginId,h.fromValues(e[0],e[1],e[2],this._rootOriginId)),this.getOrigin(t);const i=h.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const r=this._gridSize,o=Math.round(t[0]/r),s=Math.round(t[1]/r),n=Math.round(t[2]/r),a=`${o}/${s}/${n}`;let c=this._origins.get(a);const g=.5*r;if(i.subtract(f,t,e.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]),f[0]<g&&f[1]<g&&f[2]<g){if(c){const e=Math.max(...f);i.subtract(f,t,c.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]);if(Math.max(...f)<e)return c}return e}return c||(c=h.fromValues(o*r,s*r,n*r,a),this._origins.set(a,c)),c}_drawOriginBox(t,e=o.fromValues(1,1,0,1)){const i=window.view,r=i._stage,h=e.toString();if(!this._objects.has(h)){this._material=new b.RibbonLineMaterial({width:2,color:e}),r.add(this._material);const t=new u.WebGLLayer(r,{pickable:!1}),i=new g.Object3D({castShadow:!1});r.add(i),t.add(i),this._objects.set(h,i)}const d=this._objects.get(h),_=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],f=_.length,m=new Array(3*f),O=new Array,M=.5*this._gridSize;for(let o=0;o<f;o++)m[3*o]=t[0]+(1&_[o]?M:-M),m[3*o+1]=t[1]+(2&_[o]?M:-M),m[3*o+2]=t[2]+(4&_[o]?M:-M),o>0&&O.push(o-1,o);s.projectBuffer(m,this._originSR,0,m,i.renderSpatialReference,0,f);const w=new c.Geometry(this._material,[[l.VertexAttribute.POSITION,new n.Attribute(m,O,3,!0)]],null,a.ContentObjectType.Line);r.add(w),d.addGeometry(w)}get test(){const t=this;return{set gridSize(e){t._gridSize=e}}}}const f=r.create();t.GridLocalOriginFactory=_,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
