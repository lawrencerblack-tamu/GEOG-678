/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/handleUtils","../../../core/Logger","../../../core/maybe","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./AnalysisView3D","./Dimension/DimensionController","./Dimension/DimensionTool","./Dimension/DimensionVisualization","./Dimension/LengthDimensionComputation","./support/projectionUtils","../../analysis/analysisViewUtils","../../analysis/DimensionAnalysisView"],(function(e,t,i,o,s,n,a,r,l,p,c,d,m,u,y,_,h,D){"use strict";let v=class extends(D(c.AnalysisView3D(t))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(null==e)return null;const{spatialReference:t,elevationProvider:i}=this.view,s=_.applyProjectionAndElevationAlignment(e,t,i);return null==s&&_.logFailedGeometryProjectionError(this.analysis,e.spatialReference,o.getLogger(this)),s};const e=n.mapCollection((()=>this.analysis.dimensions),(e=>this._createComputation(e)));this.computations=e,this.addHandles([h.connectAnalysisViewToTool(this,m.DimensionTool),i.destroyHandle(e)]),this._analysisVisualization=new u.DimensionVisualization({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new d.DimensionController({analysisViewData:this,view:this.view})}destroy(){this._placementTask=s.abortMaybe(this._placementTask),this._analysisVisualization=s.destroyMaybe(this._analysisVisualization),h.removeAnalysisViewTool(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return null==e?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=s.abortMaybe(this._placementTask),this._placementTask=h.activateAnalysisViewTool(this,e),this._placementTask.promise}_createComputation(e){const{_dimensionsToComputations:t}=this,i=new y.LengthDimensionComputation({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return t.set(e,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(e){const{dimension:t}=e;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}};e.__decorate([a.property({readOnly:!0})],v.prototype,"type",void 0),e.__decorate([a.property()],v.prototype,"tool",void 0),e.__decorate([a.property()],v.prototype,"updating",null),e.__decorate([a.property({readOnly:!0})],v.prototype,"results",null),e.__decorate([a.property()],v.prototype,"computations",void 0),e.__decorate([a.property()],v.prototype,"selectedDimension",void 0),e.__decorate([a.property()],v.prototype,"selectedComputation",null),e.__decorate([a.property()],v.prototype,"_analysisVisualization",void 0),e.__decorate([a.property()],v.prototype,"_analysisController",void 0),e.__decorate([a.property()],v.prototype,"_dimensionsToComputations",void 0),e.__decorate([a.property()],v.prototype,"_placementTask",void 0),v=e.__decorate([p.subclass("esri.views.3d.analysis.DimensionAnalysisView3D")],v);return v}));
