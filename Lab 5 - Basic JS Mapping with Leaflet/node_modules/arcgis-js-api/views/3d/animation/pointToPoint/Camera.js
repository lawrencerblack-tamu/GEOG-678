/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../ViewingMode","../../support/mathUtils"],(function(t,e,i,s,a,o,c,n){"use strict";class r{constructor(t){this.viewingMode=t,this.center=o.create(),this.pitch=0,this.yaw=0,this.distance=0,this.direction=o.clone(u),this.fov=55,this.size=1}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,e){if(e||(e={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===c.ViewingMode.Global){const i=(a.length(this.center)+a.length(t.center))/2;e.pan=n.angle(this.center,t.center)*i}else e.pan=a.distance(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t.pitch-this.pitch);return e.rotate=Math.max(i,s),e.sourceZoom=this.distance,e.targetZoom=t.distance,e}interpolate(t,i,s){this.viewingMode===c.ViewingMode.Global?n.slerp(t.center,i.center,s.pan,this.center):a.lerp(this.center,t.center,i.center,s.pan),this.distance=isFinite(i.distance)?e.lerp(t.distance,i.distance,s.zoom):t.distance,this.pitch=e.lerp(t.pitch,i.pitch,s.rotate);let o=t.yaw;const r=i.yaw;Math.abs(r-o)>=Math.PI&&(o+=2*(o<r?1:-1)*Math.PI),this.yaw=e.lerp(o,r,s.rotate)}copyFrom(t){a.copy(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,a.copy(this.direction,t.direction),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const e=this._lookAtOrientation(t.center,P);a.copy(this.center,t.center),a.subtract(d,t.center,t.eye),a.transformMat3(d,d,e),a.transformMat3(M,t.up,e),this.distance=a.length(d),0!==this.distance&&(d[0]/=this.distance,d[1]/=this.distance,d[2]/=this.distance),this.pitch=this._eyeUpToPitch(d),this.yaw=h(d,M),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const e=this._lookAtOrientation(this.center,P);i.transpose(e,e),this._axisAngleVec3(w,this.pitch-Math.PI/2,u,d),this._axisAngleVec3(y,this.yaw,d,d),this._axisAngleVec3(w,this.pitch-Math.PI/2,y,M),this._axisAngleVec3(y,this.yaw,M,M),a.scale(d,d,this.distance),a.transformMat3(d,d,e),a.transformMat3(M,M,e),t.center=this.center,t.eye=a.subtract(d,this.center,d),t.up=M}_axisAngleVec3(t,e,i,s){const o=Math.cos(e),c=Math.sin(e);return a.scale(l,i,o),a.cross(p,t,i),a.scale(p,p,c),a.scale(m,t,(1-o)*a.dot(t,i)),a.add(s,a.add(s,l,p),m)}_lookAtOrientation(t,e=s.create()){return this._upAtLookAt(t,m),a.cross(l,this.direction,m),a.normalize(l,l),0===l[0]&&0===l[1]&&0===l[2]&&a.copy(l,w),a.cross(p,m,l),a.normalize(p,p),e[0]=l[0],e[1]=p[0],e[2]=m[0],e[3]=l[1],e[4]=p[1],e[5]=m[1],e[6]=l[2],e[7]=p[2],e[8]=m[2],e}_upAtLookAt(t,e){return this.viewingMode===c.ViewingMode.Local?a.copy(e,y):a.normalize(e,t)}_eyeUpToPitch(t){return Math.PI-n.angle(y,t)}}function h(t,e){const i=g;return Math.abs(e[2])<.5?(a.copy(i,e),t[2]>0&&a.scale(i,i,-1)):a.copy(i,t),a.cross(p,i,y),a.normalize(p,p),n.angle(w,p,y)}const l=o.create(),p=o.create(),m=o.create(),d=o.create(),M=o.create(),g=o.create(),y=o.UNIT_Z,u=o.UNIT_Y,w=o.UNIT_X,P=s.create();t.Camera=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
