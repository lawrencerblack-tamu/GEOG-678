/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/promiseUtils","../../../core/urlUtils","./TextureCollection","../webgl-engine/lib/Texture","../../webgl/enums"],(function(e,t,r,s,i,n){"use strict";class o extends s.TextureCollection{constructor(e,t,r){super(t,r),this._streamDataRequester=e}async fromUrl(e,r,i){t.throwIfAborted(i);const n=i?.signal,o=this.makeUid(e,r);let l=this._textureRequests.get(o);if(!l){const t=new AbortController,i=this._streamDataRequester.request(e,"image",{uid:o,signal:t.signal});l=new s.TextureRequest,l.abortController=t;const n=l;this._textureRequests.set(o,l),l.textureAsync=i.then((async t=>{const i=this._createTexture(e,t,r);return n.texture=i,n.abortController=null,await i.load(this._stage.renderView.renderingContext),this._stage.add(i),new s.TextureResult(o,i,(()=>this._release(o)))}),(e=>{throw n.abortController=null,e}))}l.referenceCount++;try{return await t.whenOrAbort(l.textureAsync,n)}catch(a){throw this._release(o),a}}_createTexture(e,t,s){const o={width:t.width,height:t.height,wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(r.isSVG(e)){if(s||0===t.width&&0===t.height){const e=t.width?t.height/t.width:1;s=s||64,e>1?(t.width=Math.round(s/e),t.height=s):(t.width=s,t.height=Math.round(s*e))}this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(o.preMultiplyAlpha=!1)}return new i.Texture(t,o)}}e.StreamTextureCollection=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
