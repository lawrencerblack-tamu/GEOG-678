/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/factories/quatf64","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../webgl-engine/lib/Attribute"],(function(t,e,r,n,i,o,a){"use strict";const c=1e-6,s=o.create(),f=o.create();function u(t,e){const{data:r,size:n}=t,i=r.length/n;if(i<=0)return;const c=new Z(t);et(s,c.minProj,c.maxProj),nt(s,s,.5),rt(f,c.maxProj,c.minProj);const u=tt(f),m=new $;m.quality=u,i<14&&(t=new a.Vertices(new Float64Array(c.buffer,112,42),3));const l=o.create(),P=o.create(),b=o.create(),j=o.create(),x=o.create(),I=o.create(),V=o.create();switch(h(c,t,V,l,P,b,j,x,I,m)){case 1:return void O(s,f,e);case 2:return void H(t,j,e)}N(t,V,l,P,b,j,x,I,m),J(t,m.b0,m.b1,m.b2,k,D);const y=o.create();rt(y,D,k),m.quality=tt(y),m.quality<u?W(m.b0,m.b1,m.b2,k,D,y,e):O(s,f,e)}function h(t,e,r,n,i,o,a,s,f,u){if(y(t,n,i),st(n,i)<c)return 1;rt(a,n,i),at(a,a);return w(e,n,a,o)<c?2:(rt(s,i,o),at(s,s),rt(f,o,n),at(f,f),ot(r,s,a),at(r,r),z(e,r,a,s,f,u),0)}const m=o.create(),l=o.create(),P=o.create(),b=o.create(),j=o.create(),x=o.create(),I=o.create(),V=o.create();function N(t,e,r,n,i,o,a,c,s){g(t,e,r,m,l),void 0!==m[0]&&(rt(P,m,r),at(P,P),rt(b,m,n),at(b,b),rt(j,m,i),at(j,j),ot(x,b,o),at(x,x),ot(I,j,a),at(I,I),ot(V,P,c),at(V,V),z(t,x,o,b,P,s),z(t,I,a,j,b,s),z(t,V,c,P,j,s)),void 0!==l[0]&&(rt(P,l,r),at(P,P),rt(b,l,n),at(b,b),rt(j,l,i),at(j,j),ot(x,b,o),at(x,x),ot(I,j,a),at(I,I),ot(V,P,c),at(V,V),z(t,x,o,b,P,s),z(t,I,a,j,b,s),z(t,V,c,P,j,s))}function y(t,e,r){let n=st(t.maxVert[0],t.minVert[0]),i=0;for(let o=1;o<7;++o){const e=st(t.maxVert[o],t.minVert[o]);e>n&&(n=e,i=o)}it(e,t.minVert[i]),it(r,t.maxVert[i])}const d=[0,0,0];function w(t,e,r,n){const{data:i,size:o}=t;let a=Number.NEGATIVE_INFINITY,c=0;for(let s=0;s<i.length;s+=o){d[0]=i[s]-e[0],d[1]=i[s+1]-e[1],d[2]=i[s+2]-e[2];const t=r[0]*d[0]+r[1]*d[1]+r[2]*d[2],n=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],o=d[0]*d[0]+d[1]*d[1]+d[2]*d[2]-t*t/n;o>a&&(a=o,c=s)}return it(n,i,c),a}const A=n.create();function g(t,e,r,n,i){_(t,e,A,i,n);const o=ft(r,e);A[1]-c<=o&&(n[0]=void 0),A[0]+c>=o&&(i[0]=void 0)}const T=o.create(),q=o.create(),M=o.create(),v=o.create(),F=o.create(),E=o.create();function z(t,e,r,n,i,o){if(ct(e)<c)return;ot(T,r,e),ot(q,n,e),ot(M,i,e),Y(t,e,A),F[1]=A[0],v[1]=A[1],E[1]=v[1]-F[1];const a=[r,n,i],s=[T,q,M];for(let c=0;c<3;++c){Y(t,a[c],A),F[0]=A[0],v[0]=A[1],Y(t,s[c],A),F[2]=A[0],v[2]=A[1],E[0]=v[0]-F[0],E[2]=v[2]-F[2];const r=tt(E);r<o.quality&&(it(o.b0,a[c]),it(o.b1,e),it(o.b2,s[c]),o.quality=r)}}const S=o.create();function Y(t,e,r){const{data:n,size:i}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let o=0;o<n.length;o+=i){const t=n[o]*e[0]+n[o+1]*e[1]+n[o+2]*e[2];r[0]=Math.min(r[0],t),r[1]=Math.max(r[1],t)}}function _(t,e,r,n,i){const{data:o,size:a}=t;it(n,o),it(i,n),r[0]=ft(S,e),r[1]=r[0];for(let c=a;c<o.length;c+=a){const t=o[c]*e[0]+o[c+1]*e[1]+o[c+2]*e[2];t<r[0]&&(r[0]=t,it(n,o,c)),t>r[1]&&(r[1]=t,it(i,o,c))}}function O(t,e,n){n.center=t,n.halfSize=i.scale(e,e,.5),n.quaternion=r.IDENTITY}const p=o.create(),B=o.create(),G=o.create(),k=o.create(),D=o.create(),C=o.create();function H(t,e,r){it(p,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?p[0]=0:Math.abs(e[1])>Math.abs(e[2])?p[1]=0:p[2]=0,ct(p)<c&&(p[0]=p[1]=p[2]=1),ot(B,e,p),at(B,B),ot(G,e,B),at(G,G),J(t,e,B,G,k,D),rt(C,D,k),W(e,B,G,k,D,C,r)}function J(t,e,r,n,i,o){Y(t,e,A),i[0]=A[0],o[0]=A[1],Y(t,r,A),i[1]=A[0],o[1]=A[1],Y(t,n,A),i[2]=A[0],o[2]=A[1]}const K=o.create(),L=o.create(),Q=o.create(),R=e.fromValues(1,0,0,0,1,0,0,0,1),U=r.create();function W(t,e,r,n,o,a,c){R[0]=t[0],R[1]=t[1],R[2]=t[2],R[3]=e[0],R[4]=e[1],R[5]=e[2],R[6]=r[0],R[7]=r[1],R[8]=r[2],c.quaternion=ut(U,R),et(K,n,o),nt(K,K,.5),nt(L,t,K[0]),nt(Q,e,K[1]),et(L,L,Q),nt(Q,r,K[2]),c.center=i.add(L,L,Q),c.halfSize=i.scale(K,a,.5)}const X=7;class Z{constructor(t){this.minVert=new Array(X),this.maxVert=new Array(X);const e=64*X;this.buffer=new ArrayBuffer(e);let r=0;this.minProj=new Float64Array(this.buffer,r,X),r+=8*X,this.maxProj=new Float64Array(this.buffer,r,X),r+=8*X;for(let c=0;c<X;++c)this.minVert[c]=new Float64Array(this.buffer,r,3),r+=24;for(let c=0;c<X;++c)this.maxVert[c]=new Float64Array(this.buffer,r,3),r+=24;for(let c=0;c<X;++c)this.minProj[c]=Number.POSITIVE_INFINITY,this.maxProj[c]=Number.NEGATIVE_INFINITY;const n=new Array(X),i=new Array(X),{data:o,size:a}=t;for(let c=0;c<o.length;c+=a){let t=o[c];t<this.minProj[0]&&(this.minProj[0]=t,n[0]=c),t>this.maxProj[0]&&(this.maxProj[0]=t,i[0]=c),t=o[c+1],t<this.minProj[1]&&(this.minProj[1]=t,n[1]=c),t>this.maxProj[1]&&(this.maxProj[1]=t,i[1]=c),t=o[c+2],t<this.minProj[2]&&(this.minProj[2]=t,n[2]=c),t>this.maxProj[2]&&(this.maxProj[2]=t,i[2]=c),t=o[c]+o[c+1]+o[c+2],t<this.minProj[3]&&(this.minProj[3]=t,n[3]=c),t>this.maxProj[3]&&(this.maxProj[3]=t,i[3]=c),t=o[c]+o[c+1]-o[c+2],t<this.minProj[4]&&(this.minProj[4]=t,n[4]=c),t>this.maxProj[4]&&(this.maxProj[4]=t,i[4]=c),t=o[c]-o[c+1]+o[c+2],t<this.minProj[5]&&(this.minProj[5]=t,n[5]=c),t>this.maxProj[5]&&(this.maxProj[5]=t,i[5]=c),t=o[c]-o[c+1]-o[c+2],t<this.minProj[6]&&(this.minProj[6]=t,n[6]=c),t>this.maxProj[6]&&(this.maxProj[6]=t,i[6]=c)}for(let c=0;c<X;++c){let t=n[c];it(this.minVert[c],o,t),t=i[c],it(this.maxVert[c],o,t)}}}class ${constructor(){this.b0=o.fromValues(1,0,0),this.b1=o.fromValues(0,1,0),this.b2=o.fromValues(0,0,1),this.quality=0}}function tt(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function et(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function rt(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function nt(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function it(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function ot(t,e,r){const n=e[0],i=e[1],o=e[2],a=r[0],c=r[1],s=r[2];t[0]=i*s-o*c,t[1]=o*a-n*s,t[2]=n*c-i*a}function at(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const n=1/Math.sqrt(r);t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}}function ct(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function st(t,e){const r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function ft(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ut(t,e){const r=e[0]+e[4]+e[8];if(r>0){let n=Math.sqrt(r+1);t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const n=(r+1)%3,i=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*i+i]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*n+i]-e[3*i+n])*o,t[n]=(e[3*n+r]+e[3*r+n])*o,t[i]=(e[3*i+r]+e[3*r+i])*o}return t}t.computeOBB=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
