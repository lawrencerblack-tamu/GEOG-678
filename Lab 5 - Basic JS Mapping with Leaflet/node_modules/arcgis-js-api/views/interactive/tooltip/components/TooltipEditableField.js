/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/tslib.es6","../../../../core/reactiveUtils","../../../../core/scheduling","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../keybindings","../css","../../../../widgets/Widget","../../../../chunks/componentsUtils","../../../../widgets/support/widgetUtils","../../../../widgets/support/jsxFactory"],(function(t,e,i,l,o,n,s,a,c,r,u,d,p,_,h,y){"use strict";const f=`${d.base}-editable-field`,m={base:f,inputMode:`${f}--input`,locked:`${f}--locked`,title:`${f}__title`,titleContent:`${f}__title__content`,value:`${f}__value`,valueContent:`${f}__value__content`,valueContentReadOnly:`${f}__value__content--read-only`,input:`${f}__input`,inputSuffix:`${f}__input-suffix`,button:`${f}__button`};e.TooltipEditableField=class extends p{constructor(){super(...arguments),this._input=null,this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),o.waitAnimationFrame().then(t)},this._onKeyDown=t=>{t.key===u.tooltipKeys.discard&&this._discard()},this._onInputKeyDown=t=>{switch(t.key){case u.tooltipKeys.commit:return this._commit({type:"commit-and-exit",allowLockingCurrentValue:!0});case u.tooltipKeys.next:return t.preventDefault(),t.stopPropagation(),this._commit({type:t.shiftKey?"commit-and-previous":"commit-and-next",allowLockingCurrentValue:!1})}},this._onInput=t=>{this.field.inputValue=t.target.value},this._onLockClick=()=>{const{field:t}=this;t.locked?t.unlock():this._lock()}}initialize(){this.addHandles(l.watch((()=>this._rawDisplayValue),(()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return _.loadCalciteComponents({action:()=>new Promise(((e,i)=>t(["../../../../chunks/calcite-action"],e,i))),icon:()=>new Promise(((e,i)=>t(["../../../../chunks/calcite-icon"],e,i))),input:()=>new Promise(((e,i)=>t(["../../../../chunks/calcite-input"],e,i)))})}render(){const{mode:t,field:e}=this,i="input"===t,{locked:l}=e;return y.tsx("div",{class:this.classes({[m.base]:!0,[m.inputMode]:"input"===t,[m.locked]:l})},y.tsx("div",{class:m.title,key:"title"},y.tsx("div",{class:m.titleContent,key:"title-content"},this._title,l&&!i?y.tsx("calcite-icon",{icon:"lock",key:"icon",scale:"s"}):null)),y.tsx("div",{class:m.value,key:"value"},i?this._renderInputModeValue():this._renderFeedbackModeValue()))}get _initialValue(){const{field:t}=this;return null!=t.actual?t.toInputUnits(t.actual,this.context).value:null}get _formattedValue(){const{context:t,field:e}=this,{actual:i,committed:l,format:o}=e;return null!=l?o(l,t):null!=i?o(i,t):k}get _rawDisplayValue(){const{field:t}=this,{inputValue:e,committed:i}=t;return null!=e?e:this._toString(null!=i?t.toInputUnits(i,this.context).value:this._initialValue)}get _suffix(){const{suffix:t}=this.field;return"string"==typeof t?t:t(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderFeedbackModeValue(){return y.tsx("span",{key:"value-feedback"},this._formattedValue)}_renderInputModeValue(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return y.tsx("span",{class:m.valueContentReadOnly,key:"value-readonly"},this._formattedValue)}_renderValueWritable(){const{locked:t,name:e}=this.field,i=this.context?.messages.sketch??{},l=t?i.unlockConstraint:i.lockConstraint;return y.tsx("div",{class:m.valueContent,key:"value-writable",onkeydown:this._onKeyDown},y.tsx("calcite-input",{afterCreate:t=>{this._input=t},class:m.input,"data-field-name":e,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",type:"text",value:this._rawDisplayValue,onCalciteInputInput:this._onInput}),y.tsx("div",{class:m.inputSuffix,key:"suffix"},this._suffix),y.tsx("calcite-action",{alignment:"center",appearance:"transparent",class:m.button,compact:!0,icon:t?"lock":"unlock",label:l,onclick:this._onLockClick,scale:"s",tabIndex:-1,text:"",title:l}))}_commit({type:t,allowLockingCurrentValue:e}){const{_input:i,field:l}=this;if(!i)return;const{locked:o,inputValue:n}=l;o&&""===n?l.unlock():(e&&!o||null!=n)&&this._lock(),this.context.onCommit(i,t)}_discard(){this._input&&(this.field.inputValue=null,this.context.onDiscard(this._input))}_lock(){const{field:t}=this,e=this._parseNumber(t.inputValue),i=null!=e?t.createQuantity(e,this.context):null;t.lock(i)}_parseNumber(t){if(null==t)return null;const e=parseFloat(t);return isNaN(e)||!isFinite(e)?null:e}_toString(t){return null!=t?t.toFixed(2):k}},i.__decorate([n.property()],e.TooltipEditableField.prototype,"field",void 0),i.__decorate([n.property()],e.TooltipEditableField.prototype,"context",void 0),i.__decorate([n.property()],e.TooltipEditableField.prototype,"mode",void 0),i.__decorate([n.property()],e.TooltipEditableField.prototype,"_initialValue",null),i.__decorate([n.property()],e.TooltipEditableField.prototype,"_formattedValue",null),i.__decorate([n.property()],e.TooltipEditableField.prototype,"_input",void 0),i.__decorate([n.property()],e.TooltipEditableField.prototype,"_rawDisplayValue",null),i.__decorate([n.property()],e.TooltipEditableField.prototype,"_suffix",null),i.__decorate([n.property()],e.TooltipEditableField.prototype,"_title",null),e.TooltipEditableField=i.__decorate([r.subclass("esri.views.interactive.tooltip.components.TooltipEditableField")],e.TooltipEditableField);const k="â€”";Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
