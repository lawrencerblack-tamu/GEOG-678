/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/arrayUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/decorators/subclass","./I3SSnappingSource"],(function(e,r,t,o,i,a,c,n,s,S){"use strict";e.SceneLayerSnappingSource=class extends t{get updating(){return this._i3sSources.some((e=>e.updating))}constructor(e){super(e),this.availability=1,this._i3sSources=[]}destroy(){this._i3sSources.forEach((e=>e.destroy())),this._i3sSources.length=0}initialize(){const{view:e}=this,r=this.layerSource.layer;this._i3sSources="building-scene"===r.type?this._getBuildingSceneI3SSources(e,r):[this._getSceneLayerI3SSource(e,r)]}async fetchCandidates(e,r){const t=await Promise.all(this._i3sSources.map((t=>t.fetchCandidates(e,r))));return i.throwIfAborted(r),t.flat()}refresh(){this._i3sSources.forEach((e=>e.refresh()))}_getBuildingSceneI3SSources(e,r){return r.allSublayers.toArray().map((t=>"building-component"===t.type?new S.I3SSnappingSource({getLayerView:async()=>(await e.whenLayerView(r)).whenSublayerView(t),view:e}):null)).filter(o.isSome)}_getSceneLayerI3SSource(e,r){return new S.I3SSnappingSource({getLayerView:async()=>{const t=await e.whenLayerView(r);return"scene-layer-graphics-3d"===t.type?void 0:t},view:e})}},r.__decorate([a.property({constructOnly:!0})],e.SceneLayerSnappingSource.prototype,"layerSource",void 0),r.__decorate([a.property({constructOnly:!0})],e.SceneLayerSnappingSource.prototype,"view",void 0),r.__decorate([a.property({readOnly:!0})],e.SceneLayerSnappingSource.prototype,"updating",null),r.__decorate([a.property({readOnly:!0})],e.SceneLayerSnappingSource.prototype,"availability",void 0),e.SceneLayerSnappingSource=r.__decorate([s.subclass("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],e.SceneLayerSnappingSource),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
