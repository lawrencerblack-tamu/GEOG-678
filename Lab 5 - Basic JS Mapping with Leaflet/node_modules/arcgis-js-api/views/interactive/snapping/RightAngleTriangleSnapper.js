/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/libs/gl-matrix-2/math/vec2","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../support/elevationInfoUtils","../sketch/normalizedPoint","./SnappingAlgorithm","./snappingUtils","./candidates/RightAngleTriangleSnappingCandidate","../support/viewUtils","../../support/geometry2dUtils"],(function(e,t,i,n,o,r,s,a,p,l){"use strict";class c extends r.SnappingAlgorithm{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=[],r=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return n;const{view:s}=this,a=i.vertices[0],p=i.vertices[r-1],l=o.fromAnyMapPoint(a.pos,s,t),c=o.fromAnyMapPoint(p.pos,s,t);return this._processCandidateProposal(l,c,e,t,n),n}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,r=n.component;if(r.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===n.index||n.index===r.vertices.length-1))return i;const{view:s}=this,a=o.fromAnyMapPoint(n.leftEdge.leftVertex.pos,s,t),p=o.fromAnyMapPoint(n.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(a,p,e,t,i),i}_processCandidateProposal(e,i,r,c,g){if(!this.exceedsShortLineThreshold(e,i,c))return;const h=t.lerp(d,o.asVec2(e),o.asVec2(i),.5),f=.5*t.distance(o.asVec2(e),o.asVec2(i)),u=l.projectPointToCircle(d,o.asVec2(r),h,f),m=o.fromValues(u[0],u[1],r[2]),{spatialReference:v,pointer:y}=c,x=p.vectorToScreenPoint(r,v,n.absoluteHeightElevationInfo,this.view);if(s.squaredScreenDistance(x,p.vectorToScreenPoint(m,v,n.absoluteHeightElevationInfo,this.view))<this.squaredProximityThreshold(y)){if(this.isVertical(e,m,c)||this.isVertical(m,i,c))return;g.push(new a.RightAngleTriangleSnappingCandidate({targetPoint:m,point1:e,point2:i,isDraped:"on-the-ground"===c.elevationInfo?.mode}))}}}const d=i.create();e.RightAngleTriangleSnapper=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
