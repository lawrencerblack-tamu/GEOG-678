/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/reactiveUtils","../../../core/SetUtils","../../../core/sql","../../../core/timeUtils","../../../chunks/vec32","../../../layers/graphics/dehydratedPoint","../../../rest/support/Query","../../input/InputManager","../keybindings","../sketch/normalizedPoint","../../../webmap/utils"],(function(e,t,n,i,r,o,s,a,c,l,d,p){"use strict";function g(e,t){const n=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return n;case 3:return n&&e[2]===t[2];case 4:return n&&e[2]===t[2]&&e[3]===t[3]}return!1}function u(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function y(e,t){return Math.sqrt(u(e,t))}function E(e,t){t.sort(((t,n)=>o.squaredDistance(t.targetPoint,e)-o.squaredDistance(n.targetPoint,e)))}var m;function f({point:e,distance:t,returnEdge:n,vertexMode:o,coordinateHelper:{spatialReference:c},filter:l},d,p){return p=null!=p?p.clone():new a({where:"1=1"}),l&&(p.geometry=l.geometry,p.distance=l.distance,p.spatialRelationship=l.spatialRelationship,p.where=i.sqlAnd(p.where,l.where),p.timeExtent=r.mergeTimeExtents(p.timeExtent,l.timeExtent),p.objectIds=h(p.objectIds,l.objectIds)),{point:s.makeDehydratedPoint(e[0],e[1],e[2],c.toJSON()),mode:d,distance:t,returnEdge:n,vertexMode:o,query:p.toJSON()}}function h(e,t){return e||t?t?e?Array.from(n.intersection(new Set(e),new Set(t))):t:e:null}function w(e,t,n){return{left:d.fromAnyMapPoint(e.leftVertex.pos,t,n),right:d.fromAnyMapPoint(e.rightVertex.pos,t,n)}}function T(e){return e.createQuery()}e.LineSegmentHintType=void 0,(m=e.LineSegmentHintType||(e.LineSegmentHintType={}))[m.TARGET=0]="TARGET",m[m.REFERENCE=1]="REFERENCE",m[m.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION";const S=Symbol("snapping-toggle");function b(e,n=(()=>{})){const i=t.watch((()=>({view:e.view,snappingOptions:e.snappingOptions})),(({view:t,snappingOptions:i})=>{if(e.removeHandles(S),!t||!i)return;const r=c.ViewEventPriorities.TOOL,o=[t.on("key-down",(e=>{e.key!==l.snappingKeys.toggle||e.repeat||(i.enabledToggled=!0,n())}),r),t.on("key-up",(e=>{e.key===l.snappingKeys.toggle&&(i.enabledToggled=!1,n())}),r),t.on("pointer-move",(e=>{const t=e.native.ctrlKey;i.enabledToggled!==t&&(i.enabledToggled=t,n())}),r)];e.addHandles(o,S)}),t.syncAndInitial);e.addHandles(i)}function v(e){return p.isWebMap(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}e.editEdgeToSnappingEdge=w,e.isUtilityNetworkWebMap=v,e.makeFilter=T,e.makeSnappingQuery=f,e.objectEqual=g,e.screenDistance=y,e.setupSnappingToggleHandles=b,e.sortCandidatesInPlace=E,e.squaredScreenDistance=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
