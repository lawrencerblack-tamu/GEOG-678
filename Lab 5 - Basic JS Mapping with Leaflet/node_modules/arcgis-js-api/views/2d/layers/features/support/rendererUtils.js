/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/screenUtils","../../../../webgl/capabilities"],(function(e,o,t,r,l){"use strict";const s=8,n=s-2,i=()=>t.getLogger("esri.views.2d.layers.features.support.rendererUtils");function a(e){return e.map((e=>u(e)?p(e.clone()):e))}function u(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function p(e){return e.stops=g(e.type,e.stops??[]),e}function c(e,o,t){return(1-t)*e+t*o}function f(e,o){const[t,...l]=o,s=l.pop(),i=l[0].value,a=l[l.length-1].value,u=(a-i)/n,p=[];for(let n=i;n<a;n+=u){let t=0;for(;n>=l[t].value;)t++;const s=l[t],i=o[t-1],a=n-i.value,u=s.value===i.value?1:a/(s.value-i.value);if("color"===e){const e=l[t],r=o[t-1],s=e.color.clone();s.r=c(r.color.r,s.r,u),s.g=c(r.color.g,s.g,u),s.b=c(r.color.b,s.b,u),s.a=c(r.color.a,s.a,u),p.push({value:n,color:s,label:e.label})}else if("size"===e){const e=l[t],s=o[t-1],i=r.toPt(e.size),a=c(r.toPt(s.size),i,u);p.push({value:n,size:a,label:e.label})}else{const e=l[t],r=c(o[t-1].opacity,e.opacity,u);p.push({value:n,opacity:r,label:e.label})}}return[t,...p,s]}function b(e){const[o,...t]=e,r=t.pop();for(;t.length>n;){let e=0,o=0;for(let r=1;r<t.length;r++){const l=t[r-1],s=t[r],n=Math.abs(s.value-l.value);n>o&&(o=n,e=r)}t.splice(e,1)}return[o,...t,r]}function g(e,o){return o.length<=s?o:(i().warn(`Found ${o.length} Visual Variable stops, but MapView only supports ${s}. Displayed stops will be simplified.`),o.length>2*s?f(e,o):b(o))}function y(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:o,supportsColorBufferHalfFloat:t}=l.getWebGLCapabilities();return e&&o||t}function v(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!y()){const e=l.getWebGLCapabilities(),t=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((o=>!e[o])).join(", ");return i().errorOnce(new o("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${t}`)),!1}}return!0}e.isRendererSupported=v,e.simplifyVisualVariables=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
