/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../geohash/GeohashTree","../../../../../geohash/geohashUtils","../../../engine/webgl/definitions"],(function(e,t,i,o){"use strict";class r{constructor(e){this._options=e,this._tree=new t.GeohashTree(e.fields)}insert(e,t){const i=e.getCursor(),o={$view:{scale:0,timeZone:this._options.timeZone}};for(;i.next();)this._insertFeature(i,o,t)}putBins(e,t){this._tree.putBins(e,t)}_insertFeature(e,t,r){const{featureFilter:s,geohashLevel:n,spatialReference:a}=this._options;if(null!==s&&!s.check(e))return;let l=0,h=0;if("esriGeometryPoint"===e.geometryType)l=e.readXWorldSpace(),h=e.readYWorldSpace();else{if(r){const t=e.readCentroidForDisplay();if(null==t)return;const[i,r]=t.coords;if(i<0||i>o.tileSize||r<0||r>o.tileSize)return}const t=e.readCentroidWorldSpace();if(null==t)return;l=t.coords[0],h=t.coords[1]}const c=i.getGeohash(l,h,n,a);c&&this._tree.insert(e,l,h,c[0],c[1],n,t)}}e.GeohashSpatialIndex=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
