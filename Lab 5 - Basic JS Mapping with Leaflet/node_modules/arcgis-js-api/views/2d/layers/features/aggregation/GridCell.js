/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./AccumulatedStatistics"],(function(t,e,i,r){"use strict";class s{static createId(t,e){return`${t}.${e}`}static create(t,e,i,o){return new s(t,e,r.AccumulatedStatistics.create(i),o)}constructor(t,e,i,r){this.gridX=t,this.gridY=e,this._statistics=i,this._worldUnitsPerCell=r,this._count=0,this._xWorldTotal=0,this._yWorldTotal=0,this._objectIds=new Set}get id(){return s.createId(this.gridX,this.gridY)}get count(){return this._count}get statistics(){return this._statistics}get objectIds(){return this._objectIds}get firstObjectId(){return this._objectIds.values().next().value}get centroidXWorld(){return this._xWorldTotal/this._count}get centroidYWorld(){return this._yWorldTotal/this._count}clone(){const t=new s(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);return t._count=this._count,t._xWorldTotal=this._xWorldTotal,t._yWorldTotal=this._yWorldTotal,t._firstFeatureAttributes=this._firstFeatureAttributes,t._objectIds=new Set(this._objectIds),t}insert(t,e,i,r){0===this._count?this._firstFeatureAttributes=t.readAttributes():this._firstFeatureAttributes=null,this._count+=1,this._xWorldTotal+=i,this._yWorldTotal+=r,this._statistics.insert(t,e),this._objectIds.add(t.getObjectId())}merge(t){if(0!==t._count){this._count+=t._count,this._firstFeatureAttributes=t._firstFeatureAttributes,this._xWorldTotal+=t._xWorldTotal,this._yWorldTotal+=t._yWorldTotal,this._statistics.merge(t._statistics);for(const e of t._objectIds.values())this._objectIds.add(e)}}getCentroidX(t){return null==t?this.centroidXWorld:e.quantizeX(t,this.centroidXWorld)}getCentroidY(t){return null==t?this.centroidYWorld:e.quantizeY(t,this.centroidYWorld)}getCentroid(t){const r=new i([],[this.centroidXWorld,this.centroidYWorld]);if(null!=t){const s=new i;return e.quantizeOptimizedGeometry(s,r,!1,!1,"esriGeometryPoint",t)}return r}getGeometricCentroid(t){const r=this.gridX*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,s=this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,o=new i([],[r,s]);if(null!=t){const r=new i;return e.quantizeOptimizedGeometry(r,o,!1,!1,"esriGeometryPoint",t)}return o}getAttributes(){const t={aggregateId:this.id};for(const e of this._statistics.values())t[e.field.name]=e.value;return null!=this._firstFeatureAttributes?{...t,...this._firstFeatureAttributes}:t}}t.GridCell=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
