/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../layers/support/layerUtils","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,l,n,a,o){"use strict";class s{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=l.getFeatureReductionDeconflictionEnabled(t,e)??l.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:l.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const r=this.layer,l=t.getEffectiveLayerCapabilities(r),{capabilities:n,objectIdField:a}=r,o=r.fieldsIndex.toJSON(),s=i.getEffectiveGeometryType(r),c=r.spatialReference.toJSON();return{type:"memory",source:await r.source.openPorts(),orderByFields:a,metadata:{fieldsIndex:o,geometryType:s,objectIdField:a,spatialReference:c,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:n,effectiveCapabilities:l,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t,r){const{definitionExpression:i}=this.layer,l={definitionExpression:i,customParameters:null};return n.createFeatureSourceSchema(e,l,t,r,null)}createProcessorSchema(e,t,i){const{fields:l,renderer:n,geometryType:o,labelingInfo:s,labelsVisible:c,objectIdField:d}=this.layer,u={fields:l.map((e=>e.toJSON())),renderer:n?.clone(),featureReduction:r.getEffectiveFeatureReduction(this.layer,t),geometryType:o,labelingInfo:s,labelsVisible:c,objectIdField:d,orderBy:"default"};return a.createSimpleProcessorSchema(e,t,u,i)}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(e){const t=this.layer,{definitionExpression:i,renderer:l}=t,n=this.layer.labelsVisible?this.layer.labelingInfo:null,a=r.getEffectiveFeatureReduction(t,e)?.toJSON();return{definitionExpression:i,renderer:l,labelingInfo:n,featureReduction:a}}}e.KnowledgeGraphSublayerAdapter=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
