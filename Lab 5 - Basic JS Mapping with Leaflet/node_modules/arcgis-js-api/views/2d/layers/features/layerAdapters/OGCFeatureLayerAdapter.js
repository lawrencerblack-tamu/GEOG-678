/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/lang","../../../../../layers/support/layerUtils","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,a,i,l,o,n,s){"use strict";class c{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=l.getFeatureReductionDeconflictionEnabled(t,e)??l.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:l.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const a=this.layer,l=r.getEffectiveLayerCapabilities(a),{capabilities:o,objectIdField:n}=a,s=a.fieldsIndex.toJSON(),c=i.getEffectiveGeometryType(a),d=a.timeInfo?.toJSON(),u=a.spatialReference.toJSON(),y=a.source.getSource(),f=this.layer.objectIdField,p=t.clone(o);return p.query.maxRecordCount=y.maxRecordCount,{type:"ogc",source:y,orderByFields:f,metadata:{fieldsIndex:s,geometryType:c,objectIdField:n,timeInfo:d,spatialReference:u,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:p,effectiveCapabilities:l,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t,r){const{customParameters:a,timeExtent:i,apiKey:l}=this.layer,n={customParameters:a,timeExtent:i};return o.createFeatureSourceSchema(e,n,t,r,l)}createProcessorSchema(e,t,r){const{fields:i,renderer:l,geometryType:o,labelingInfo:s,labelsVisible:c,orderBy:d,objectIdField:u}=this.layer,y={fields:i.map((e=>e.toJSON())),renderer:l?.clone(),featureReduction:a.getEffectiveFeatureReduction(this.layer,t),geometryType:o,labelingInfo:s,labelsVisible:c,objectIdField:u,orderBy:d??"default"};return n.createSimpleProcessorSchema(e,t,y,r)}get hasRequiredSupport(){return s.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(e){const t=this.layer,{renderer:r,apiKey:i}=t,l=this.layer.labelsVisible?this.layer.labelingInfo:null,o=JSON.stringify(t.customParameters),n=a.getEffectiveFeatureReduction(t,e)?.toJSON();return{apiKey:i,customParameters:o,featureReduction:n,labelingInfo:l,orderBy:JSON.stringify(t.orderBy),renderer:r}}}e.OGCFeatureLayerAdapter=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
