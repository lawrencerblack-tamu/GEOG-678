/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","../../../../../layers/support/layerUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],(function(e,t,r,i,a,l,s,n,o){"use strict";class c{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=l.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:l.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const l=this.layer,s=l.parent,n=i.getEffectiveLayerCapabilities(s),{capabilities:o,editingInfo:c,objectIdField:d,globalIdField:p,datesInUnknownTimezone:y,orderBy:u,subtypeField:f,parsedUrl:m}=s,g=s.fieldsIndex.toJSON(),b=a.getEffectiveGeometryType(l),h=s.timeInfo?.toJSON(),S=l.spatialReference.toJSON(),I=t.clone(m);let E=d;if(u?.length){const e=!u[0].valueExpression&&u[0].field;e&&(E=e)}return{type:"feature-service",source:I,isSourceHosted:r.isHostedAgolService(I.path),orderByFields:E,metadata:{timeReferenceUnknownClient:y,subtypeField:f,globalIdField:p,fieldsIndex:g,geometryType:b,objectIdField:d,timeInfo:h,spatialReference:S,subtypes:null,typeIdField:null,types:null},queryMetadata:{capabilities:o,effectiveCapabilities:n,lastEditDate:c?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(e,t,r){const{definitionExpression:i,customParameters:a,timeExtent:l,apiKey:n}=this.layer.parent,o={definitionExpression:i,customParameters:a,timeExtent:l};return s.createFeatureSourceSchema(e,o,t,r,n)}createProcessorSchema(e,t,r){const{parent:{fields:i,geometryType:a,orderBy:l,objectIdField:s},renderer:o,labelingInfo:c,labelsVisible:d}=this.layer,p={featureReduction:null,fields:i.map((e=>e.toJSON())),geometryType:a,labelingInfo:c,labelsVisible:d,objectIdField:s,orderBy:l??"default",renderer:o?.clone()};return n.createSimpleProcessorSchema(e,t,p,r)}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(e){const t=this.layer,{parent:r,parent:{definitionExpression:i,apiKey:a},renderer:l}=t,s=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:a,customParameters:JSON.stringify(r.customParameters),definitionExpression:i,labelingInfo:s,orderBy:JSON.stringify(r.orderBy),renderer:l}}setGraphicOrigin(e){e.origin={type:"catalog",layer:this.layer}}}e.CatalogFootprintLayerAdapter=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
