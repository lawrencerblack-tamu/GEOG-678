/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","./LabelMatcherSchema","./MatcherSchema","./StorageSchema","./VisualVariablesSchema","../../../../../webgl/capabilities"],(function(e,t,r,a,s,i){"use strict";async function n(e,{subtypeField:t,sublayers:a}){const s=await Promise.all(a.map((({renderer:t})=>r.createMatcherSchema(e,t))));return{type:"subtype",subtypeField:t,renderers:a.reduce(((e,{subtypeCode:t},r)=>({...e,[t]:s[r]})),{})}}function u(e,t){const r=i.getWebGLCapabilities();return{type:"subtype",filters:e.filters,capabilities:{maxTextureSize:r.maxTextureSize},subtypeField:t.subtypeField,target:"feature",bindings:t.sublayers.reduce(((e,{renderer:t,subtypeCode:r})=>({...e,[r]:a.createVVBindings(t)})),{})}}async function c(e,{subtypeField:r,sublayers:a}){const i=await Promise.all(a.map((r=>{const a=s.createVisualVariableUniforms(r.renderer),i={...r,geometryType:r.geometryType??null};return t.createLabelMatcherSchema(e,i,a)})));return{type:"subtype",subtypeField:r,renderers:a.reduce(((e,{subtypeCode:t},r)=>({...e,[t]:i[r]})),{})}}async function l(e,t,r,a){return{storage:u(t,r),mesh:{displayRefreshVersion:a,strategy:{type:"feature"},factory:{symbology:await n(e,r),labels:await c(e,r)},sortKey:null,timeZone:t.timeZone}}}e.createSubtypeProcessorSchema=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
