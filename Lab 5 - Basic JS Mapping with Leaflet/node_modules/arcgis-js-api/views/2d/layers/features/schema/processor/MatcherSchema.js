/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","./VisualVariablesSchema","./symbols/SymbolSchema"],(function(e,a,i){"use strict";async function l(e,a){if(!a)return{type:"simple",meshes:[]};switch(a.type){case"simple":return r(e,a);case"dot-density":return n(e,a);case"class-breaks":return t(e,a);case"unique-value":return o(e,a);case"dictionary":return u(a);case"heatmap":return c(e,a);case"pie-chart":return m(e,a)}}async function s(e,a,l){return{type:"simple",meshes:await i.createSymbolMeshSchemas(a,{schemaOptions:e,path:l,uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null}})}}async function r(e,l){const s=l.getSymbols(),r=s.length?s[0]:null,n=a.createVisualVariableUniforms(l),t="renderer.symbol";return{type:"simple",meshes:await i.createSymbolMeshSchemas(r,{schemaOptions:e,uniforms:n,path:t})}}async function n(e,l){const s=a.createVisualVariableUniforms(l),r="renderer.symbol";return{type:"dot-density",meshes:await i.createDotDensityMeshSchemas(l,{schemaOptions:e,uniforms:s,path:r})}}async function t(e,l){const s=a.createVisualVariableUniforms(l),r=l.backgroundFillSymbol,n=l.normalizationType,t="log"===n?"esriNormalizeByLog":"percent-of-total"===n?"esriNormalizeByPercentOfTotal":"field"===n?"esriNormalizeByField":null,o=l.classBreakInfos.map((async a=>({meshes:await i.createSymbolMeshSchemas(a.symbol,{path:`renderer-stop-${a.minValue}-${a.maxValue}`,schemaOptions:e,uniforms:s}),min:a.minValue,max:a.maxValue}))),u=(await Promise.all(o)).sort(((e,a)=>e.min-a.min)),c=await i.createSymbolMeshSchemas(r,{schemaOptions:e,path:"renderer.backgroundFill",uniforms:{...a.noVisualVariables,visualVariableSizeOutlineScaleStops:s.visualVariableSizeOutlineScaleStops}}),m=await i.createSymbolMeshSchemas(l.defaultSymbol,{schemaOptions:e,path:"renderer.defaultSymbol",uniforms:s});return{type:"interval",field:l.field,expression:l.valueExpression,backgroundFill:c,defaultSymbol:m,intervals:u,normalizationField:l.normalizationField,normalizationTotal:l.normalizationTotal,normalizationType:t,isMaxInclusive:l.isMaxInclusive}}async function o(e,l){const s=[],r=a.createVisualVariableUniforms(l),n=await i.createSymbolMeshSchemas(l.backgroundFillSymbol,{schemaOptions:e,path:"renderer.backgroundFill",uniforms:{...a.noVisualVariables,visualVariableSizeOutlineScaleStops:r.visualVariableSizeOutlineScaleStops}}),t=await i.createSymbolMeshSchemas(l.defaultSymbol,{schemaOptions:e,path:"renderer.defaultSymbol",uniforms:r});for(const a of l.uniqueValueInfos??[]){const l=await i.createSymbolMeshSchemas(a.symbol,{path:`renderer-unique-value-${a.value}`,schemaOptions:e,uniforms:r});s.push({value:""+a.value,symbol:l})}return{type:"map",field:l.field,expression:l.valueExpression,field2:l.field2,field3:l.field3,fieldDelimiter:l.fieldDelimiter,backgroundFill:n,defaultSymbol:t,map:s}}function u(e){const i=a.createVisualVariableUniforms(e),l=e.scaleExpression,s=null!=l&&"1"!==l?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0;return{type:"dictionary",fieldMap:e.fieldMap,scaleExpression:s,visualVariableUniforms:i}}async function c(e,a){return{type:"heatmap",meshes:await i.createHeatmapMeshSchemas(a,e)}}async function m(e,a){return{type:"pie-chart",meshes:i.createPieChartMeshSchemas(a,e)}}e.createMatcherSchema=l,e.createSimpleMatcherSchemaFromSymbol=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
