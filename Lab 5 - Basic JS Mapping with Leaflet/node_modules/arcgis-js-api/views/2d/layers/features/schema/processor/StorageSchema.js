/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../core/arrayUtils","../../../../engine/webgl/enums","../../support/rendererUtils","../../../../../webgl/capabilities"],(function(e,i,n,t,r){"use strict";function s(e,i){return{type:"simple",filters:i,capabilities:{maxTextureSize:r.getWebGLCapabilities().maxTextureSize},bindings:l(e)}}function a(e){switch(e){case"opacity":return n.VVBinding.OPACITY;case"color":return n.VVBinding.COLOR;case"rotation":return n.VVBinding.ROTATION;case"size":return n.VVBinding.SIZE;default:return null}}function l(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return d(e);case"dot-density":return o(e);case"pie-chart":return u(e);case"heatmap":return c(e)}}function o(e){const i=[];for(const n of e.attributes)i.push({binding:i.length,expression:n.valueExpression,field:n.field});return i}function u(e){const i=d(e);let n=4;for(const t of e.attributes)i.push({binding:n++,expression:t.valueExpression,field:t.field});return i}function c({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function d(e){if(!("visualVariables"in e)||!e.visualVariables?.length)return[];return t.simplifyVisualVariables(e.visualVariables).map((e=>x(e))).filter(i.isSome)}function p(e){return"$view.scale"===e.valueExpression?null:{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}function f(e){return{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function g(e){return{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function b(e){return{binding:a(e.type),expression:e.valueExpression,field:e.field}}function x(e){switch(e.type){case"size":return p(e);case"color":return f(e);case"opacity":return g(e);case"rotation":return b(e)}}e.createDotDensityBindings=o,e.createHeatmapBindings=c,e.createPieChartBindings=u,e.createStorageSchema=s,e.createVVBindings=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
