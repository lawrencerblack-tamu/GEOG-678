/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/Error","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../ViewAnimation","./viewpointUtils"],(function(e,t,o,i,r,s,n,a,c,l,g,h,d){"use strict";e.GoToManager=class extends o{constructor(e){super(e),this._gotoTask=null}destroy(){this._gotoTask=null}async goTo(e,t){if(!e)return void r.getLogger(this).error("#goTo()","target cannot be null or undefined");const o=new h;this.view.animation=o,await n.whenOnce((()=>this.view.ready),t);const i={animate:!0,...t},{extent:s,spatialReference:a,size:c,viewpoint:l,constraints:g,padding:w,allLayerViews:p}=this.view,u=d.create(e,{extent:s,spatialReference:a,size:c,viewpoint:l,constraints:g,padding:w,allLayerViews:p,pickClosestTarget:t?.pickClosestTarget??!0});return o?.update(u),this._gotoTask={},i.animate?this._gotoAnimated(u,i):this._gotoImmediate(u,i)}_gotoImmediate(e,t){const o=this._gotoTask,r=this.view.animation,n=e.then((e=>{if(s.throwIfAborted(t),o!==this._gotoTask)throw new i("view:goto-interrupted","Goto was interrupted");this.view.viewpoint=r.target=e,r.finish()}));return this._cancellableGoTo(o,r,n,t)}_gotoAnimated(e,t){const o=this._gotoTask,r=this.view.animation;if(!r)return Promise.resolve();const n=e.then((e=>{if(s.throwIfAborted(t),o!==this._gotoTask)throw new i("view:goto-interrupted","Goto was interrupted");return r.update(e),this.view.animationManager.animate(r,this.view.viewpoint,t),r.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(o,r,n,t)}_cancellableGoTo(e,t,o,i){const r=()=>e===this._gotoTask;return s.whenOrAbort(o,i).finally((()=>{r()&&(t.done||t.stop())}))}},t.__decorate([a.property({constructOnly:!0})],e.GoToManager.prototype,"view",void 0),e.GoToManager=t.__decorate([g.subclass("esri.views.2d.GoToManager")],e.GoToManager),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
