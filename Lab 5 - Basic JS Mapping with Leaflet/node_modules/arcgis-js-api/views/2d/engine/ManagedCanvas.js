/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/Evented","../../../core/events","../../../core/handleUtils","../../../core/has","../../../core/mathUtils","../../../core/libs/gl-matrix-2/math/mat2d","../../../core/libs/gl-matrix-2/factories/mat2df64","../../webgl/contextUtils"],(function(e,t,a,s,r,n,i,o,c){"use strict";class h{constructor(e){this.events=new t,this._hasMajorPerformanceCaveat=!1,this._lastRenderFrameCounter=0,this._canvas=document.createElement("canvas"),this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");const r={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0};e.appendChild(this._canvas);let n=c.createContext(this._canvas,r);n||(n=c.createContext(this._canvas,{...r,failIfMajorPerformanceCaveat:!1}),this._hasMajorPerformanceCaveat=!0),this._gl=n,this._handles=s.handlesGroup([a.on(this._canvas,"webglcontextlost",(e=>this.events.emit("webgl-context-lost",e)))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas),this._canvas=null,this._handles.remove(),this._gl=null}get gl(){return this._gl}render(e,t){if(this._hasMajorPerformanceCaveat||r("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=r("esri-performance-mode-frames-between-render")&&(t(),this._lastRenderViewState=e.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){const[t,a,s,r,n,i]=this._computeViewTransform(this._lastRenderViewState,e.state);this._canvas.style.transform=`matrix(${t}, ${a}, ${s}, ${r}, ${n}, ${i})`}}else t()}resize(e){const t=this._canvas,a=t.style,{state:{size:s},pixelRatio:r}=e,n=s[0],i=s[1],o=Math.round(n*r),c=Math.round(i*r);t.width===o&&t.height===c||(t.width=o,t.height=c),a.width=n+"px",a.height=i+"px"}_computeViewTransform(e,t){const[a,s]=e.center,[r,c]=t.center,[h,l]=e.toScreen([0,0],r,c),[d,m]=e.toScreen([0,0],a,s),_=d-h,v=m-l,f=e.scale/t.scale,g=t.rotation-e.rotation,u=o.create();return i.identity(u),i.scale(u,u,[f,f]),i.rotate(u,u,n.deg2rad(g)),i.translate(u,u,[_,v]),u}}e.ManagedCanvas=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
