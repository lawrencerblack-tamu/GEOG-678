/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","./RasterVFDisplayObject","../webgl/TiledDisplayObject"],(function(t,e,s,i,a){"use strict";class l extends a.TiledDisplayObject{constructor(t,e,s,a,l,r,o=null){super(t,e,s,a,l,r),this.tileData=new i.RasterVFDisplayObject(o),this.tileData.coordScale=[l,r],this.tileData.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(t){this.tileData.stencilRef=t}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{displayViewScreenMat3:s.create(),tileMat3:s.create()}}setTransform(t){super.setTransform(t);const s=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[a,l]=this.tileData.offset,r=[this.x+a*this.resolution,this.y-l*this.resolution],[o,n]=t.toScreenNoRotation([0,0],r),{symbolTileSize:h}=this.tileData.symbolizerParameters,c=Math.round((this.width-this.tileData.offset[0])/h)*h,f=Math.round((this.height-this.tileData.offset[1])/h)*h,u=c/this.rangeX*s,d=f/this.rangeY*s;e.set(i,u,0,0,0,d,0,o,n,1),e.multiply(this.transforms.displayViewScreenMat3,t.displayViewMat3,i),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}}t.RasterVFTile=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
