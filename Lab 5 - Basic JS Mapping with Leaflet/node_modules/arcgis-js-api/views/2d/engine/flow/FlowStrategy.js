/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../../../chunks/tslib.es6","../../../../geometry","../../../../core/Accessor","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Point","./FlowDisplayData","./FlowDisplayObject","../../../../geometry/Extent"],(function(t,e,o,i,a,l,s,r,n,c,d,p,h,y){"use strict";const u=1.15;let _=class extends o{constructor(t){super(t),this._flowDisplayObject=new h.FlowDisplayObject,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:e}=this.flowContainer;if(null==e)return void this._clear();const{extent:o,rotation:a,resolution:s,pixelRatio:r}=t.state,n=g(o,a);n.expand(u);const c=[Math.round((n.xmax-n.xmin)/s),Math.round((n.ymax-n.ymin)/s)],d=new p(e,n,c,r);if(null!=this._loading){if(this._loading.update(d))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(d)||(d.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{l.isAbortError(t)||(i.getLogger(this).error("A resource failed to load.",t),this._loading=null)})),this._loading=d)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}};t.__decorate([s.property()],_.prototype,"_loading",void 0),t.__decorate([s.property()],_.prototype,"flowContainer",void 0),t.__decorate([s.property()],_.prototype,"updating",null),_=t.__decorate([c.subclass("esri.views.2d.engine.flow.FlowStrategy")],_);function g(t,e){const o=new d({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),i=t.xmax-t.xmin,l=t.ymax-t.ymin,s=Math.abs(Math.cos(a.deg2rad(e))),r=Math.abs(Math.sin(a.deg2rad(e))),n=s*i+r*l,c=r*i+s*l,p=new y({xmin:o.x-n/2,ymin:o.y-c/2,xmax:o.x+n/2,ymax:o.y+c/2,spatialReference:t.spatialReference});return p.centerAt(o),p}return _}));
