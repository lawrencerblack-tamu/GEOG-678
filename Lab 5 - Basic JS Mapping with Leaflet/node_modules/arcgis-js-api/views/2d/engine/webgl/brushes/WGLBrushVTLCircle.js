/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../vectorTiles/style/StyleDefinition","./WGLBrush","../../../../webgl/enums"],(function(e,t,r,i){"use strict";class n extends r{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,r){const{context:n,displayLevel:a,requiredLevel:l,state:s,painter:o,spriteMosaic:c,styleLayerUID:u,requestRender:d,allowDelayedRender:y}=e;if(!r.some((e=>e.layerData.get(u)?.circleIndexCount??!1)))return;const f=e.styleLayer,p=f.circleMaterial,m=o.vectorTilesMaterialManager,g=1.2,v=f.getPaintValue("circle-translate",a),M=f.getPaintValue("circle-translate-anchor",a),T=this._programOptions,E=m.getMaterialProgram(n,p,T);if(y&&null!=d&&!E.compiled)return void d();n.useProgram(E),E.setUniformMatrix3fv("u_displayMat3",M===t.TranslateAnchor.VIEWPORT?s.displayMat3:s.displayViewMat3),E.setUniform2fv("u_circleTranslation",v),E.setUniform1f("u_depth",f.z),E.setUniform1f("u_antialiasingWidth",g);let x=-1;for(const t of r){if(!t.layerData.has(u))continue;t.key.level!==x&&(x=t.key.level,p.setDataUniforms(E,a,f,x,c));const e=t.layerData.get(u);if(!e.circleIndexCount)continue;e.prepareForRendering(n);const r=e.vao;null!=r&&(n.bindVAO(r),E.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),l!==t.key.level?n.setStencilFunction(i.CompareFunction.EQUAL,t.stencilRef,255):n.setStencilFunction(i.CompareFunction.GREATER,255,255),n.drawElements(i.PrimitiveType.TRIANGLES,e.circleIndexCount,i.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),t.triangleCount+=e.circleIndexCount/3)}}}e.WGLBrushVTLCircle=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
