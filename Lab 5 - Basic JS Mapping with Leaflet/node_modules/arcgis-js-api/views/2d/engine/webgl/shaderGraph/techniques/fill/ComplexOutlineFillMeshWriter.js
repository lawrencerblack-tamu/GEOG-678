/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","./ComplexFillMeshWriter","./meshWriterUtils","./OutlineFillMeshWriter","../shaders/ComplexOutlineFillShader","../shaders/constants","../../../../../../webgl/enums"],(function(e,t,i,r,s,a,n,o,l){"use strict";const p=r.complexFillVertexSpec.attributes,c=a.outlineFillVertexSpec_Outline.attributes,u={createComputedParams:e=>e,attributes:{id:p.id,pos:p.pos,zoomRange:p.zoomRange,tlbr:p.tlbr,angle:p.angle,color:p.color,bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:e=>r.packComplexFillBitset(e)},aux1:{count:1,type:l.DataType.UNSIGNED_SHORT,pack:e=>r.packComplexFillWidth(e)},aux2:{count:1,type:l.DataType.UNSIGNED_SHORT,pack:e=>r.packComplexFillHeight(e)},aux3:{count:2,type:l.DataType.SHORT,pack:({offsetX:e,offsetY:i})=>[t.pt2px(e),t.pt2px(i)]},aux4:{count:2,type:l.DataType.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*n.packPrecision,t*n.packPrecision]}}},d={createComputedParams:e=>e,attributes:{id:p.id,pos:p.pos,zoomRange:p.zoomRange,tlbr:p.tlbr,angle:p.angle,color:c.color,bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:e=>s.packBitset([[o.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:l.DataType.UNSIGNED_SHORT,pack:e=>t.pt2px(.5*e.width)*n.packPrecision},aux2:{count:1,type:l.DataType.UNSIGNED_SHORT,pack:e=>t.pt2px(.5*e.referenceWidth)*n.packPrecision},aux3:{count:2,type:l.DataType.SHORT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e*n.packPrecision,t*n.packPrecision]},aux4:{count:2,type:l.DataType.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*n.packPrecision+n.signedToUnsignedByte,t*n.packPrecision+n.signedToUnsignedByte]}}};class y extends a.OutlineFillOutlineMeshWriter{constructor(){super(...arguments),this.vertexSpec=d}}class m extends a.OutlineFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=u}_createOutlineWriter(e,t,i,r){return new y(e,t,i,r)}_write(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay(),a=this._clip(s);if(!a)return;const n=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(e,t,a),this._lineMeshWriter.writeLineVertices(e,i.GeometryCursor.fromOptimizedCIM(a,"esriGeometryPolyline"),t),e.recordEnd()}ensurePacked(e,t,i){super.ensurePacked(e,t,i),this._lineMeshWriter.ensurePacked(e,t,i)}enqueueRequest(e,t,i){super.enqueueRequest(e,t,i),this._lineMeshWriter.enqueueRequest(e,t,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.ComplexOutlineFillMeshWriter=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
