/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],(function(e,t,r,s,i){"use strict";const n=100,o=t("featurelayer-fast-triangulation-enabled");class a extends i.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),r.loadLibtess()])}_write(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(s);i&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,i),e.recordEnd())}_clip(e){if(!e)return null;const t=this.hasEffects?256:8;return s.clipMarshall(e,t)}_writeGeometry(e,t,r){const i=r.maxLength>n,a=[],l=this.createTesselationParams(t);if(!i&&o&&s.triangulate(a,r))return void(a.length&&this._writeVertices(e,t,r.coords,l,a));const c=s.triangulateLibtess(r);this._writeVertices(e,t,c,l)}_writeVertices(e,t,r,s,i){const n=t.getDisplayId(),o=e.vertexCount(),a=this.hasEffects;let l=0;if(i)for(const c of i){const t=r[2*c],i=r[2*c+1];a&&e.recordBounds(t,i,0,0),this._writeVertex(e,n,t,i,s),l++}else for(let c=0;c<r.length;c+=2){const t=Math.round(r[c]),i=Math.round(r[c+1]);a&&e.recordBounds(t,i,0,0),this._writeVertex(e,n,t,i,s),l++}e.indexEnsureSize(l);for(let c=0;c<l;c++)e.indexWrite(c+o)}}e.AFillMeshWriter=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
