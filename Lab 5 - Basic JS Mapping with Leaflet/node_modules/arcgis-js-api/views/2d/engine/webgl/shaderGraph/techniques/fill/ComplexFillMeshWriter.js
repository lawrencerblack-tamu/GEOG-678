/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../../core/screenUtils","../../../../vectorTiles/GeometryUtils","../../../definitions","./meshWriterUtils","./PatternFillMeshWriter","../shaders/constants","../../../../../../webgl/enums"],(function(t,e,i,o,s,r,a,n){"use strict";function p(t){const{sprite:i,aspectRatio:o,scaleProportionally:s}=t,r=e.pt2px(t.height),a=r>0?r:i.height;let n=r*o;return n<=0?n=i.width:s&&(n*=i.width/i.height),{width:n,height:a}}function c(t){const{applyRandomOffset:e,sampleAlphaOnly:i}=t,{width:r,height:n}=p(t),c=n<o.maxSizeForU16Compression,l=r<o.maxSizeForU16Compression;return s.packBitset([[a.bitsetFillRandomPatternOffset,e],[a.bitsetGenericConsiderAlphaOnly,i],[a.bitsetFillPatternWidthIsCompressed,l],[a.bitsetFillPatternHeightIsCompressed,c]])}function l(t){const{width:e}=p(t);return Math.round(e<o.maxSizeForU16Compression?e*o.compressionFactorForU16:e)}function h(t){const{height:e}=p(t);return Math.round(e<o.maxSizeForU16Compression?e*o.compressionFactorForU16:e)}const m={createComputedParams:t=>t,attributes:{...r.patternFillVertexSpec.attributes,bitset:{count:1,type:n.DataType.UNSIGNED_BYTE,pack:c},width:{count:1,type:n.DataType.UNSIGNED_SHORT,pack:l},height:{count:1,type:n.DataType.UNSIGNED_SHORT,pack:h},offset:{count:2,type:n.DataType.SHORT,pack:({offsetX:t,offsetY:i})=>[e.pt2px(t),-e.pt2px(i)]},scale:{count:2,type:n.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:t,scaleY:e})=>[t,e]},angle:{count:1,type:n.DataType.UNSIGNED_BYTE,pack:({angle:t})=>i.degToByte(t)}}};class u extends r.PatternFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=m}}t.ComplexFillMeshWriter=u,t.complexFillVertexSpec=m,t.packComplexFillBitset=c,t.packComplexFillHeight=h,t.packComplexFillWidth=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
