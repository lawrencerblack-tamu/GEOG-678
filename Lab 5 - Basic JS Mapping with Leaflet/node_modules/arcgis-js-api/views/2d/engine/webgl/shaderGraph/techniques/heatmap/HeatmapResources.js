/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../../core/Logger","../../../../../../../core/maybe","../../../../../../webgl/enums","../../../../../../webgl/FramebufferObject","../../../../../../webgl/heatmapTextureUtils","../../../../../../webgl/RenderbufferDescriptor","../../../../../../webgl/Texture","../../../../../../webgl/TextureDescriptor"],(function(e,r,t,a,i,u,s,l,n){"use strict";const o=()=>r.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources");class c{destroy(){this._accumulateFramebuffer=t.disposeMaybe(this._accumulateFramebuffer),this._resolveGradientTexture=t.disposeMaybe(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){const r=u.loadHeatmapTextureConfiguration(e,o());this._qualityProfile={...r,defines:{usesHalfFloatPrecision:r.dataType!==a.PixelType.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(e,r,t){if(null==this._accumulateFramebuffer){const{dataType:u,samplingMode:l,pixelFormat:o,internalFormat:c}=this.loadQualityProfile(e),f=new n.TextureDescriptor(r,t);f.pixelFormat=o,f.internalFormat=c,f.dataType=u,f.samplingMode=l,f.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;const d=new s.RenderbufferDescriptor(a.RenderbufferFormat.DEPTH_STENCIL,r,t);this._accumulateFramebuffer=new i.FramebufferObject(e,f,d)}else{const{width:e,height:a}=this._accumulateFramebuffer;e===r&&a===t||this._accumulateFramebuffer.resize(r,t)}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,r,t){if(null==this._resolveGradientTexture){const r=new n.TextureDescriptor;r.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE,this._resolveGradientTexture=new l.Texture(e,r)}else this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(t.length/4,1),this._resolveGradientTexture.setData(t),this._prevGradientHash=r);return this._resolveGradientTexture}}e.HeatmapResources=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
