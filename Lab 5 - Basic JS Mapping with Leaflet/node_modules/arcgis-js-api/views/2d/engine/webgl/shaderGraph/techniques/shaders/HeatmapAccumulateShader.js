/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./heatmapUtils","./hittestUtils"],(function(t,e,i,o,a,l,s){"use strict";class r extends a.FeatureVertexInput{}e.__decorate([i.location(5,o.Vec2)],r.prototype,"offset",void 0);class n extends a.FeatureFragmentInput{}class u extends i.UniformGroup{}e.__decorate([i.uniform(o.Float)],u.prototype,"radius",void 0),e.__decorate([i.uniform(o.Float)],u.prototype,"isFieldActive",void 0);class p extends a.AFeatureShader{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1}vertex(t){const{radius:e,isFieldActive:i}=this.kernelControls,a=t.offset,l=i.multiply(this.storage.getVVData(t.id).x).add(new o.Float(1).subtract(i)),s=this.view.displayViewScreenMat3.multiply(new o.Vec3(t.pos,1)).add(this.view.displayViewMat3.multiply(new o.Vec3(a,0)).multiply(e)),r=this.clip(t.id);return{glPosition:new o.Vec4(s.xy,r,1),offset:a,fieldValue:l,color:new o.Vec4(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:i}=t,a=o.length(e),s=o.step(a,new o.Float(1)),r=new o.Float(1).subtract(a.multiply(a)),n=r.multiply(r),u=s.multiply(n).multiply(i).multiply(new o.Float(l.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new o.Vec4(u),t)}hittest(t){const{viewMat3:e,tileMat3:i}=this.view,a=e.multiply(i).multiply(new o.Vec3(t.pos,1));return s.hittestMarker(a.xy,this.kernelControls.radius,this.hittestRequest.position)}}e.__decorate([i.define],p.prototype,"usesHalfFloatPrecision",void 0),e.__decorate([i.uniform(u)],p.prototype,"kernelControls",void 0),e.__decorate([e.__param(0,i.input(r))],p.prototype,"vertex",null),e.__decorate([e.__param(0,i.input(n))],p.prototype,"fragment",null),t.HeatmapAccumulateFragmentInput=n,t.HeatmapAccumulateShader=p,t.HeatmapAccumulateVertexInput=r,t.KernelControls=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
