/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../../chunks/tslib.es6","../../../definitions","../../GraphShaderModule","../../graph/glsl","../shaders/AFeatureShader","../shaders/hittestUtils","../shaders/utils"],(function(t,e,o,i,r,s,a,n){"use strict";class l extends s.FeatureVertexInput{}e.__decorate([i.location(3,r.Float)],l.prototype,"inverseArea",void 0);class d extends s.FeatureFragmentInput{}class p extends i.UniformGroup{}e.__decorate([i.uniform(r.FixedArray.ofType(r.Vec4,2))],p.prototype,"isActive",void 0),e.__decorate([i.uniform(r.FixedArray.ofType(r.Vec4,8))],p.prototype,"colors",void 0),e.__decorate([i.uniform(r.Float)],p.prototype,"dotValue",void 0);class u extends i.UniformGroup{}e.__decorate([i.uniform(r.Sampler2D)],u.prototype,"dotTexture0",void 0),e.__decorate([i.uniform(r.Sampler2D)],u.prototype,"dotTexture1",void 0),e.__decorate([i.uniform(r.Float)],u.prototype,"tileZoomFactor",void 0),e.__decorate([i.uniform(r.Float)],u.prototype,"pixelRatio",void 0),e.__decorate([i.uniform(r.Float)],u.prototype,"tileDotsOverArea",void 0);class c extends s.AFeatureShader{_dotThreshold(t,e,o){return t.divide(e).divide(o)}vertex(t){const e=new r.Mat3(2/o.tileSize,0,0,0,-2/o.tileSize,0,-1,1,1).multiply(new r.Vec3(t.pos,1)),i=this.clip(t.id),s=new r.Vec4(e.xy,i,1),a=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),n=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),l=this.draw.tileZoomFactor.multiply(o.tileSize).divide(this.draw.pixelRatio),d=this._dotThreshold(a,this.instance.dotValue,this.draw.tileDotsOverArea),p=this._dotThreshold(n,this.instance.dotValue,this.draw.tileDotsOverArea),u=t.pos.add(.5).divide(l);return{glPosition:s,color:new r.Vec4(0,0,0,0),textureCoords:u,thresholds0:d,thresholds1:p}}fragment(t){const e=new i.FragmentOutput,o=r.texture2D(this.draw.dotTexture0,t.textureCoords),s=r.texture2D(this.draw.dotTexture1,t.textureCoords),a=t.thresholds0.subtract(o),l=t.thresholds1.subtract(s);let d;const p=r.Mat4.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),u=r.Mat4.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const t=r.step(new r.Float(0),a),e=r.step(new r.Float(0),l),o=r.dot(t,a).add(r.dot(e,l)),i=r.step(o,new r.Float(0)),s=new r.Float(1).subtract(i),n=o.add(i),c=a.multiply(t).divide(n),h=l.multiply(e).divide(n),m=p.multiply(c).add(u.multiply(h));d=s.multiply(m)}else{const t=r.max(n.max4(a),n.max4(l)),e=r.step(t,new r.Float(0)),o=new r.Float(1).subtract(e),i=r.step(t,a),s=r.step(t,l),c=p.multiply(i).add(u.multiply(s));d=o.multiply(c)}return e.glFragColor=d,e}hittest(t){return a.failHittest(this.hittestRequest)}}e.__decorate([i.define],c.prototype,"blending",void 0),e.__decorate([i.uniform(p)],c.prototype,"instance",void 0),e.__decorate([i.uniform(u)],c.prototype,"draw",void 0),e.__decorate([e.__param(0,i.input(l))],c.prototype,"vertex",null),e.__decorate([e.__param(0,i.input(s.FeatureFragmentInput))],c.prototype,"fragment",null),t.DotDensityPolygonDrawUniforms=u,t.DotDensityPolygonFragmentInput=d,t.DotDensityPolygonInstanceUniforms=p,t.DotDensityPolygonShader=c,t.DotDensityPolygonVertexInput=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
