/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],(function(t,e,s,a){"use strict";function n(t){switch(t){case a.DataType.BYTE:case a.DataType.UNSIGNED_BYTE:return 1;case a.DataType.SHORT:case a.DataType.UNSIGNED_SHORT:return 2;case a.DataType.FLOAT:case a.DataType.INT:case a.DataType.UNSIGNED_INT:return 4}}function o(t){const e=[],s=[],a=[];for(const o of t){const t=n(o.type)*o.count;switch(t%2||t%4||4){case 4:e.push(o);continue;case 2:s.push(o);continue;case 1:a.push(o);continue;default:throw new Error("Found unexpected dataType byte count")}}return e.push(...s),e.push(...a),e}class i{static fromVertexSpec({attributes:t},e){let s,a,r;const c=[];for(const n in t){const o=t[n];!1!==e?.[n]&&("position"===o.pack?s={...o,name:n,offset:0}:"id"===o.pack?a={...o,name:n,offset:4}:"bitset"===n?r={...o,name:n,offset:7}:c.push({...o,name:n}))}const u=o(c),p=[];let h=8,f=1;for(const o of u)p.push({...o,offset:h}),h+=n(o.type)*o.count,o.packAlternating&&(f=Math.max(o.packAlternating.count,f));const y=Uint32Array.BYTES_PER_ELEMENT,T=h%y;return new i(s,a,r,p,h+(T?y-T:0),f)}constructor(t,e,s,a,n,o){this.position=t,this.id=e,this.bitset=s,this.standardAttributes=a,this.stride=n,this.packVertexCount=o,a.push(s),this._attributes=[t,e,s,...a]}get attributeLayout(){if(!this._attributeLayout){const t=s.vertexLayoutHash(this._attributes),e=this._attributes.map((t=>({name:t.name,count:t.count,offset:t.offset,type:t.type,packPrecisionFactor:t.packPrecisionFactor,normalized:t.normalized??!1})));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}}t.AlignedVertexSpec=i,t.sortByAlignment=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
