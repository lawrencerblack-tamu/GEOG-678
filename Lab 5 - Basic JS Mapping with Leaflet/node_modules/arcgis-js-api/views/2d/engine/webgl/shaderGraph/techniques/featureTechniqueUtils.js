/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../../core/has","../../../../../../core/unitUtils","../../definitions","../../enums","../../../../../webgl/enums"],(function(e,t,i,n,o,r){"use strict";const s={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:r.CompareFunction.EQUAL,mask:255,op:{fail:r.StencilOperation.KEEP,zFail:r.StencilOperation.KEEP,zPass:r.StencilOperation.REPLACE}}}},l={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},a={...s,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};function c({pixelRatio:e,state:t,displayLevel:n,requiredLevel:o},r){const s=1/2**(n-r.key.level),l=1/2**(o-r.key.level);return{displayMat3:Array.from(t.displayMat3),displayViewMat3:Array.from(t.displayViewMat3),displayViewScreenMat3:Array.from(r.transforms.displayViewScreenMat3),viewMat3:Array.from(t.viewMat3),tileMat3:Array.from(r.transforms.tileMat3),displayZoomFactor:s,requiredZoomFactor:l,tileOffset:[r.x,r.y],currentScale:t.scale,currentZoom:n,metersPerSRUnit:i.getMetersPerUnitForSR(t.spatialReference),rotation:t.rotation,pixelRatio:e}}function f(e){return"highlight"===e.passOptions?.type}function p(e){return"hittest"===e.passOptions?.type}function u(e){if(!p(e))return null;const{position:i}=e.passOptions,n=e.pixelRatio,o=t("esri-mobile");return{position:i,distance:t(o?"hittest-2d-mobile-tolerance":"hittest-2d-desktop-tolerance")*n,smallSymbolDistance:t(o?"hittest-2d-mobile-tolerance":"hittest-2d-small-symbol-tolerance")*n,smallSymbolSizeThreshold:t("hittest-2d-small-symbol-tolerance-threshold")}}function m(e){if(!f(e))return null;const{activeReasons:t,highlightAll:i}=e.passOptions;return{activeReasons:t,highlightAll:i?1:0}}function d(e,t,i){const n={};for(const o in i)i[o]instanceof Function?n[o]=i[o](e,t):n[o]=i[o];return n}function h(e,t){const{attributeView:i,context:n}=e;return{storage:i.getUniforms(n),view:c(e,t),hittestRequest:u(e),highlight:m(e)}}function y(e){return{inside:e.selection===o.FeatureSelection.InsideEffect,outside:e.selection===o.FeatureSelection.OutsideEffect}}function g(e){return p(e)?l:f(e)&&"clear"===e.passOptions.stepType?a:s}function S(e){const{row:t,col:i}=e.key,o=i*n.tileSize,r=t*n.tileSize;return{tileOffsetFromLocalOrigin:[o%n.maxRepresentableInt,r%n.maxRepresentableInt],maxIntsToLocalOrigin:[Math.floor(o/n.maxRepresentableInt),Math.floor(r/n.maxRepresentableInt)]}}e.getFeaturePipelineState=g,e.getFeatureUniforms=h,e.getLocalTileOffset=S,e.getSelectionDefines=y,e.getViewUniforms=c,e.isHighlight=f,e.isHittest=p,e.resolveDynamicUniforms=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
