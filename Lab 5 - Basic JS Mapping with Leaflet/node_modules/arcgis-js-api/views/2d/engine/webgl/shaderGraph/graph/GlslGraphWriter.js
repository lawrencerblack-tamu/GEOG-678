/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports"],(function(e){"use strict";const t=5;function r(e,t,r){const n=t.split("\n");for(const i of n)if(i.trim().length){{let t="";null!=r&&(t+=`/*id:${r??"000"}*/   `),e.body+=t.padEnd(14)}e.body+=" ".repeat(e.indent)+i+"\n"}}class n{write(e){for(const t of e.rootOutputNodes())e.shouldPruneOutputNode(t)||(t.variableName=this._write(e,t.node));return e}_createVarName(e,t){let r="";return"boolean"!=typeof t&&"number"!=typeof t&&t.debugInfo.name&&(r=`${t.debugInfo.name}_`),`${r}v${e.varCount++}`}_write(e,t,r=!1){if("number"==typeof t)return t.toString();if("boolean"==typeof t)return t.toString();let n=e.getEmit(t);if(n)return n;switch(t.shaderType){case"scope-node":n=this._writeScopeNode(e,t);break;case"primitive-node":n=this._writePrimitveNode(e,t,r);break;case"function-node":n=this._writeFunctionNode(e,t);break;case"property-access-node":n=this._writePropertyAccessNode(e,t);break;case"text-node":n=t.text;break;case"block-node":n=this._writeBlockNode(e,t);break;case"condition-node":n=this._writeConditionNode(e,t)}return e.setEmit(t,n),n}_writeScopeNode(e,t){const n=new t.child.constructor;n.setDebugName(t.debugInfo.name);const i=this._write(e,n,!0);r(e,`{ /*ScopeStart: ${t.uid} ${t.debugInfo.name}*/`),e.indent+=2;return r(e,`${i} = ${this._write(e,t.child)};`),e.indent-=2,r(e,`} /*ScopeEnd: ${t.uid} ${t.debugInfo.name}*/`),i}_writeConditionNode(e,t){const n=new t.ifTrue.constructor,i=this._write(e,n,!0);r(e,`if (${this._write(e,t.condition)}) {`),e.indent+=2;const o=e.createSubgraphContext(),d=this._write(o,t.ifTrue);if(e.body+=o.body,d&&r(e,`${i} = ${d};`),e.indent-=2,r(e,"}"),t.ifFalse){r(e,"else {"),e.indent+=2;const n=e.createSubgraphContext(),o=this._write(n,t.ifFalse);e.body+=n.body,o&&r(e,`${i} = ${o};`),e.indent-=2,r(e,"}")}return i}_writeBlockNode(e,t){const{captureList:n,generator:i,returnType:o}=t,d={};for(const r in n){if(!n[r])continue;const t=this._write(e,n[r]);d[r]=t}const s=new o,c=this._write(e,s,!0);if(d.out=c,t.subgraph){const r=e.createSubgraphContext(),n=this._write(r,t.subgraph.child),i=r.body;d.subgraph={varName:n,body:i}}const a=i(d);return r(e,"{\n"),e.indent+=2,r(e,a),e.indent-=2,r(e,"}\n"),c}_writePropertyAccessNode(e,t){const r=this._write(e,t.target);if("string"==typeof t.property&&t.property.includes("["))return`${r}${t.property}`;if("string"!=typeof t.property){return`${r}[${this._write(e,t.property)}]`}return`${r}.${t.property}`}_writeFunctionNode(e,n){const i=n.returnType.type;if(n.isInfix){const[o,d]=n.children.map((t=>this._write(e,t))),s=this._createVarName(e,n);return r(e,`${i.padEnd(t)} ${s} = ${o} ${n.token} ${d};`,n.uid),s}const o=n.children.map((t=>this._write(e,t))).join(", "),d=this._createVarName(e,n);return r(e,`${i.padEnd(t)} ${d} = ${n.token}(${o});`,n.uid),d}_writePrimitveNode(e,n,i=!1){const o=e.getInput(n);if(o)return o.isUsed=!0,o.variableName;const d=1===n.children.length&&n.children[0]?.type===n.type;if(n.isImplicit||d)return this._write(e,n.children[0]);const s=this._createVarName(e,n);if(i)return r(e,`${n.type.padEnd(t)} ${s};`,n.uid),s;const c=!n.debugInfo.name&&!n.isMutable;if(c&&"float"===n.type&&"number"==typeof n.children[0])return Number.isInteger(n.children[0])?n.children[0].toFixed(1):n.children[0].toString();if(c&&"int"===n.type&&"number"==typeof n.children[0]&&Number.isInteger(n.children[0]))return n.children[0].toString();const a=n.children.map((t=>this._write(e,t))).join(", ");return"array"===n.type?(r(e,`${n.type.padEnd(t)} ${s} = [${a}];`,n.uid),s):c?`${n.type}(${a})`:(r(e,`${n.type.padEnd(t)} ${s} = ${n.type}(${a});`,n.uid),s)}}e.GlslShaderWriter=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
