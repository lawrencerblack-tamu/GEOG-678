/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../shaderGraph/techniques/mesh/createMeshWriter","./Matcher"],(function(e,t,l){"use strict";class s extends l.FeatureMatcher{constructor(e,t){super(),this._defaultSymbolSortKey=0,this._nullResult=null,this._resultsMap=new Map,this._fields=[],this._fields=e,this._separator=t||""}static async fromMatcherSchema(e,l,r,i){const u=r.expression?[e.createComputedField({expression:r.expression})]:[r.field?e.createComputedField({field:r.field}):null,r.field2?e.createComputedField({field:r.field2}):null,r.field3?e.createComputedField({field:r.field3}):null],a=(await Promise.all(u)).filter((e=>!!e)),o=new s(a,r.fieldDelimiter),n=await t.createMeshWriterGroupFromSchema(e,l,r.defaultSymbol,i);o.setDefault(n);const d=await t.createMeshWriterGroupFromSchema(e,l,r.backgroundFill,i);return o.setBackgroundFill(d),await Promise.all(r.map.map((async(s,r)=>{const u=await t.createMeshWriterGroupFromSchema(e,l,s.symbol,i);"<Null>"===s.value?o.setNullResult(u):o.add(s.value,u,r+1)}))),o}setNullResult(e){this._nullResult=e}getSortKey(e,t){const l=this._getValueFromFields(e,t);if(null==l||""===l||"<Null>"===l)return 0;const s=this._resultsMap.get(l.toString());return s?s.sortKey:this._defaultSymbolSortKey}add(e,t,l){this._resultsMap.set(e.toString(),{meshWriters:t,sortKey:l}),this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,l+1)}size(){return super.size()+this._resultsMap.size}doMatch(e,t){const l=this._getValueFromFields(e,t);if(null!==this._nullResult&&(null==l||""===l||"<Null>"===l))return this._nullResult;if(null==l)return null;const s=l.toString();return this._resultsMap.get(s)?.meshWriters}_getValueFromFields(e,t){const l=[];for(const s of this._fields){const r=s.read(e,t);null==r||""===r?l.push("<Null>"):l.push(r)}return l.join(this._separator)}}e.MapMatcher=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
