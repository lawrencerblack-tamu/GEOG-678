/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","./definitions","../../../../webgl/BufferObject","../../../../webgl/enums","../../../../webgl/VertexArrayObject","../../../../webgl/VertexElementDescriptor"],(function(t,e,r,n,s,o){"use strict";class i{constructor(t,e){this._boundPart=null;const i=[];for(const s of e.vertex){const e=r.BufferObject.createVertex(t,n.Usage.STATIC_DRAW,s);i.push(e)}const a=[];for(const s of e.index||[]){const e=r.BufferObject.createIndex(t,n.Usage.STATIC_DRAW,s);a.push(e)}this.groups=[];for(const r of e.groups){let u;if(null!=r.index){if(!e.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:t}=e.index[r.index];2===t?u=n.DataType.UNSIGNED_SHORT:4===t&&(u=n.DataType.UNSIGNED_INT)}const d=null!=r.index?a[r.index]:null,c=new Map,l={},f={};for(const t of r.attributes){const{name:e,count:r,type:n,offset:s,normalized:a,divisor:u,stride:d,vertex:p,location:b}=t,h=`vertex-buffer-${p}`;let x=l[h];x||(x=l[h]=[]);const g=new o.VertexElementDescriptor(e,r,n,s,d,a,u);x.push(g),c.set(e,b),f[h]=i[p]}const p=new s.VertexArrayObject(t,c,l,f,d);this.groups.push({...r,vertexArray:p,locations:c,layout:l,indexing:u})}this.parts=e.parts}bind(t,e){this._boundPart=e;const{group:r}=this.parts[this._boundPart],{vertexArray:n}=this.groups[r];t.bindVAO(n)}draw(t){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:r,count:n}=this.parts[this._boundPart],{group:s}=this.parts[this._boundPart],{indexing:o,primitive:i}=this.groups[s];o?t.drawElements(i,n,o,r*e.dataSizeInBytes[o]):t.drawArrays(i,r,n)}unbind(t){this._boundPart=null,t.bindVAO(null)}destroy(){for(const{vertexArray:t}of this.groups)t.dispose()}}t.Mesh=i,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
