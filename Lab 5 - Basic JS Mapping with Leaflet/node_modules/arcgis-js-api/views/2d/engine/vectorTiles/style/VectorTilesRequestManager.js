/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../../../request","../../../../../core/lang","../../../../../core/MapUtils","../../../../../core/promiseUtils","../../../../../core/urlUtils"],(function(t,e,r,o,s,i){"use strict";class n{constructor(t){this._tileUrl=t,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(t){(null==this._promise||s.isAborted(this._abortController?.signal))&&(this._promise=this._makeRequest(this._tileUrl));const e=this._abortOptions;return e.push(t),s.onAbort(t,(()=>{e.every((t=>s.isAborted(t)))&&this._abortController.abort()})),this._promise.then((t=>r.clone(t)))}async _makeRequest(t){this._abortController=new AbortController;const{data:r}=await e(t,{responseType:"array-buffer",signal:this._abortController.signal});return r}}const l=new Map;function a(t,e,r,o,s){const n=i.urlToObject(t),l=n.query;if(l)for(const[i,c]of Object.entries(l))switch(c){case"{x}":l[i]=o.toString();break;case"{y}":l[i]=r.toString();break;case"{z}":l[i]=e.toString()}const a=n.path;return c(i.addQueryParameters(a.replaceAll(/\{z\}/gi,e.toString()).replaceAll(/\{y\}/gi,r.toString()).replaceAll(/\{x\}/gi,o.toString()),{...n.query}),s)}function c(t,e){return o.getOrCreateMapValue(l,t,(()=>new n(t))).getData(e).finally((()=>l.delete(t)))}t.request=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
