/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../enums","../GeometryUtils","./core"],(function(t,e,s,o){"use strict";function i(t,e,s,o,i,l){const r=s-i;if(r>=0)return(e>>r)+(o-(l<<r))*(t>>r);const n=-r;return e-(l-(o<<n))*(t>>n)<<n}class l{constructor(t,e,s){this._rows=Math.ceil(e/s),this._columns=Math.ceil(t/s),this._cellSize=s,this.cells=new Array(this._rows);for(let o=0;o<this._rows;o++){this.cells[o]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[o][t]=[]}}getCell(t,e){const s=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1),o=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[s]&&this.cells[s][o]||null}getCellSpan(t,e,s,o){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(o/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function r(t,e,s,i,l,r,n){const c=e[i++];for(let a=0;a<c;a++){const c=new o.VTLSymbol(r,n);c.xTile=e[i++],c.yTile=e[i++],c.hash=e[i++],c.priority=e[i++],c.featureIndex=e[i++];const a=e[i++];for(let t=0;t<a;t++){const t=e[i++],o=e[i++],l=e[i++],r=e[i++],n=!!e[i++],a=e[i++],h=s[i++],u=s[i++],f=e[i++],m=e[i++];c.colliders.push({xTile:t,yTile:o,dxPixels:l,dyPixels:r,hard:n,partIndex:a,width:f,height:m,minLod:h,maxLod:u})}const h=t[i++];for(let e=0;e<h;e++)c.textVertexRanges.push([t[i++],t[i++]]);const u=t[i++];for(let e=0;e<u;e++)c.iconVertexRanges.push([t[i++],t[i++]]);l.push(c)}return i}function n(t,e,s){for(const[o,i]of t.symbols)c(t,e,s,i,o)}function c(t,s,o,i,l){const r=t.layerData.get(l);if(r.type===e.BucketType.SYMBOL){for(const e of i){const s=e.unique;let i;if(e.selectedForRendering){const e=s.parts[0],l=e.startOpacity,r=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===r;const n=o?Math.floor(127*l)|r<<7:r?255:0;i=n<<24|n<<16|n<<8|n}else i=0;for(const[t,o]of e.iconVertexRanges)for(let e=t;e<t+o;e+=4)r.iconOpacity[e/4]=i;if(e.selectedForRendering){const e=s.parts[1],l=e.startOpacity,r=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===r;const n=o?Math.floor(127*l)|r<<7:r?255:0;i=n<<24|n<<16|n<<8|n}else i=0;for(const[t,o]of e.textVertexRanges)for(let e=t;e<t+o;e+=4)r.textOpacity[e/4]=i}r.lastOpacityUpdate=s,r.opacityChanged=!0}}function a(t,e,o,i){const l=t.colliders;let r,n,c,a;for(const h of l){if(t.unique.show&&t.unique.parts[h.partIndex].show&&(r=h.xScreen-i[0]+h.dxScreen,n=h.yScreen-i[1]+h.dyScreen,c=r+h.width,a=n+h.height,s.isCircleOverlapingRect(o,e.x,e.y,r,n,c,a)))return!0}return!1}t.GridIndex=l,t.deserializeSymbols=r,t.isSearchCircleOverlapingSymbol=a,t.tileCoordChange=i,t.writeOpacityToBuffers=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
