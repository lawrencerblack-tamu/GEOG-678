/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../../../geometry/support/TileClipper"],(function(e){"use strict";var t;!function(e){e[e.moveTo=1]="moveTo",e[e.lineTo=2]="lineTo",e[e.close=7]="close"}(t||(t={}));class s{constructor(e,t,s=0){this.values={},this._geometry=void 0,this._pbfGeometry=null,this.featureIndex=s;const o=t.keys,r=t.values,n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:this.id=n.getUInt64();break;case 2:{const e=n.getMessage().asUnsafe(),t=this.values;for(;!e.empty();){const s=e.getUInt32(),n=e.getUInt32();t[o[s]]=r[n]}e.release();break}case 3:this.type=n.getUInt32();break;case 4:this._pbfGeometry=n.getMessage();break;default:n.skip()}}getGeometry(s){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;const o=this._pbfGeometry.asUnsafe();let r,n;this._pbfGeometry=null,s?s.reset(this.type):r=[];let a,i=t.moveTo,l=0,c=0,u=0;for(;!o.empty();){if(0===l){const e=o.getUInt32();i=7&e,l=e>>3}switch(l--,i){case t.moveTo:c+=o.getSInt32(),u+=o.getSInt32(),s?s.moveTo(c,u):r&&(n&&r.push(n),n=[],n.push(new e.Point(c,u)));break;case t.lineTo:c+=o.getSInt32(),u+=o.getSInt32(),s?s.lineTo(c,u):n&&n.push(new e.Point(c,u));break;case t.close:s?s.close():n&&!n[0].equals(c,u)&&n.push(n[0].clone());break;default:throw o.release(),new Error("Invalid path operation")}}return s?a=s.result():r&&(n&&r.push(n),a=r),o.release(),this._geometry=a,a}}return s}));
