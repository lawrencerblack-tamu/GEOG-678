/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/commonProperties","../../layers/support/ExportWMSImageParameters"],(function(e,t,r,o,a,s,p,i,c,n,u){"use strict";return s=>{let p=class extends s{initialize(){this.exportImageParameters=new u.ExportWMSImageParameters({layer:this.layer})}destroy(){this.exportImageParameters=r.destroyMaybe(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}async fetchPopupFeaturesAtLocation(e,r){const{layer:a}=this;if(!e)throw new t("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a});const{popupEnabled:s}=a;if(!s)throw new t("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:s});const p=this.createFetchPopupFeaturesQuery(e);if(!p)return[];const{extent:i,width:c,height:n,x:u,y:m}=p;if(!(i&&c&&n))throw new t("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:i,width:c,height:n});const y=await a.fetchFeatureInfo(i,c,n,u,m);return o.throwIfAborted(r),y}};return e.__decorate([a.property()],p.prototype,"exportImageParameters",void 0),e.__decorate([a.property({readOnly:!0})],p.prototype,"exportImageVersion",null),e.__decorate([a.property()],p.prototype,"layer",void 0),e.__decorate([a.property(n.combinedViewLayerTimeExtentProperty)],p.prototype,"timeExtent",void 0),p=e.__decorate([c.subclass("esri.layers.mixins.WMSLayerView")],p),p}}));
