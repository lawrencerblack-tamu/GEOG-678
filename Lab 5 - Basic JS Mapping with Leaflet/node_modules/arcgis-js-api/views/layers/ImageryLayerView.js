/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../core/Error","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../layers/support/commonProperties","../../rest/support/Query","./support/popupUtils"],(function(e,t,r,o,s,p,a,i,n,c,u,l){"use strict";const y=s=>{let p=class extends s{constructor(){super(...arguments),this.view=null}async fetchPopupFeaturesAtLocation(e,o){const{layer:s}=this;if(!e)throw new t("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:s});const{popupEnabled:p}=s,a=l.getFetchPopupTemplate(s,o);if(!p||null==a)throw new t("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:p,popupTemplate:a});const i=await a.getRequiredFields();r.throwIfAborted(o);const c=new u;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=i,c.outSpatialReference=e.spatialReference;const{resolution:y,spatialReference:d}=this.view,m="2d"===this.view.type?new n(y,y,d):new n(.5*y,.5*y,d),{returnTopmostRaster:h,showNoDataRecords:w}=a.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},R={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:m,showNoDataRecords:w,signal:o?.signal};return s.queryVisibleRasters(c,R).then((e=>e))}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e.__decorate([o.property()],p.prototype,"layer",void 0),e.__decorate([o.property()],p.prototype,"suspended",void 0),e.__decorate([o.property(c.combinedViewLayerTimeExtentProperty)],p.prototype,"timeExtent",void 0),e.__decorate([o.property()],p.prototype,"view",void 0),p=e.__decorate([i.subclass("esri.views.layers.ImageryLayerView")],p),p};return y}));
