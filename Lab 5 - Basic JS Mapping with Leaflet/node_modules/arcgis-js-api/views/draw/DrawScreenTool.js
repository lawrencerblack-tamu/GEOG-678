/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../chunks/tslib.es6","../../core/Evented","../../core/handleUtils","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/factories/mat2df64","./DrawOperation","./drawSurfaces","./support/createUtils","./support/surfaceCoordinateSystems","../interactive/InteractiveToolBase","../overlay/OutlineOverlayItem"],(function(e,t,r,o,a,n,i,s,c,l,p,d,u,y,h,g,m){"use strict";function w(e){switch(e){case"polygon":case"point":return e;case"circle":case"rectangle":return"segment"}}e.DrawScreenTool=class extends(r.EventedMixin(g.InteractiveToolBase)){constructor(e){super(e),this._overlayItem=void 0,this.geometryType=null,this.mode=null,this.type="draw-screen"}initialize(){this.drawOperation=this._makeDrawOperation();const e=e=>this.drawOperation.on(e,(t=>{this._updateVisuals(),this.emit(e,t)}));this.addHandles([e("vertex-add"),e("vertex-remove"),e("vertex-update"),e("cursor-update"),e("complete")]),this.finishToolCreation()}destroy(){this.drawOperation=a.destroyMaybe(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centeredToggled(e){this._set("centeredToggled",e),this._updateVisuals()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set uniformSizeToggled(e){this._set("uniformSizeToggled",e),this._updateVisuals()}get updating(){return this.drawOperation?.updating??!1}get cursor(){return"point"===this.geometryType?"default":"crosshair"}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}undo(){this.drawOperation.undo()}reset(){}_makeDrawOperation(){const{view:e}=this;return new d.DrawOperation({view:e,manipulators:this.manipulators,geometryType:w(this.geometryType),drawingMode:this.mode,hasZ:!1,defaultZ:0,snapToSceneEnabled:!1,drawSurface:new u.ScreenDrawSurface,hasM:!1,snappingManager:null,snappingVisualizer:null,graphic:null,cursor:this.cursor})}get coordinates(){const{drawOperation:e}=this;if(!e?.geometryIncludingUncommittedVertices.length)return[];const{coordinateHelper:t}=e,r=e.committableVertex,o=e.committedVertices.slice();null!=r&&o.push(t.pointToArray(r));const a=o.length;switch(this.geometryType){case"circle":case"rectangle":{const t=new h.AffineCoordinateSystem(p.IDENTITY,u.ScreenDrawSurface.spatialReference),r="circle"===this.geometryType?y.createCircle:y.createSquare,n="circle"===this.geometryType?y.createEllipse:y.createRectangle;if(1===a&&e.isCompleted){const e=o[0],a=t.makeMapPoint(e[0]+T,e[1]);return r([e,a],t,!0)?.geometry.rings[0]??[]}if(2===a){const e="rectangle"!==this.geometryType,a=this.centeredToggled!==e,i="rectangle"!==this.geometryType;return(this.uniformSizeToggled!==i?r(o,t,a)?.geometry.rings[0]:n(o,t,a)?.geometry.rings[0])??[]}return[]}}return o}_updateVisuals(){if(!this._overlayItem){const e=new m({strokeDash:[5],strokeDashColor:[255,255,255,255]});this.view.overlay?.addItem(e),this.addHandles(o.makeHandle((()=>{this.view.overlay?.removeItem(e),e?.destroy(),this._overlayItem=void 0}))),this._overlayItem=e}this._overlayItem.coordinates=this.coordinates}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},t.__decorate([n.property({value:!1})],e.DrawScreenTool.prototype,"centeredToggled",null),t.__decorate([n.property()],e.DrawScreenTool.prototype,"drawOperation",void 0),t.__decorate([n.property({value:!0})],e.DrawScreenTool.prototype,"enabled",null),t.__decorate([n.property({value:!1})],e.DrawScreenTool.prototype,"uniformSizeToggled",null),t.__decorate([n.property({constructOnly:!0})],e.DrawScreenTool.prototype,"geometryType",void 0),t.__decorate([n.property({constructOnly:!0})],e.DrawScreenTool.prototype,"mode",void 0),t.__decorate([n.property({readOnly:!0})],e.DrawScreenTool.prototype,"type",void 0),t.__decorate([n.property({readOnly:!0})],e.DrawScreenTool.prototype,"updating",null),t.__decorate([n.property({constructOnly:!0,nonNullable:!0})],e.DrawScreenTool.prototype,"view",void 0),t.__decorate([n.property()],e.DrawScreenTool.prototype,"cursor",null),e.DrawScreenTool=t.__decorate([l.subclass("esri.views.draw.DrawScreenTool")],e.DrawScreenTool);const T=48;e.geometryTypeToDrawOperationGeometryType=w,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
