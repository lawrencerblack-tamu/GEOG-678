/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../core/libs/gl-matrix-2/factories/vec2f64","./enums","./Texture","./TextureDescriptor"],(function(e,t,r,n,i){"use strict";function o(e,t,o="nearest",a=!1){const s=!(a&&"u8"===t.pixelType),u=s?r.PixelType.FLOAT:r.PixelType.UNSIGNED_BYTE,f=null==t.pixels||0===t.pixels.length?null:s?t.getAsRGBAFloat():t.getAsRGBA(),m=e.capabilities.textureFloat?.textureFloatLinear,c=new i.TextureDescriptor;return c.width=t.width,c.height=t.height,c.internalFormat=s?r.SizedPixelFormat.RGBA32F:r.PixelFormat.RGBA,c.samplingMode=!m||"bilinear"!==o&&"cubic"!==o?r.TextureSamplingMode.NEAREST:r.TextureSamplingMode.LINEAR,c.dataType=u,c.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE,new n.Texture(e,c,f)}function a(e,t){const{spacing:o,offsets:a,coefficients:s,size:[u,f]}=t,m=o[0]>1,c=new i.TextureDescriptor;c.width=m?4*u:u,c.height=f,c.internalFormat=r.SizedPixelFormat.RGBA32F,c.dataType=r.PixelType.FLOAT,c.samplingMode=r.TextureSamplingMode.NEAREST,c.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE;const l=new Float32Array(m?u*f*16:2*a.length);if(m&&null!=s)for(let r=0,n=0;r<s.length;r++)l[n++]=s[r],r%3==2&&(l[n++]=1);else for(let r=0;r<f;r++)for(let e=0;e<u;e++){const t=4*(r*u+e),n=2*(e*f+r);l[t]=a[n],l[t+1]=a[n+1],l[t+3]=-1===a[n]?0:1}return new n.Texture(e,c,l)}function s(e,t){const o=new i.TextureDescriptor;return o.internalFormat=r.PixelFormat.RGBA,o.width=t.length/4,o.height=1,o.samplingMode=r.TextureSamplingMode.NEAREST,o.wrapMode=r.TextureWrapMode.CLAMP_TO_EDGE,new n.Texture(e,o,t)}function u(e,r,n,i=1,o=!0){return{u_flipY:o,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:t.ZEROS,u_transformGridSize:e?e.size:t.ZEROS,u_targetImageSize:r,u_srcImageSize:n}}function f(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function m(e,t){return{u_scale:e,u_offset:t}}function c(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function l(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function T(e,t){const r=e.gl,n=t.glName,i=new Map;if(null==n)return i;const o=r.getProgramParameter(n,r.ACTIVE_UNIFORMS);let a;for(let s=0;s<o;s++)a=r.getActiveUniform(n,s),a&&i.set(a.name,{location:r.getUniformLocation(n,a.name),info:a});return i}function p(e,t,r){Object.keys(r).forEach((n=>{const i=t.get(n)||t.get(n+"[0]");i&&_(e,n,r[n],i)}))}function g(e,t,r,n){r.length===n.length&&(n.some((e=>null==e))||r.some((e=>null==e))||r.forEach(((r,i)=>{t.setUniform1i(r,i),e.bindTexture(n[i],i)})))}function _(e,t,n,i){if(null===i||null==n)return!1;const{info:o}=i;switch(o.type){case r.UniformType.FLOAT:o.size>1?e.setUniform1fv(t,n):e.setUniform1f(t,n);break;case r.UniformType.FLOAT_VEC2:e.setUniform2fv(t,n);break;case r.UniformType.FLOAT_VEC3:e.setUniform3fv(t,n);break;case r.UniformType.FLOAT_VEC4:e.setUniform4fv(t,n);break;case r.UniformType.FLOAT_MAT3:e.setUniformMatrix3fv(t,n);break;case r.UniformType.FLOAT_MAT4:e.setUniformMatrix4fv(t,n);break;case r.UniformType.INT:o.size>1?e.setUniform1iv(t,n):e.setUniform1i(t,n);break;case r.UniformType.BOOL:e.setUniform1i(t,n?1:0);break;case r.UniformType.INT_VEC2:case r.UniformType.BOOL_VEC2:e.setUniform2iv(t,n);break;case r.UniformType.INT_VEC3:case r.UniformType.BOOL_VEC3:e.setUniform3iv(t,n);break;case r.UniformType.INT_VEC4:case r.UniformType.BOOL_VEC4:e.setUniform4iv(t,n);break;default:return!1}return!0}e.createColormapTexture=s,e.createRasterTexture=o,e.createTransformTexture=a,e.getBasicGridUniforms=m,e.getColormapUniforms=f,e.getCommonUniforms=u,e.getShadedReliefUniforms=l,e.getStretchUniforms=c,e.getUniformLocationInfos=T,e.setTextures=g,e.setUniforms=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
