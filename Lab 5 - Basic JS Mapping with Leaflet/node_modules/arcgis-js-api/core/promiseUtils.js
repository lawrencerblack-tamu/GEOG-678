/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","./clock","./Error","./events","./Logger","./maybe"],(function(t,e,r,n,o,i){"use strict";async function u(t,e){const r=t.slice(),n=await Promise.all(t.map(((t,r)=>e(t,r))));return r.filter(((t,e)=>n[e]))}function l(t="Aborted"){return new r("AbortError",t)}function s(t,e="Aborted"){if(c(t))throw l(e)}function a(t){return t instanceof AbortSignal?t:t?.signal}function c(t){const e=a(t);return null!=e&&e.aborted}function f(t){if(A(t))throw t}function m(t){if(!A(t))throw t}function w(t,e){const r=a(t);if(null!=r){if(!r.aborted)return n.once(r,"abort",(()=>e()));e()}}function b(t,e){const r=a(t);if(null!=r)return s(r),n.once(r,"abort",(()=>e(l())))}function h(t,e){return null==a(e)?t:new Promise(((r,n)=>{let o=w(e,(()=>n(l())));const u=()=>{o=i.removeMaybe(o)};t.then(u,u),t.then(r,n)}))}function d(t,e,n){return Promise.race([t,E(e).then((()=>{throw new r("timeout",`Did not resolve within ${e} milliseconds (${n??"timeout"})`)}))])}function A(t){return"AbortError"===t?.name}async function p(t){try{return await t}catch(e){if(!A(e))throw e;return}}async function y(t,e=o.getLogger("esri")){try{return await t}catch(r){A(r)||e.error(r)}}async function v(t){if(!t)return;if("function"!=typeof t.forEach){const e=Object.keys(t),r=e.map((e=>t[e])),n=await v(r),o={};return e.map(((t,e)=>o[t]=n[e])),o}const e=t;return Promise.allSettled(e).then((t=>Array.from(e,((e,r)=>{const n=t[r];return"fulfilled"===n.status?{promise:e,value:n.value}:{promise:e,error:n.reason}}))))}async function g(t){return(await v(t)).filter((t=>!!t.value)).map((t=>t.value))}async function T(t){return(await Promise.allSettled(t)).filter((t=>"fulfilled"===t.status)).map((t=>t.value))}async function P(t){return(await Promise.allSettled(t)).filter((t=>"rejected"===t.status)).map((t=>t.reason))}function E(t,e=void 0,r){const n=new AbortController;return w(r,(()=>n.abort())),new Promise(((r,o)=>{let i=setTimeout((()=>{i=0,r(e)}),t);w(n,(()=>{i&&(clearTimeout(i),o(l()))}))}))}function S(t,e,n,o){const i=n&&"abort"in n?n:null;null!=o||i||(o=n);let u=setTimeout((()=>{u=0,i?.abort()}),e);const l=()=>o||new r("promiseUtils:timeout","The wrapped promise did not resolve within "+e+" ms");return t.then((t=>{if(0===u)throw l();return clearTimeout(u),t}),(t=>{throw clearTimeout(u),0===u?l():t}))}function j(t,e){const r=new AbortController,n=setTimeout((()=>r.abort()),e);return w(t,(()=>{r.abort(),clearTimeout(n)})),{...t,signal:r.signal}}function O(t){return t&&"function"==typeof t.then}function k(t){return O(t)?t:Promise.resolve(t)}function C(t,e=-1){let r,n,o,i,u=null;const s=(...a)=>{if(r){n=a,i&&i.reject(l()),i=I();const t=i.promise;if(u){const t=u;u=null,t.abort()}return t}if(o=i||I(),i=null,e>0){const n=new AbortController;r=k(t(...a,n.signal));const o=r;E(e).then((()=>{r===o&&(i?n.abort():u=n)}))}else r=1,r=k(t(...a));const c=()=>{const t=n;n=o=r=u=null,null!=t&&s(...t)},f=r,m=o;return f.then(c,c),f.then(m.resolve,m.reject),m.promise};return s}function I(){let t,r;const n=new Promise(((e,n)=>{t=e,r=n})),o=e=>{t(e)};return o.resolve=e=>t(e),o.reject=t=>r(t),o.timeout=(t,r)=>e.clock.setTimeout((()=>o.reject(r)),t),o.promise=n,o}function L(t,e){return t.then(e,e)}function M(t,e){e.then(t.resolve,t.reject)}async function V(t){await Promise.resolve(),s(t)}t.after=E,t.allSettledErrors=P,t.allSettledValues=T,t.always=L,t.createAbortError=l,t.createResolver=I,t.debounce=C,t.eachAlways=v,t.eachAlwaysValues=g,t.filter=u,t.ignoreAbortErrors=p,t.isAbortError=A,t.isAborted=c,t.isPromiseLike=O,t.logOnError=y,t.onAbort=w,t.onAbortOrThrow=b,t.settleWithPromise=M,t.signalFromSignalOrOptions=a,t.throwIfAbortError=f,t.throwIfAborted=s,t.throwIfNotAbortError=m,t.timeout=S,t.waitTick=V,t.when=k,t.whenOrAbort=h,t.whenOrTimeout=d,t.wrapAbortWithTimeout=j,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
