/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../Accessor","../Collection","./utils"],(function(t,e,n,o){"use strict";const r=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function f(t){return t instanceof e}function i(t){return t instanceof n?Object.keys(t.items):f(t)?o.getProperties(t).keys():t?Object.keys(t):[]}function l(t,e){return t instanceof n?t.items[e]:t[e]}function u(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function c(t){return t?t.declaredClass:null}function s(t,e){const n=t.diff;if(n&&"function"==typeof n)return n(t,e);const o=i(t),a=i(e);if(0===o.length&&0===a.length)return;if(!o.length||!a.length||u(t,e))return{type:"complete",oldValue:t,newValue:e};const p=a.filter((t=>!o.includes(t))),y=o.filter((t=>!a.includes(t))),d=o.filter((n=>a.includes(n)&&l(t,n)!==l(e,n))).concat(p,y).sort(),h=c(t);if(h&&r.has(h)&&d.length)return{type:"complete",oldValue:t,newValue:e};let m;const g=f(t)&&f(e);for(const r of d){const o=l(t,r),f=l(e,r);let i;if((g||"function"!=typeof o&&"function"!=typeof f)&&(o!==f&&(null!=o||null!=f))){if(n&&n[r]&&"function"==typeof n[r])i=n[r]?.(o,f);else if(o instanceof Date&&f instanceof Date){if(o.getTime()===f.getTime())continue;i={type:"complete",oldValue:o,newValue:f}}else i="object"==typeof o&&"object"==typeof f&&c(o)===c(f)?s(o,f):{type:"complete",oldValue:o,newValue:f};null!=i&&(null!=m?m.diff[r]=i:m={type:"partial",diff:{[r]:i}})}}return m}function a(t,e){return p(t,e)}function p(t,e){if(null==t)return!1;const n=e.split(".");let o=t;for(const r of n){if("complete"===o.type)return!0;if("partial"!==o.type)return!1;{const t=o.diff[r];if(!t)return!1;o=t}}return!0}function y(t,e){return d(t,e)}function d(t,e){for(const n of e)if(p(t,n))return!0;return!1}function h(t,e){if(!t)return!1;if("partial"===t.type){const n=Object.keys(t.diff);return 1===n.length&&n[0]===e}return!1}function m(t,e){if("function"!=typeof t&&"function"!=typeof e&&(null!=t||null!=e))return null==t||null==e||"object"==typeof t&&"object"==typeof e&&c(t)!==c(e)?{type:"complete",oldValue:t,newValue:e}:s(t,e)}function g(t){if(null==t)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const t of e.added)if(!g(t))return!1;for(const t of e.removed)if(!g(t))return!1;for(const t of e.changed)if(!g(t))return!1;return!0}case"partial":for(const e in t.diff){if(!g(t.diff[e]))return!1}return!0}}t.diff=m,t.hasDiff=p,t.hasDiffAny=d,t.hasRootDiff=a,t.hasRootDiffAny=y,t.hasRootDiffOnly=h,t.isEmpty=g,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
