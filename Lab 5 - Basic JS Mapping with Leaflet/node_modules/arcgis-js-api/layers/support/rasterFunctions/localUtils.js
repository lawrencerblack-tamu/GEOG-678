/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../PixelBlock","../rasterFunctionConstants","../rasterFormats/pixelRangeUtils"],(function(t,e,n,r){"use strict";const o=new Map([[n.localTrigonometricOperation.acos,{domain:[0,Math.PI],isInteger:!1}],[n.localTrigonometricOperation.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[n.localTrigonometricOperation.atan,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[n.localTrigonometricOperation.cos,{domain:[-1,1],isInteger:!1}],[n.localTrigonometricOperation.sin,{domain:[-1,1],isInteger:!1}],[n.localLogicalOperation.booleanAnd,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.booleanNot,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.booleanOr,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.booleanXOr,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.equalTo,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.notEqual,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.greaterThan,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.greaterThanEqual,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.lessThan,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.lessThanEqual,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.isNull,{domain:[0,1],isInteger:!0}]]);function a(t){return o.get(t)}const l=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function c(t,e=!1){const n=t.map((t=>t.mask)),r=n.filter((t=>null!=t)),o=t[0].pixels[0].length;if(0===r.length||e&&r.length!==n.length)return new Uint8Array(o).fill(255);const a=r[0],l=new Uint8Array(a);if(1===r.length)return l;if(!e){for(let t=1;t<r.length;t++){const e=r[t];for(let t=0;t<l.length;t++)l[t]&&(l[t]=e[t]?255:0)}return l}for(let c=1;c<r.length;c++){const t=r[c];for(let e=0;e<l.length;e++)0===l[e]&&(l[e]=t[e]?255:0)}return l}function s(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]+a[e]);return c}function i(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand("f32",a);return l.set(o),l}function f(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]*o[e]);return l}function u(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]-a[e]);return c}function h(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]*a[e]);return c}function g(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=Math.sign(o[e])*Math.floor(Math.abs(o[e])));return l}function p(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]/a[e]);return c}function m(t,e,n){return p(t,e,"f32")}function d(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=Math.floor(o[e]/a[e]));return c}function y(t,r,o,a){const l=t[0],c=l.length,s=e.createEmptyBand(o,c);if(a===n.localTrigonometricOperation.atanh){for(let t=0;t<c;t++)if(r[t]){const e=l[t];Math.abs(e)>=1?r[t]=0:s[t]=Math.atanh(e)}return s}const i=a===n.localTrigonometricOperation.asin?Math.asin:Math.acos;for(let e=0;e<c;e++)if(r[e]){const t=l[e];Math.abs(t)>1?r[e]=0:s[e]=i(t)}return s}function M(t,n,r,o){const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o(a[e]));return c}function E(t,n,r,o){const[a,l]=t,c=a.length,s=e.createEmptyBand(r,c);for(let e=0;e<c;e++)n&&!n[e]||(s[e]=o(a[e],l[e]));return s}function B(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]&a[e]);return c}function O(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]<<a[e]);return c}function I(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=~o[e]);return l}function T(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]|a[e]);return c}function w(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]>>a[e]);return c}function x(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]^a[e]);return c}function b(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]&&a[e]?1:0);return c}function L(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=o[e]?0:1);return l}function P(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]||a[e]?1:0);return c}function A(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=(o[e]?1:0)^(a[e]?1:0));return c}function k(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]===a[e]?1:0);return c}function N(t,n,r,o){const[a]=t,l=a.length,c=e.createEmptyBand(r,l),s=o===Math.E;for(let e=0;e<l;e++)n&&!n[e]||(c[e]=s?Math.exp(a[e]):o**a[e]);return c}function q(t,e,n){return N(t,e,n,10)}function U(t,e,n){return N(t,e,n,2)}function F(t,e,n){return N(t,e,n,Math.E)}function C(t,n,r,o){const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(a[e]<=0?n[e]=0:c[e]=o(a[e]));return c}function S(t,e,n){return C(t,e,n,Math.log10)}function z(t,e,n){return C(t,e,n,Math.log2)}function R(t,e,n){return C(t,e,n,Math.log)}function j(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]>a[e]?1:0);return c}function v(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]>=a[e]?1:0);return c}function D(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]<a[e]?1:0);return c}function V(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]<=a[e]?1:0);return c}function X(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);if(!n)return l;for(let e=0;e<a;e++)l[e]=n[e]?0:1;return l}function G(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]%a[e]);return c}function H(t,n,r){const[o]=t,a=o.length,l=e.createEmptyBand(r,a);for(let e=0;e<a;e++)n&&!n[e]||(l[e]=-o[e]);return l}function J(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n&&!n[e]||(c[e]=o[e]===a[e]?0:1);return c}function K(t,n,r){const[o,a]=t,l=o.length,c=e.createEmptyBand(r,l),s=new Uint8Array(l);for(let e=0;e<l;e++)null!=n&&!n[e]||0!==o[e]||(c[e]=a[e],s[e]=255);return{band:c,mask:s}}function Q(t,n,r){const[o,a,l]=t,c=o.length,s=e.createEmptyBand(r,c);for(let e=0;e<c;e++)n&&!n[e]||(s[e]=o[e]?a[e]:l[e]);return s}function W(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e];for(let r=1;r<o;r++){const o=t[r][e];n<o&&(n=o)}c[e]=n}return c}function Y(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e];for(let r=1;r<o;r++){const o=t[r][e];n>o&&(n=o)}c[e]=n}return c}function Z(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e],r=n;for(let a=1;a<o;a++){const o=t[a][e];r<o?r=o:n>o&&(n=o)}c[e]=r-n}return c}function $(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=0;for(let r=0;r<o;r++)n+=t[r][e];c[e]=n/o}return c}function _(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e])for(let n=0;n<o;n++){const r=t[n];c[e]+=r[e]}return c}function tt(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)if(!n||n[e]){const n=new Float32Array(o);let r=0;for(let l=0;l<o;l++){const o=t[l];r+=o[e],n[l]=o[e]}r/=o;let a=0;for(let t=0;t<o;t++)a+=(n[t]-r)**2;c[e]=Math.sqrt(a/o)}return c}function et(t,n,r){const o=t.length;if(o<2)return t[0];const a=Math.floor(o/2),[l]=t,c=l.length,s=e.createEmptyBand(r,c),i=new Float32Array(o),f=o%2==1;for(let e=0;e<c;e++)if(!n||n[e]){for(let n=0;n<o;n++)i[n]=t[n][e];i.sort(),s[e]=f?i[a]:(i[a]+i[a-1])/2}return s}function nt(t,n,r){const[o,a]=t;if(null==a)return o;const l=o.length,c=e.createEmptyBand(r,l);for(let e=0;e<l;e++)n[e]&&(o[e]===a[e]?c[e]=o[e]:n[e]=0);return c}function rt(t,n,r){const o=t.length;if(o<=2)return nt(t,n,r);const a=t[0].length,l=e.createEmptyBand(r,a),c=new Map;for(let e=0;e<a;e++)if(!n||n[e]){let n;c.clear();for(let l=0;l<o;l++)n=t[l][e],c.set(n,c.has(n)?c.get(n)+1:1);let r=0,a=0;for(const t of c.keys())r=c.get(t),r>a&&(a=r,n=t);l[e]=n}return l}function ot(t,n,r){const o=t.length;if(o<=2)return nt(t,n,r);const a=t[0].length,l=e.createEmptyBand(r,a),c=new Map;for(let e=0;e<a;e++)if(!n||n[e]){let n;c.clear();for(let l=0;l<o;l++)n=t[l][e],c.set(n,c.has(n)?c.get(n)+1:1);let r=0,a=t.length;for(const t of c.keys())r=c.get(t),r<a&&(a=r,n=t);l[e]=n}return l}function at(t,n,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(r,l),s=new Set;for(let e=0;e<l;e++)if(!n||n[e]){let n;s.clear();for(let r=0;r<o;r++)n=t[r][e],s.add(n);c[e]=s.size}return c}const lt=new Map,ct=new Map,st=new Map,it=new Map;function ft(){lt.size||(lt.set(4,Math.sqrt),lt.set(6,Math.acos),lt.set(7,Math.asin),lt.set(8,Math.atan),lt.set(9,Math.atanh),lt.set(10,Math.abs),lt.set(21,Math.cos),lt.set(22,Math.cosh),lt.set(48,Math.floor),lt.set(49,Math.ceil),lt.set(51,Math.sin),lt.set(52,Math.sinh),lt.set(56,Math.tan),lt.set(57,Math.tanh),lt.set(59,Math.acosh),lt.set(60,Math.asinh),lt.set(65,Math.floor),ct.set(5,Math.pow),ct.set(61,Math.atan2),st.set(1,s),st.set(2,u),st.set(3,h),st.set(11,B),st.set(12,O),st.set(13,I),st.set(14,T),st.set(15,w),st.set(16,x),st.set(17,b),st.set(18,L),st.set(19,P),st.set(20,A),st.set(23,p),st.set(24,k),st.set(25,F),st.set(26,q),st.set(27,U),st.set(28,j),st.set(29,v),st.set(30,g),st.set(31,X),st.set(32,i),st.set(33,D),st.set(34,V),st.set(35,R),st.set(36,S),st.set(37,z),st.set(44,G),st.set(45,H),st.set(46,J),st.set(53,f),st.set(64,m),st.set(65,d),st.set(76,Q),st.set(78,Q),it.set(38,rt),it.set(39,W),it.set(40,$),it.set(41,et),it.set(42,Y),it.set(43,ot),it.set(47,Z),it.set(54,tt),it.set(55,_),it.set(58,at),it.set(66,rt),it.set(67,W),it.set(68,$),it.set(69,et),it.set(70,Y),it.set(71,ot),it.set(72,Z),it.set(73,tt),it.set(74,_),it.set(75,at))}function ut(t,e,n,o){let[a,l]=r.getPixelValueRange(n);const c=r.isIntegerPixelType(n);c&&(a-=1e-5,l+=1e-5);for(let r=0;r<e.length;r++)if(e[r]){const n=t[r];isNaN(n)||n<a||n>l?e[r]=0:o[r]=c?Math.round(n):n}}function ht(t,r,a={}){ft();let l=c(t,r>=66&&r<=75);const{outputPixelType:s="f32"}=a,i=!it.has(r)||a.processAsMultiband,f=i?t[0].pixels.length:1,u=[];for(let c=0;c<f;c++){const a=it.has(r)&&!i?t.flatMap((t=>t.pixels)):t.map((t=>t.pixels[c]));let f,h=!0;if(r===n.localConditionalOperation.setNull){const t=K(a,l,s);f=t.band,l=t.mask,h=!1}else if(st.has(r)){f=st.get(r)(a,l,"f64")}else if(lt.has(r))f=r===n.localTrigonometricOperation.asin||r===n.localTrigonometricOperation.acos||r===n.localTrigonometricOperation.atanh?y(a,l,"f64",r):M(a,l,"f64",lt.get(r));else if(ct.has(r))f=E(a,l,"f64",ct.get(r));else if(it.has(r)){f=it.get(r)(a,l,"f64")}else f=a[0],h=!1;if(h&&r!==n.localLogicalOperation.isNull&&!o.has(r)){const t=e.createEmptyBand(s,f.length);l||(l=new Uint8Array(f.length).fill(255)),ut(f,l,s,t),f=t}u.push(f)}const h=t[0];return new e({width:h.width,height:h.height,pixelType:s,mask:r===n.localLogicalOperation.isNull?null:l,pixels:u})}function gt(t,e,n){return ht(t,e=[null,1,2,3,23,5,44][e]??1,{outputPixelType:n})}t.arithmetic=gt,t.getOutputDomain=a,t.local=ht,t.operandsCount=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
