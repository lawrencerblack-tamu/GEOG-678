/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../rasterFormats/pixelRangeUtils","./BaseRasterFunction","./focalStatUtils","./StatisticsFunctionArguments"],(function(t,s,e,r,o,i,n,c,a,u){"use strict";let p=class extends c{constructor(){super(...arguments),this.functionName="Statistics",this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const{type:t}=this.functionArguments.toJSON();if(t<1||t>7)return{success:!1,supportsGPU:!1,error:`statistics-function: the given statistics type is not supported ${t}`};const s=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(s.pixelType);const e=s.clone();e.pixelType=this.outputPixelType;const{statisticsType:r}=this.functionArguments;"stddev"===r&&this._removeStatsHistColormapVAT(e),this.rasterInfo=e;return{success:!0,supportsGPU:e.bandCount<=3&&t<5}}_processPixels(t){const s=t.pixelBlocks?.[0];if(null==s)return s;const{statisticsType:e,rows:r,cols:o,fillNoDataOnly:i}=this.functionArguments;return a.computeFocalStatistics(s,{kernelRows:r,kernelCols:o,fillNoDataOnly:i,outputPixelType:this.outputPixelType,statisticsType:e,mirrorEdges:!0})}_getWebGLParameters(){const{rows:t,cols:s,statisticsType:e,fillNoDataOnly:r}=this.functionArguments;return{fillNoDataOnly:r,kernelRows:t,kernelCols:s,statisticsType:e,clampRange:n.getPixelValueRange(this.outputPixelType)}}};t.__decorate([s.property({json:{write:!0,name:"rasterFunction"}})],p.prototype,"functionName",void 0),t.__decorate([s.property({type:u,json:{write:!0,name:"rasterFunctionArguments"}})],p.prototype,"functionArguments",void 0),t.__decorate([s.property()],p.prototype,"rasterArgumentNames",void 0),p=t.__decorate([i.subclass("esri.layers.support.rasterFunctions.StatisticsFunction")],p);return p}));
