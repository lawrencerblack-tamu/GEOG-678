/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../core/mathUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./BaseRasterFunction","./MaskFunctionArguments","./pixelUtils"],(function(e,t,s,n,r,o,a,u,l,i){"use strict";let c=class extends u{constructor(){super(...arguments),this.functionName="Mask",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,this.rasterInfo=e;const{includedRanges:s,normalizedNoDataValues:n}=this.functionArguments;if(!s?.length&&!n?.length)return{success:!1,supportsGPU:!1,error:"missing includedRanges or noDataValues argument"};let r=[];for(let a=0;a<e.bandCount;a++){const e=i.createMaskLUT(t,s?.slice(2*a,2*a+2),n?.[a]);if(null==e){r=null;break}r.push(e)}this.lookups=r;const o=null!=n&&n.every((e=>e?.length===n[0]?.length));return{success:!0,supportsGPU:(!s||s.length<=2*i.maxMapSizeGpu)&&(!n||o&&n[0].length<=i.maxMapSizeGpu)}}_processPixels(e){const t=e.pixelBlocks?.[0];if(null==t)return null;const{outputPixelType:s,lookups:n}=this,{includedRanges:r,noDataInterpretation:o,normalizedNoDataValues:a}=this.functionArguments,u=o===i.NoDataInterpretation.matchAll;return i.mask(t,{includedRanges:r,noDataValues:a,outputPixelType:s,matchAll:u,lookups:n})}_getWebGLParameters(){const{includedRanges:e,normalizedNoDataValues:s}=this.functionArguments,n=new Float32Array(i.maxMapSizeGpu);n.fill(t.numberMaxFloat32),s?.[0]?.length&&n.set(s[0]);const r=new Float32Array(i.maxMapSizeGpu);for(let o=0;o<r.length;o+=2)r[o]=e?.[o]??-t.numberMaxFloat32,r[o+1]=e?.[o+1]??t.numberMaxFloat32;return e&&e.length&&r.set(e),{bandCount:this.sourceRasterInfos[0].bandCount,noDataValues:n,includedRanges:r}}};e.__decorate([s.property({json:{write:!0,name:"rasterFunction"}})],c.prototype,"functionName",void 0),e.__decorate([s.property({type:l,json:{write:!0,name:"rasterFunctionArguments"}})],c.prototype,"functionArguments",void 0),e.__decorate([s.property()],c.prototype,"rasterArgumentNames",void 0),e.__decorate([s.property({json:{write:!0}})],c.prototype,"lookups",void 0),c=e.__decorate([a.subclass("esri.layers.support.rasterFunctions.MaskFunction")],c);return c}));
