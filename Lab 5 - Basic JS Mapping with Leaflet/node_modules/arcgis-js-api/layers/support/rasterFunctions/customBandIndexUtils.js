/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/has"],(function(e,t){"use strict";const n=new Set(["+","-","*","/","(",")"]);function r(e,t){(e=e.replaceAll(" ","")).startsWith("-")&&(e="0"+e),e.startsWith("+")&&(e=e.slice(1,e.length));const r=e.split(""),o=[],s=[];let a="";for(let u=0;u<r.length;u++){const e=r[u];n.has(e)?(a.length&&s.push(l(a,t)),o.push(e),a=""):a=a.concat(e)}return a.length&&s.push(l(a,t)),{ops:o,nums:s}}function l(e,t){return e.toLowerCase().startsWith("b")?t[parseInt(e.slice(1),10)-1]:parseFloat(e)}function o(e,t,n,r){if("number"==typeof n&&"number"==typeof r)return n+r;let l,o,s;"number"==typeof n?(s=r,l=s.length,o=new Float32Array(l),o.fill(n)):(l=n.length,o=n,r.constructor===Number?(s=new Float32Array(l),s.fill(r)):s=r);const a=new Float32Array(l);switch(t){case"+":for(let t=0;t<l;t++)(null==e||e[t])&&(a[t]=o[t]+s[t]);break;case"-":for(let t=0;t<l;t++)(null==e||e[t])&&(a[t]=o[t]-s[t]);break;case"*":for(let t=0;t<l;t++)(null==e||e[t])&&(a[t]=o[t]*s[t]);break;case"/":for(let t=0;t<l;t++)(null==e||e[t])&&s[t]&&(a[t]=o[t]/s[t]);break;case"(":case")":throw new Error("encountered error with custom band index equation")}return a}function s(e,t){e.splice(t,1);let n=0,r=0;do{n=0,r=0;for(let t=0;t<e.length;t++)if("("===e[t])n=t;else if(")"===e[t]){r=t;break}r===n+1&&e.splice(n,2)}while(r===n+1);return e}function a(e){if(1===e.length)return{opIndex:0,numIndex:0};let t=0,n=0;for(let s=0;s<e.length;s++)if("("===e[s])t=s;else if(")"===e[s]){n=s;break}const r=0===n?e:e.slice(t+1,n);let l=-1;for(let s=0;s<r.length;s++)if("*"===r[s]||"/"===r[s]){l=s;break}if(l>-1)n>0&&(l+=t+1);else{for(let e=0;e<r.length;e++)if("+"===r[e]||"-"===r[e]){l=e;break}n>0&&(l+=t+1)}let o=0;for(let s=0;s<l;s++)"("===e[s]&&o++;return{opIndex:l,numIndex:l-o}}function u(e,t,n){let l,{ops:u,nums:i}=r(n,t);if(0===u.length){const e=1===i.length?i[0]:t[0];if(e instanceof Float32Array)return[e];const n=new Float32Array(t[0].length);return"number"==typeof e?n.fill(e):n.set(e),[n]}for(;u.length>0;){const{numIndex:t,opIndex:n}=a(u);if(l=o(e,u[n],i[t],i[t+1]),1===u.length)break;u=s(u,n),i.splice(t,2,l)}return[l]}e.calculateCustomBandIndex=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
