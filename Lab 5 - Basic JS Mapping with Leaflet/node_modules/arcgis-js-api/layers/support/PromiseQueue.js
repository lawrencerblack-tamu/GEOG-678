/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],(function(s,t,e,r){"use strict";class n{constructor(){this._tasks=new Array,this._runningTasks=e.signal(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(s){if(0===this.length)return r.Yield;for(;!s.done&&this._process(s);)s.madeProgress()}push(s,t,e){return++this._runningTasks.value,new Promise(((r,n)=>this._tasks.push(new i(r,n,s,t,e)))).finally((()=>--this._runningTasks.value))}unshift(s,t,e){return++this._runningTasks.value,new Promise(((r,n)=>this._tasks.unshift(new i(r,n,s,t,e)))).finally((()=>--this._runningTasks.value))}_process(s){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{const r=t.isAborted(e.signal);if(r&&!e.abortCallback)e.reject(t.createAbortError());else{const n=r?e.abortCallback?.(t.createAbortError()):e.callback(s);t.isPromiseLike(n)?n.then(e.resolve,e.reject):e.resolve(n)}}catch(r){e.reject(r)}return!0}cancelAll(){const s=t.createAbortError();for(const t of this._tasks)if(t.abortCallback){const e=t.abortCallback(s);t.resolve(e)}else t.reject(s);this._tasks.length=0}}class i{constructor(s,t,e,r=void 0,n=void 0){this.resolve=s,this.reject=t,this.callback=e,this.signal=r,this.abortCallback=n}}s.PromiseQueue=n,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})}));
