/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/support/Ellipsoid","../../../geometry/support/pointUtils","./ExposurePoint"],(function(t,e,a,i){"use strict";function s(t){const{camera:e,features:a,selectedPoint:i}=t;if(!a.length)return[];t.currentImage??={attributes:{cameraHeading:0,cameraPitch:0}};const s=h(e,i,t.currentImage);return a.map(s)}function h(t,i,s){return i.z??=0,i.elevation??=0,h=>{const{hfovWeight:r,vfovWeight:o,distanceWeight:c}=n(h.attributes,t?"3d":"2d"),l=h.attributes,{cameraHeight:u,cameraHeading:g,cameraPitch:M,farDistance:d,horizontalFieldOfView:b,verticalFieldOfView:f,isOblique:v}=l,W=l.geometry,m=180*Math.atan2(W.y-i.y,W.x-i.x)/Math.PI,y=a.distance(i,W);let p,P,x=b,I=f,q=!1;t?(p=t.heading,P=t.tilt,x=180,I=180,q=!0):!v||M<10?(p=g,P=M,q=!1):(p=s.attributes.cameraHeading,P=M,q=!0,x=180),p>180&&(p-=360);let O=1;W.spatialReference.isWebMercator&&(O=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*W.y/e.earth.radius))));const H=Math.sqrt((Math.sqrt((i.x-W.x)**2+(i.y-W.y)**2)/O)**2+((i.z??0)-(i.elevation??0)-u)**2),S=90-180*Math.atan2(i.y-W.y,i.x-W.x)/Math.PI;let z=(Math.abs(S-p)>180?Math.abs(360-Math.abs(S-p)):Math.abs(S-p))/x;z=4*z+1;const w=180*Math.acos((l.cameraHeight-(i.z??0)+(i.elevation??0))/H)/Math.PI;let E=Math.abs(w-P)/I;E=4*E+1;let F=H/Math.sqrt(d**2+u**2);F=4*F+1;const V=r*z+o*E+c*F;let j;if(q){const t=g>180?g-360:g;j=r*((Math.abs(S-t)>180?Math.abs(360-Math.abs(S-t)):Math.abs(S-t))/b*4+1)+o*(Math.abs(w-M)/f*4+1)+c*F}else j=V;return{suitability:V,trueSuitability:j,feature:h,angle:m,distance:y,verticalAngle:Math.abs(180*Math.atan(y/u)/Math.PI)}}}function n(t,e){const a="isOblique"in t?t:new i(t),{isOblique:s,isSpherical:h,isNadir:n}=a;return h?{hfovWeight:"2d"===e?0:1,vfovWeight:"2d"===e?0:.6,distanceWeight:"2d"===e?1:.5}:n?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:s?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}t.calculateSuitabilities=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
