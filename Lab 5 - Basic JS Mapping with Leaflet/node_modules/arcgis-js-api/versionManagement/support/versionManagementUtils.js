/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["require","exports","../../request","../../core/uuid"],(function(e,r,n,t){"use strict";const o=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),i=t.generateLowercaseBracedUUID(),s=new Map,a=new Map,u=new Map;async function c(e,r,t){if(!e||!t)return!1;if(!r)return!0;const o=new URL(e).host;let i=s.get(o);if(!i){const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");i=(await n(r,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return i===r}async function d(r,n,t=!1){if(!r||!n)return!0;const s=r.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),u=a.get(s)?.entries();if(u)for(const[a,c]of u)if(c.name===n){const r=!c.stack?.hasForwardEdits();if(!r&&t){const[{deleteForwardEdits:r},{default:n}]=await Promise.all([new Promise(((r,n)=>e(["../../rest/versionManagement/gdbVersion/deleteForwardEdits"],r,n))),new Promise(((r,n)=>e(["../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters"],(e=>r(o(e))),n)))]);return r(s,a,new n({sessionId:i,moment:c.moment}))}return r}return!0}function l(e,r){if(!e)return!1;const n=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),t=a.get(n)?.entries();if(t)for(const[o,i]of t)if(i.name===r){return"edit"===i.lockType}return!1}r.currentSessionId=i,r.defaultVersionNameLookup=s,r.isHistoricVersion=c,r.isSafeToEditVersion=d,r.isVersionInEditSession=l,r.versionCollection=a,r.versionCollectionCount=u,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})}));
