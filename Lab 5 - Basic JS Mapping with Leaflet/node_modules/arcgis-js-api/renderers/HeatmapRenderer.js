/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","../Color","../symbols","../core/deprecate","../core/lang","../core/Logger","../core/scheduling","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/utils","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./support/AuthoringInfo","./support/HeatmapColorStop","./support/HeatmapLegendOptions","./support/heatmapUtils","../symbols/SimpleMarkerSymbol"],(function(e,t,i,r,s,n,o,a,p,l,u,y,c,d,h,m,g,_,x,b){"use strict";var w;function D(e){if(null!=e){const{maxDensity:t,minDensity:i,radius:r}=e;if(null!=t||null!=i||null!=r){const{blurRadius:t,maxPixelIntensity:i,minPixelIntensity:r,...s}=e;return s}}return e}let f=w=class extends h{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new g({ratio:0,color:new t("rgba(255, 140, 0, 0)")}),new g({ratio:.75,color:new t("rgba(255, 140, 0, 1)")}),new g({ratio:.9,color:new t("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return D(e)}get blurRadius(){return x.kernelDensityRadiusPtToGaussianBlurRadiusPx(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",x.gaussianBlurRadiusPxToKernelDensityRadiusPt(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(x.magicKernelDensityRadiusInflationFactor**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){if(this._warnedProps[e])return;"user"===u.getProperties(this).getDefaultOrigin()&&(this._warnedProps[e]=!0,o.schedule((()=>{r.deprecatedProperty(n.getLogger(this),e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})})))}read(e,t){e=D(e),super.read(e,t)}getSymbol(){return new b}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&"string"==typeof i&&d.collectField(e,t,i),r&&"string"==typeof r&&await d.collectArcadeFieldNames(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new w({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:s.clone(this.colorStops),field:this.field,legendOptions:s.clone(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};e.__decorate([p.property({type:m,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],f.prototype,"authoringInfo",void 0),e.__decorate([p.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],f.prototype,"blurRadius",null),e.__decorate([p.property({type:[g],json:{write:!0}})],f.prototype,"colorStops",void 0),e.__decorate([p.property({type:String,json:{write:!0}})],f.prototype,"field",void 0),e.__decorate([p.property({type:_.HeatmapLegendOptions,json:{write:!0}})],f.prototype,"legendOptions",void 0),e.__decorate([p.property({type:Number,json:{write:!0}})],f.prototype,"maxDensity",void 0),e.__decorate([p.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],f.prototype,"maxPixelIntensity",null),e.__decorate([p.property({type:Number,json:{write:!0}})],f.prototype,"minDensity",void 0),e.__decorate([p.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],f.prototype,"minPixelIntensity",null),e.__decorate([p.property({type:Number,cast:a.toPt,json:{write:!0}})],f.prototype,"radius",void 0),e.__decorate([p.property({type:Number,range:{min:0},json:{default:0,write:!0}})],f.prototype,"referenceScale",void 0),e.__decorate([y.enumeration({heatmap:"heatmap"})],f.prototype,"type",void 0),e.__decorate([p.property({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],f.prototype,"valueExpression",void 0),e.__decorate([p.property({type:String})],f.prototype,"valueExpressionTitle",void 0),e.__decorate([p.property({readOnly:!0})],f.prototype,"_pixelIntensityToDensity",null),f=w=e.__decorate([c.subclass("esri.renderers.HeatmapRenderer")],f);return f}));
