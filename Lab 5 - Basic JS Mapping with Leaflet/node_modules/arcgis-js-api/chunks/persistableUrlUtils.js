/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../kernel","../core/urlUtils"],(function(e,t,r){"use strict";function o(e,t){const o=t?.url?.path;if(e&&o&&(e=r.makeAbsolute(e,o,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const o=r.makeRelative(e,t.portalItem.itemUrl);null!=o&&i.test(o)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(o).path)}return(e=p(e,t?.portal))&&a.test(e)?f(e):e}function n(t,o,n=e.MarkKeep.YES){if(null==(t=t&&a.test(t)?d(t):t))return t;!r.isAbsolute(t)&&o?.blockedRelativeUrls&&o.blockedRelativeUrls.push(t);let s=r.makeAbsolute(t);if(o){const e=o.verifyItemRelativeUrls?.rootPath||o.url?.path;if(e){const n=p(e,o.portal),l=p(s,o.portal);s=r.makeRelative(l,n,n);null!=s&&s!==l&&s!==t&&o.verifyItemRelativeUrls&&o.verifyItemRelativeUrls.writtenUrls.push(s)}}return s=m(s,o?.portal),r.isAbsolute(s)&&(s=r.normalize(s)),o?.resources&&o?.portalItem&&!r.isAbsolute(s)&&!r.isDataProtocol(s)&&n===e.MarkKeep.YES&&o.resources.toKeep.push({resource:o.portalItem.resourceFromPath(s),compress:!1}),s}function s(e,t,r){return o(e,r)}function l(e,t,r,o){const s=n(e,o);void 0!==s&&(t[r]=s)}const a=/\/items\/([^\/]+)\/resources\/(.*)/,i=/^\.\/resources\//;function c(e){const t=e?.match(a)??null;return t?.[1]??null}function u(e){const t=e?.match(a)??null;if(null==t)return null;const o=t[2],n=o.lastIndexOf("/");if(-1===n){const{path:e,extension:t}=r.splitPathExtension(o);return{prefix:null,filename:e,extension:t}}const{path:s,extension:l}=r.splitPathExtension(o.slice(n+1));return{prefix:o.slice(0,n),filename:s,extension:l}}function m(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?r.changeDomain(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function p(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const o=`${t.urlKey}.${t.customBaseUrl}`,n=r.getAppUrl();return r.hasSameOrigin(n,`${n.scheme}://${o}`)?r.changeDomain(e,t.portalHostname,o):r.changeDomain(e,o,t.portalHostname)}function f(e){if(!e)return e||null;let r=e;return r&&t.id&&!t.id.findCredential(r)&&(r=t.id._normalizeAGOLorgDomain(r),r=r.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),r=r.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),r=r.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),r}function d(e){if(!e)return e||null;let r=e;return r=r.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),r=r.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),r=r.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),r&&t.id&&!t.id.findCredential(r)&&(r=t.id._normalizeAGOLorgDomain(r)),r}var h;e.MarkKeep=void 0,(h=e.MarkKeep||(e.MarkKeep={}))[h.YES=0]="YES",h[h.NO=1]="NO";const U=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return e.MarkKeep},ensureMainOnlineDomain:m,fromCDNUrl:d,fromJSON:o,itemIdFromResourceUrl:c,prefixAndFilenameFromResourceUrl:u,read:s,toCDNUrl:f,toJSON:n,write:l},Symbol.toStringTag,{value:"Module"}));e.ensureMainOnlineDomain=m,e.fromCDNUrl=d,e.fromJSON=o,e.itemIdFromResourceUrl=c,e.persistableUrlUtils=U,e.prefixAndFilenameFromResourceUrl=u,e.read=s,e.toCDNUrl=f,e.toJSON=n,e.write=l}));
