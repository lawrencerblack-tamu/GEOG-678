/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","./centroid","../../core/unitUtils","../../geometry/Point","../../geometry/Polygon"],(function(e,t,n,s,a){"use strict";function r(e,t,n){const s=t[0]-e[0],a=t[1]-e[1];return Math.sqrt(s*s+a*a)}function l(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}function i(e){const t=l(e);return[e[0]/t,e[1]/t,e[2]/t]}function c(e,t,n,s){const a=i([t[0]-e[0],t[1]-e[1],t[2]*s-e[2]*s]);return[e[0]+a[0]*n,e[1]+a[1]*n,e[2]+a[2]*n]}function o(e,t,n,s){return e+(t-e)/n*s}function h(e,t,n){let s=t[0]-e[0],a=t[1]-e[1];const r=Math.sqrt(s*s+a*a);return s/=r,a/=r,s*=n,a*=n,[e[0]+s,e[1]+a]}function u(e,a){if(!e)return null;switch(e.type){case"extent":case"multipoint":case"mesh":case"point":return null}const l="polygon"===e.type?e.rings:e.paths;let i=1;if(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid){i=t.getMetersPerVerticalUnitForSR(e.spatialReference)/n.getMetersPerUnitForSR(e.spatialReference)}if(0===l.length)return null;if(0===l[0].length)return null;if(!1===e.hasM)return null;let o=-1,u=0;const f=e.hasZ?t.segmentLength3d:r,g=e.hasZ?3:2,p=2;for(const t of l){if(o++,t.length>0&&t[0][g]===a)return{partId:o,distanceAlong:u,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:t[0][0],y:t[0][1],...e.hasZ?{z:t[0][p]}:{},...e.hasM?{m:t[0][g]}:{}}),segmentId:0};let n=-1;for(let r=1;r<t.length;r++){const l=f(t[r-1],t[r],i);n++;const d=t[r][g]-t[r-1][g],m=t[r][g];if(m===a)return{partId:o,distanceAlong:l+u,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:t[r][0],y:t[r][1],...e.hasZ?{z:t[r][p]}:{},...e.hasM?{m:t[r][g]}:{}}),segmentId:n};if(m>a&&a>t[r-1][g]){const m=(a-t[r-1][g])/d*l;let R=e.hasZ?c(t[r-1],t[r],m,i):h(t[r-1],t[r],m);R=[...R,a];const M=new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:R[0],y:R[1],...e.hasZ?{z:R[p]}:{},...e.hasM?{m:R[g]}:{}});return{partId:o,distanceAlong:u+f(t[r-1],[M.x,M.y,...M.hasZ?[M.z]:[],...M.hasM?[M.m]:[]],i),coordinate:M,segmentId:n}}u+=l}}return null}function f(e,a){if(!e)return null;switch(e.type){case"extent":case"multipoint":case"mesh":case"point":return null}const l="polygon"===e.type?e.rings:e.paths;if(a<0)return null;let i=1;if(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid){i=t.getMetersPerVerticalUnitForSR(e.spatialReference)/n.getMetersPerUnitForSR(e.spatialReference)}let u=0;const f=e.hasZ?3:2,g=2,p=e.hasZ?t.segmentLength3d:r;let d=-1;if(0===a)return 0===l.length||0===l[0].length?null:{partId:0,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:l[0][0][0],y:l[0][0][1],...e.hasZ?{z:l[0][0][g]}:{},...e.hasM?{m:l[0][0][f]}:{}}),segmentId:0};for(const t of l){d++;let n=-1;for(let r=1;r<t.length;r++){n++;const l=p(t[r-1],t[r],i),m=u+l;if(m===a)return{partId:d,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:t[r][0],y:t[r][1],...e.hasZ?{z:t[r][g]}:{},...e.hasM?{m:t[r][f]}:{}}),segmentId:n};if(m>a){let p=e.hasZ?c(t[r-1],t[r],a-u,i):h(t[r-1],t[r],a-u);return p=[...p,o(t[r-1][f],t[r][f],l,a-u)],{partId:d,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:p[0],y:p[1],...e.hasZ?{z:p[g]}:{},...e.hasM?{m:p[f]}:{}}),segmentId:n}}u=m}}return null}function g(e,s){if(!e)return null;if(!s)return null;let a=1;if(s.spatialReference.vcsWkid||s.spatialReference.latestVcsWkid){a=t.getMetersPerVerticalUnitForSR(s.spatialReference)/n.getMetersPerUnitForSR(s.spatialReference)}let r=null,l=0;return r=e,l=e.hasZ&&s.hasZ?t.segmentLength3d([s.x,s.y,s.z],[e.x,e.y,e.z],a):t.segmentLength([s.x,s.y],[e.x,e.y],!1),{coordinate:r,distance:l}}function p(e,s){if(!e)return null;if(!s)return null;let a=1;if(s.spatialReference.vcsWkid||s.spatialReference.latestVcsWkid){a=t.getMetersPerVerticalUnitForSR(s.spatialReference)/n.getMetersPerUnitForSR(s.spatialReference)}let r=null,l=0,i=Number.MAX_VALUE,c=-1,o=-1;for(const n of e.points||[]){o++;const r=e.hasZ&&s.hasZ?t.segmentLength3dSqr([n[0],n[1],n[2]],[s.x,s.y,s.z],a):t.segmentLengthSqr([n[0],n[1]],[s.x,s.y],!1);r<i&&(i=r,c=o)}return c<0?null:(l=i,r=e.getPoint(c),{coordinate:r,distance:Math.sqrt(l)})}function d(e,a){if(!e)return null;if(!a)return null;const r="polygon"===e.type?e.rings:e.paths;let l=1;if(a.spatialReference.vcsWkid||a.spatialReference.latestVcsWkid){l=t.getMetersPerVerticalUnitForSR(a.spatialReference)/n.getMetersPerUnitForSR(a.spatialReference)}let i=Number.MAX_VALUE,c=-1,h=-1,u=-1;const f=e.hasZ&&a.hasZ;let g=null;const p=f?[a.x,a.y,a.z]:[a.x,a.y];for(const n of r){h++;for(let e=1;e<n.length;e++){const s=f?t.closestPointOnLineSegmentWithZ(p,n[e-1],n[e]):t.closestPointOnLineSegment(p,n[e-1],n[e]),a=f?t.segmentLength3dSqr(s,p,l):t.segmentLengthSqr(s,p,!1);a<i&&(i=a,g=s,u=h,c=e-1)}}if(c<0)return null;const d=e.hasM&&e.hasZ?3:2,m=2,R=r[u][c],M=r[u][c+1];let y=null,Z=null,x=f?g[2]:null;e.hasM&&(Z=o(R[d],M[d],f?t.segmentLength3d(R,M,l):t.segmentLength(R,M,!1),f?t.segmentLength3d(R,g,l):t.segmentLength(R,g,!1))),e.hasZ&&!1===a.hasZ&&(x=o(R[m],M[m],f?t.segmentLength3d(R,M,l):t.segmentLength(R,M,!1),f?t.segmentLength3d(R,g,l):t.segmentLength(R,g,!1))),y=new s({hasZ:f,hasM:e.hasM,spatialReference:a.spatialReference,x:g[0],y:g[1],...e.hasZ?{z:x}:{},...e.hasM?{m:Z}:{}});let L=0;for(let n=0;n<=u;n++){const s=r[n],a=n===u?c:s.length-1;for(let n=1;n<=a;n++)L+=e.hasZ?t.segmentLength3d(s[n-1],s[n],l):t.segmentLength([s[n-1][0],s[n-1][1]],[s[n][0],s[n][1]],!1)}return L+=e.hasZ?t.segmentLength3d(R,[y.x,y.y,y.z],l):t.segmentLength(R,[y.x,y.y],!1),{partId:u,segmentId:c,coordinate:y,distance:Math.sqrt(i),distanceAlong:L}}function m(e,t){if(!e)return null;if(!t)return null;if("extent"===e.type){const t=e;e=new a({spatialReference:e.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}switch(e.type){case"point":return g(e,t)??null;case"multipoint":return p(e,t)??null;case"polygon":case"polyline":return d(e,t)??null;default:return null}}e.distanceToCoordinate=f,e.measureToCoordinate=u,e.pointToCoordinate=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
