/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../executionError","../../chunks/languageUtils","../featureset/support/shared"],(function(e,n,t,r,a){"use strict";function o(e,t){return e&&e.domain?"coded-value"===e.domain.type||"codedValue"===e.domain.type?n.convertObjectToArcadeDictionary({type:"codedValue",name:e.domain.name,dataType:a.layerFieldEsriConstants[e.field.type],codedValues:e.domain.codedValues.map((e=>({name:e.name,code:e.code})))},r.defaultTimeZone(t)):n.convertObjectToArcadeDictionary({type:"range",name:e.domain.name,dataType:a.layerFieldEsriConstants[e.field.type],min:e.domain.minValue,max:e.domain.maxValue},r.defaultTimeZone(t)):null}function i(e){"async"===e.mode&&(e.functions.domain=function(n,a){return e.standardFunctionAsync(n,a,(async(e,i,u)=>{if(r.pcCheck(u,2,3,n,a),r.isFeature(u[0])){return o(r.featureFullDomain(u[0],r.toString(u[1]),void 0===u[2]?void 0:u[2]),n)}if(r.isFeatureSet(u[0])){await u[0]._ensureLoaded();return o(r.getDomain(r.toString(u[1]),u[0],null,void 0===u[2]?void 0:u[2]),n)}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,a)}))},e.functions.subtypes=function(a,o){return e.standardFunctionAsync(a,o,(async(e,i,u)=>{if(r.pcCheck(u,1,1,a,o),r.isFeature(u[0])){const e=r.featureSubtypes(u[0]);return e?n.convertObjectToArcadeDictionary(e,r.defaultTimeZone(a)):null}if(r.isFeatureSet(u[0])){await u[0]._ensureLoaded();const e=u[0].subtypeMetaData();return e?n.convertObjectToArcadeDictionary(e,r.defaultTimeZone(a)):null}throw new t.ArcadeExecutionError(a,t.ExecutionErrorCodes.InvalidParameter,o)}))},e.functions.domainname=function(n,a){return e.standardFunctionAsync(n,a,(async(e,o,i)=>{if(r.pcCheck(i,2,4,n,a),r.isFeature(i[0]))return r.featureDomainValueLookup(i[0],r.toString(i[1]),i[2],void 0===i[3]?void 0:i[3]);if(r.isFeatureSet(i[0])){await i[0]._ensureLoaded();const e=r.getDomain(r.toString(i[1]),i[0],null,void 0===i[3]?void 0:i[3]);return r.getDomainValue(e,i[2])}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,a)}))},e.signatures.push({name:"domainname",min:2,max:4}),e.functions.domaincode=function(n,a){return e.standardFunctionAsync(n,a,(async(e,o,i)=>{if(r.pcCheck(i,2,4,n,a),r.isFeature(i[0]))return r.featureDomainCodeLookup(i[0],r.toString(i[1]),i[2],void 0===i[3]?void 0:i[3]);if(r.isFeatureSet(i[0])){await i[0]._ensureLoaded();const e=r.getDomain(r.toString(i[1]),i[0],null,void 0===i[3]?void 0:i[3]);return r.getDomainCode(e,i[2])}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,a)}))},e.signatures.push({name:"domaincode",min:2,max:4})),e.functions.text=function(n,t){return e.standardFunctionAsync(n,t,((e,a,o)=>{if(r.pcCheck(o,1,2,n,t),!r.isFeatureSet(o[0]))return r.toStringExplicit(o[0],o[1]);{const n=r.defaultUndefined(o[1],"");if(""===n)return o[0].castToText();if("schema"===n.toLowerCase())return o[0].convertToText("schema",e.abortSignal);if("featureset"===n.toLowerCase())return o[0].convertToText("featureset",e.abortSignal)}}))},e.functions.gdbversion=function(n,a){return e.standardFunctionAsync(n,a,(async(e,o,i)=>{if(r.pcCheck(i,1,1,n,a),r.isFeature(i[0]))return i[0].gdbVersion();if(r.isFeatureSet(i[0])){return(await i[0].load()).gdbVersion}throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,a)}))},e.functions.schema=function(a,o){return e.standardFunctionAsync(a,o,(async(e,i,u)=>{if(r.pcCheck(u,1,1,a,o),r.isFeatureSet(u[0]))return await u[0].load(),n.convertObjectToArcadeDictionary(u[0].schema(),r.defaultTimeZone(a));if(r.isFeature(u[0])){const e=r.featureSchema(u[0]);return e?n.convertObjectToArcadeDictionary(e,r.defaultTimeZone(a)):null}throw new t.ArcadeExecutionError(a,t.ExecutionErrorCodes.InvalidParameter,o)}))}}e.registerFunctions=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
