/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../executionError","../Feature","../ImmutablePathArray","../ImmutablePointArray","../../chunks/languageUtils","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/coordsUtils","../../geometry/support/jsonUtils"],(function(e,r,t,n,a,i,o,c,s,l,f,u,m,d,E,p){"use strict";function h(e){return e&&"esri.arcade.Feature"===e.arcadeDeclaredClass}function x(e,a){e.ringisclockwise=function(e,r){return a(e,r,((n,a,c)=>{o.pcCheck(c,1,1,e,r);let s=[];if(null===c[0])return!1;if(o.isArray(c[0]))for(const i of c[0]){if(!(i instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);s.push(i.hasZ?i.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y])}else if(c[0]instanceof i)s=c[0]._elements;else{if(!o.isImmutableArray(c[0]))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);for(const n of c[0].toArray()){if(!(n instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);s.push(n.hasZ?n.hasM?[n.x,n.y,n.z,n.m]:[n.x,n.y,n.z]:[n.x,n.y])}}return!(s.length<3)&&E.isClockwise(s)}))},e.polygon=function(e,i){return a(e,i,((a,c,s)=>{o.pcCheck(s,1,1,e,i);let l=null;if(s[0]instanceof r){if(l=o.fixSpatialReference(n.parseGeometryFromDictionary(s[0],e.spatialReference),e.spatialReference),l instanceof m==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i)}else if(s[0]instanceof m)l=p.fromJSON(s[0].toJSON());else{const r=JSON.parse(s[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),l=o.fixSpatialReference(new m(r),e.spatialReference)}if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,i);return o.fixNullGeometry(l)}))},e.polyline=function(e,i){return a(e,i,((a,c,s)=>{o.pcCheck(s,1,1,e,i);let l=null;if(s[0]instanceof r){if(l=o.fixSpatialReference(n.parseGeometryFromDictionary(s[0],e.spatialReference),e.spatialReference),l instanceof d==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i)}else if(s[0]instanceof d)l=p.fromJSON(s[0].toJSON());else{const r=JSON.parse(s[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),l=o.fixSpatialReference(new d(r),e.spatialReference)}if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,i);return o.fixNullGeometry(l)}))},e.point=function(e,i){return a(e,i,((a,c,s)=>{o.pcCheck(s,1,1,e,i);let l=null;if(s[0]instanceof r){if(l=o.fixSpatialReference(n.parseGeometryFromDictionary(s[0],e.spatialReference),e.spatialReference),l instanceof u==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i)}else if(s[0]instanceof u)l=p.fromJSON(s[0].toJSON());else{const r=JSON.parse(s[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),l=o.fixSpatialReference(new u(r),e.spatialReference)}if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,i);return o.fixNullGeometry(l)}))},e.multipoint=function(e,i){return a(e,i,((a,c,s)=>{o.pcCheck(s,1,1,e,i);let l=null;if(s[0]instanceof r){if(l=o.fixSpatialReference(n.parseGeometryFromDictionary(s[0],e.spatialReference),e.spatialReference),l instanceof f==!1)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i)}else if(s[0]instanceof f)l=p.fromJSON(s[0].toJSON());else{const r=JSON.parse(s[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),l=o.fixSpatialReference(new f(r),e.spatialReference)}if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,i);return o.fixNullGeometry(l)}))},e.extent=function(e,i){return a(e,i,((a,c,l)=>{l=o.autoCastFeatureToGeometry(l),o.pcCheck(l,1,1,e,i);let E=null;if(l[0]instanceof r)E=o.fixSpatialReference(n.parseGeometryFromDictionary(l[0],e.spatialReference),e.spatialReference);else if(l[0]instanceof u){const e={xmin:l[0].x,ymin:l[0].y,xmax:l[0].x,ymax:l[0].y,spatialReference:l[0].spatialReference.toJSON()},r=l[0];r.hasZ?(e.zmin=r.z,e.zmax=r.z):r.hasM&&(e.mmin=r.m,e.mmax=r.m),E=p.fromJSON(e)}else if(l[0]instanceof m)E=p.fromJSON(l[0].extent?.toJSON());else if(l[0]instanceof d)E=p.fromJSON(l[0].extent?.toJSON());else if(l[0]instanceof f)E=p.fromJSON(l[0].extent?.toJSON());else if(l[0]instanceof s)E=p.fromJSON(l[0].toJSON());else{const r=JSON.parse(l[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),E=o.fixSpatialReference(new s(r),e.spatialReference)}if(null!==E&&!1===E.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,i);return o.fixNullGeometry(E)}))},e.geometry=function(e,i){return a(e,i,((a,c,s)=>{o.pcCheck(s,1,1,e,i);let l=null;if(null===s[0])return null;if(h(s[0]))l=o.fixSpatialReference(s[0].geometry(),e.spatialReference);else if(s[0]instanceof r)l=o.fixSpatialReference(n.parseGeometryFromDictionary(s[0],e.spatialReference),e.spatialReference);else{const r=JSON.parse(s[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),l=o.fixSpatialReference(p.fromJSON(r),e.spatialReference)}if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongSpatialReference,i);return o.fixNullGeometry(l)}))},e.setgeometry=function(e,r){return a(e,r,((n,a,i)=>{if(o.pcCheck(i,2,2,e,r),!h(i[0]))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(!0===i[0].immutable)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.Immutable,r);if(!(i[1]instanceof l||null===i[1]))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);return i[0]._geometry=i[1],o.voidOperation}))},e.feature=function(e,i){return a(e,i,((a,c,s)=>{if(0===s.length)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongNumberOfParameters,i);let f=null;if(1===s.length)if(o.isString(s[0]))f=n.fromJson(JSON.parse(s[0]),e.timeZone);else if(h(s[0]))f=n.createFromArcadeFeature(s[0]);else if(s[0]instanceof l)f=n.createFromGraphicLikeObject(s[0],null,null,e.timeZone);else{if(!(s[0]instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i);{let t=s[0].hasField("geometry")?s[0].field("geometry"):null,a=s[0].hasField("attributes")?s[0].field("attributes"):null;null!==t&&t instanceof r&&(t=n.parseGeometryFromDictionary(t,e.spatialReference)),null!==a&&(a=n.parseAttributesFromDictionary(a)),f=n.createFromGraphicLikeObject(t,a,null,e.timeZone)}}else if(2===s.length){let a=null,o=null;if(null!==s[0])if(s[0]instanceof l)a=s[0];else{if(!(a instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i);a=n.parseGeometryFromDictionary(s[0],e.spatialReference)}if(null!==s[1]){if(!(s[1]instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i);o=n.parseAttributesFromDictionary(s[1])}f=n.createFromGraphicLikeObject(a,o,null,e.timeZone)}else{let a=null;const c={};if(null!==s[0])if(s[0]instanceof l)a=s[0];else{if(!(a instanceof r))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i);a=n.parseGeometryFromDictionary(s[0],e.spatialReference)}for(let r=1;r<s.length;r+=2){const n=o.toString(s[r]),a=s[r+1];if(!(null==a||o.isString(a)||isNaN(a)||o.isDate(a)||o.isNumber(a)||o.isTime(a)||o.isDateOnly(a)||o.isBoolean(a)))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i);if(o.isFunctionParameter(a)||!1===o.isSimpleType(a))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,i);a===o.voidOperation?c[n]=null:c[n]=a}f=n.createFromGraphicLikeObject(a,c,null,e.timeZone)}return f._geometry=o.fixSpatialReference(f.geometry(),e.spatialReference),f.immutable=!1,f}))},e.dictionary=function(e,n){return a(e,n,((a,i,c)=>{if(0===c.length||1===c.length&&null===c[0]){const e=new r;return e.immutable=!1,e}if(1===c.length&&o.isString(c[0]))try{const t=JSON.parse(c[0]),n=r.convertObjectToArcadeDictionary(t,o.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(u){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(1===c.length&&c[0]instanceof l)try{const t=c[0].toJSON();t.hasZ=!0===c[0].hasZ,t.hasM=!0===c[0].hasM;const n=r.convertObjectToArcadeDictionary(t,o.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(u){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(1===c.length&&o.isFeature(c[0]))try{const e=new r;e.immutable=!1,e.setField("geometry",c[0].geometry());const t=new r;t.immutable=!1,e.setField("attributes",t);for(const r of c[0].keys())t.setField(r,c[0].field(r));return e}catch(u){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(1===c.length&&c[0]instanceof r)try{const e=new r;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}catch(u){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(2===c.length&&c[0]instanceof r&&o.isBoolean(c[1]))try{if(!(!0===c[1])){const e=new r;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}return c[0].deepClone()}catch(u){throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}if(c.length%2!=0)throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.WrongNumberOfParameters,n);const s={};for(let r=0;r<c.length;r+=2){const a=o.toString(c[r]),i=c[r+1];if(!(null==i||o.isString(i)||isNaN(i)||o.isDate(i)||o.isNumber(i)||o.isBoolean(i)||o.isDateOnly(i)||o.isTime(i)||o.isArray(i)||o.isImmutableArray(i)))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n);if(o.isFunctionParameter(i))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n);i===o.voidOperation?s[a]=null:s[a]=i}const f=new r(s);return f.immutable=!1,f}))},e.haskey=function(e,n){return a(e,n,((a,i,c)=>{o.pcCheck(c,2,2,e,n);const s=o.toString(c[1]);if(h(c[0]))return c[0].hasField(s);if(c[0]instanceof r)return c[0].hasField(s);if(c[0]instanceof l){const e=w(c[0],s,null,null,2);return!e||"notfound"!==e.keystate}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n)}))},e.hasvalue=function(e,n){return a(e,n,((a,i,c)=>{if(o.pcCheck(c,2,2,e,n),o.isArray(c[1])||o.isImmutableArray(c[1])){const a=c[1];let i=[];if(o.isImmutableArray(a))i=a.toArray();else{if(!o.isArray(a))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,n);i=a}let s=c[0];if(null===s)return!1;for(const e of i)if(o.isFeature(s)){if(!1===o.isString(e))return!1;if(!s.hasField(e))return!1;if(s=s.field(e),null===s)return!1}else if(s instanceof r){if(!1===o.isString(e))return!1;if(!s.hasField(e))return!1;if(s=s.field(e),null===s)return!1}else if(s instanceof l){if(!1===o.isString(e))return!1;if(s=w(s,e,null,null,0),null===s)return!1}else if(o.isArray(s)){if(!1===o.isNumber(e))return!1;if(s=s[e],null==s)return!1}else{if(!o.isImmutableArray(s))return!1;if(!1===o.isNumber(e))return!1;if(s=s.get(e),null==s)return!1}return!0}if(null===c[0]||null===c[1])return!1;const s=o.toString(c[1]);if(o.isFeature(c[0]))return!!c[0].hasField(s)&&null!==c[0].field(s);if(c[0]instanceof r)return!!c[0].hasField(s)&&null!==c[0].field(s);if(c[0]instanceof l){return null!==w(c[0],s,null,null,0)}return!1}))},e.indexof=function(e,r){return a(e,r,((n,a,i)=>{o.pcCheck(i,2,2,e,r);const c=i[1];if(o.isArray(i[0])){for(let e=0;e<i[0].length;e++)if(o.equalityTest(c,i[0][e]))return e;return-1}if(o.isImmutableArray(i[0])){const e=i[0].length();for(let r=0;r<e;r++)if(o.equalityTest(c,i[0].get(r)))return r;return-1}throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r)}))},e.angle=function(e,r){return a(e,r,((n,a,i)=>{if(i=o.autoCastFeatureToGeometry(i),o.pcCheck(i,2,3,e,r),!(i[0]instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(!(i[1]instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(i.length>2&&!(i[2]instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);return 2===i.length?c.angle2D(i[0],i[1]):c.angleBetween2D(i[0],i[1],i[2])}))},e.bearing=function(e,r){return a(e,r,((n,a,i)=>{if(i=o.autoCastFeatureToGeometry(i),o.pcCheck(i,2,3,e,r),!(i[0]instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(!(i[1]instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);if(i.length>2&&!(i[2]instanceof u))throw new t.ArcadeExecutionError(e,t.ExecutionErrorCodes.InvalidParameter,r);return 2===i.length?c.bearing2D(i[0],i[1]):c.bearingBetween2D(i[0],i[1],i[2])}))},e.isselfintersecting=function(e,r){return a(e,r,((t,n,a)=>{a=o.autoCastFeatureToGeometry(a),o.pcCheck(a,1,1,e,r);let i=a[0];if(i instanceof m)return i.isSelfIntersecting;if(i instanceof d)return i=i.paths,c.pathsSelfIntersecting(i);if(i instanceof f){const e=i.points;for(let r=0;r<e.length;r++)for(let t=0;t<e.length;t++)if(t!==r){let n=!0;for(let a=0;a<e[r].length;a++)if(e[r][a]!==e[t][a]){n=!1;break}if(!0===n)return!0}}return!(!o.isArray(i)&&!o.isImmutableArray(i))&&(i=o.autoCastArrayOfPointsToPolyline(i,e.spatialReference),null!==i&&(i=i.paths),c.pathsSelfIntersecting(i))}))}}let y=0;function w(e,n,o,c,s=1){let l;switch(n=n.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let r=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(r=!1),r&&(y++,e.spatialReference._arcadeCacheId=y,t=y)}const n=new r({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(n){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const r=e[n];return void 0!==r?r:null}case"type":return"Extent"}break;case"polygon":switch(n){case"rings":l=e.cache._arcadeCacheId,void 0===l&&(y++,l=y,e.cache._arcadeCacheId=l);return new a(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,l);case"type":return"Polygon"}break;case"point":switch(n){case"x":case"y":case"z":case"m":return void 0!==e[n]?e[n]:null;case"type":return"Point"}break;case"polyline":switch(n){case"paths":l=e.cache._arcadeCacheId,void 0===l&&(y++,l=y,e.cache._arcadeCacheId=l);return new a(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,l);case"type":return"Polyline"}break;case"multipoint":switch(n){case"points":l=e.cache._arcadeCacheId,void 0===l&&(y++,l=y,e.cache._arcadeCacheId=l);return new i(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,l,1);case"type":return"Multipoint"}}if(1===s)throw new t.ArcadeExecutionError(o,t.ExecutionErrorCodes.InvalidIdentifier,c);return 2===s?{keystate:"notfound"}:null}e.geometryMember=w,e.registerFunctions=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
