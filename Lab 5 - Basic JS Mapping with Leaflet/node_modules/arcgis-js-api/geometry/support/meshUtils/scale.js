/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../core/libs/gl-matrix-2/math/mat4","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../core/libs/gl-matrix-2/factories/quatf64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../Point","../../spatialReferenceEllipsoidUtils","../../projection/projectPointToVector","../axisAngleDegrees","../MeshTransform","../meshVertexSpaceUtils","./geographicUtils","./projection","./vertexSpaceConversion"],(function(e,t,r,o,i,n,a,l,c,s,p,g,f,u,m,x){"use strict";const P="esri.geometry.support.meshUtils.scale";function d(e,t,r){if(!e.vertexAttributes?.position)return;const{vertexSpace:o,spatialReference:i}=e,n=r?.origin??e.anchor,a=r?.geographic,l=u.usesLocalTangentPlaneOnECEFForOperations(P,o,i,a);f.isMeshWithRelativeVertexSpace(e)?j(e,t,n):l?h(e,t,n):v(e,t,n)}function j(e,o,c){e.transform??=new g;const{vertexSpace:s,transform:f,spatialReference:u}=e,[m,d,j]=s.origin,h=new l({x:m,y:d,z:j,spatialReference:u}),v=F;if(h.equals(c))n.set(v,0,0,0);else if(!x.projectPointToVertexSpace(v,c,e))return void t.getLogger(P).error(`Failed to project specified origin (wkid:${c.spatialReference.wkid}) to mesh (wkid:${u.wkid}) ${s.type} vertex space. Projection may be possible after calling projection.load().`);const b=n.set(T,o,o,o),R=r.fromRotationTranslationScaleOrigin(w,i.IDENTITY,a.ZEROS,b,v),{localMatrix:S}=f,y=r.multiply(w,R,S);f.scale=r.getScaling(a.create(),y),r.scale(y,y,n.inverse(F,f.scale)),f.rotation=p.fromMatrix(y),f.translation=r.getTranslation(a.create(),y)}function h(e,t,r){const o=e.spatialReference,i=c.getSphericalPCPF(o),n=R;s.projectPointToVector(r,n,i)||s.projectPointToVector(e.origin,n,i);const a=e.vertexAttributes.position,l=e.vertexAttributes.normal,p=e.vertexAttributes.tangent,g=new Float64Array(a.length),f=null!=l?new Float32Array(l.length):null,u=null!=p?new Float32Array(p.length):null;m.projectToPCPF(a,o,g),null!=l&&null!=f&&m.projectNormalToPCPF(l,a,g,o,f),null!=p&&null!=u&&m.projectTangentToPCPF(p,a,g,o,u),b(g,t,n),m.projectFromPCPF(g,a,o),null!=l&&null!=f&&m.projectNormalFromPCPF(f,a,g,o,l),null!=p&&null!=u&&m.projectTangentFromPCPF(u,a,g,o,p),e.vertexAttributesChanged()}function v(e,r,o){const i=R;if(!s.projectPointToVector(o,i,e.spatialReference)){const r=e.origin;i[0]=r.x,i[1]=r.y,i[2]=r.z,t.getLogger(P).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}b(e.vertexAttributes.position,r,i),e.vertexAttributesChanged()}function b(e,t,r=a.ZEROS){if(e)for(let o=0;o<e.length;o+=3){for(let t=0;t<3;t++)F[t]=e[o+t]-r[t];n.scale(F,F,t);for(let t=0;t<3;t++)e[o+t]=F[t]+r[t]}}const F=a.create(),T=a.create(),w=o.create(),R=a.create();e.scale=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
