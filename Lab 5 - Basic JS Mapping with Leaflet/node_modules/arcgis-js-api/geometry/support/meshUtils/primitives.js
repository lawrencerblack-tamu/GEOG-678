/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../MeshComponent","../MeshVertexAttributes","./georeference"],(function(e,t,r,n,o,a,i){"use strict";function s(){const{faceDescriptions:e,faceVertexOffsets:t,uvScales:r}=d,n=4*e.length,o=new Float64Array(3*n),a=new Float32Array(3*n),i=new Float32Array(2*n),s=new Uint32Array(2*e.length*3);let c=0,l=0,f=0,u=0;for(let h=0;h<e.length;h++){const n=e[h],p=c/3;for(const e of t)s[u++]=p+e;const g=n.corners;for(let e=0;e<4;e++){const t=g[e];let s=0;i[f++]=.25*r[e][0]+n.uvOrigin[0],i[f++]=n.uvOrigin[1]-.25*r[e][1];for(let e=0;e<3;e++)0!==n.axis[e]?(o[c++]=.5*n.axis[e],a[l++]=n.axis[e]):(o[c++]=.5*t[s++],a[l++]=0)}}return{position:o,normal:a,uv:i,faces:s}}function c(e,t){const r=e.components[0],n=r.faces,a=M[t],i=6*a,s=new Array(6),c=new Array(n.length-6);let l=0,f=0;for(let o=0;o<n.length;o++)o>=i&&o<i+6?s[l++]=n[o]:c[f++]=n[o];if(null!=e.vertexAttributes.uv){const t=new Float32Array(e.vertexAttributes.uv),r=4*a*2,n=[0,1,1,1,1,0,0,0];for(let e=0;e<n.length;e++)t[r+e]=n[e];e.vertexAttributes.uv=t}return e.components=[new o({faces:s,material:r.material}),new o({faces:c})],e}function l(e=0){const t=Math.round(8*2**e),r=2*t,n=(t-1)*(r+1)+2*r,o=new Float64Array(3*n),a=new Float32Array(3*n),i=new Float32Array(2*n),s=new Uint32Array(3*((t-1)*r*2));let c=0,l=0,f=0,u=0;for(let h=0;h<=t;h++){const e=h/t*Math.PI+.5*Math.PI,n=Math.cos(e),p=Math.sin(e);S[2]=p;const g=0===h||h===t,w=g?r-1:r;for(let v=0;v<=w;v++){const e=v/w*2*Math.PI;S[0]=-Math.sin(e)*n,S[1]=Math.cos(e)*n;for(let t=0;t<3;t++)o[c]=.5*S[t],a[c]=S[t],++c;i[l++]=(v+(g?.5:0))/r,i[l++]=h/t,0!==h&&v!==r&&(h!==t&&(s[f++]=u,s[f++]=u+1,s[f++]=u-r),1!==h&&(s[f++]=u,s[f++]=u-r,s[f++]=u-r-1)),u++}}return{position:o,normal:a,uv:i,faces:s}}function f(e=0){const t=5,r=Math.round(16*2**e),n=(t-1)*(r+1)+2*r,o=new Float64Array(3*n),a=new Float32Array(3*n),i=new Float32Array(2*n),s=new Uint32Array(3*(4*r));let c=0,l=0,f=0,u=0,h=0;for(let p=0;p<=t;p++){const e=0===p||p===t,n=p<=1||p>=t-1,g=2===p||4===p,w=e?r-1:r;for(let v=0;v<=w;v++){const m=v/w*2*Math.PI,x=e?0:.5;S[0]=x*Math.sin(m),S[1]=x*-Math.cos(m),S[2]=p<=2?.5:-.5;for(let e=0;e<3;e++)o[c++]=S[e],a[l++]=n?2===e?p<=1?1:-1:0:2===e?0:S[e]/x;i[f++]=(v+(e?.5:0))/r,i[f++]=p<=1?1*p/3:p<=3?1*(p-2)/3+1/3:1*(p-4)/3+2/3,g||0===p||v===r||(p!==t&&(s[u++]=h,s[u++]=h+1,s[u++]=h-r),1!==p&&(s[u++]=h,s[u++]=h-r,s[u++]=h-r-1)),h++}}return{position:o,normal:a,uv:i,faces:s}}function u(e,t){const r="number"==typeof t?t:null!=t?t.width:1,n="number"==typeof t?t:null!=t?t.height:1;switch(e){case"up":case"down":return{width:r,depth:n};case"north":case"south":return{width:r,height:n};case"east":case"west":return{depth:r,height:n}}}function h(e){const t=v.facingAxisOrderSwap[e],r=v.position,n=v.normal,o=new Float64Array(r.length),a=new Float32Array(n.length);let i=0;for(let s=0;s<4;s++){const e=i;for(let s=0;s<3;s++){const c=t[s],l=Math.abs(c)-1,f=c>=0?1:-1;o[i]=r[e+l]*f,a[i]=n[e+l]*f,i++}}return{position:o,normal:a,uv:new Float32Array(v.uv),faces:new Uint32Array(v.faces),isPlane:!0}}const p=1,g=2,w=3,v={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[w,p,g],west:[-w,-p,g],north:[-p,w,g],south:[p,-w,g],up:[p,g,w],down:[p,-g,-w]}};function m(e,t,r){e.isPlane||x(e),y(e,A(r?.size,r?.unit,t.spatialReference));const{vertexAttributes:n,vertexSpace:s,transform:c}=i.georeferenceByTransform(e,t,{vertexSpace:r?.vertexSpace,geographic:r?.geographic});return{vertexAttributes:new a.MeshVertexAttributes({...n,uv:e.uv}),vertexSpace:s,transform:c,components:[new o({faces:e.faces,material:r?.material||null})],spatialReference:t.spatialReference}}function x(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function A(e,t,r){const n=i.getUnitScale(t,r);if(null==e&&1===n)return null;if(null==e)return[n,n,n];if("number"==typeof e){const t=e*n;return[t,t,t]}return[null!=e.width?e.width*n:n,null!=e.depth?e.depth*n:n,null!=e.height?e.height*n:n]}function y(e,t){if(null!=t){b[0]=t[0],b[4]=t[1],b[8]=t[2];for(let t=0;t<e.position.length;t+=3){for(let r=0;r<3;r++)S[r]=e.position[t+r];r.transformMat3(S,S,b);for(let r=0;r<3;r++)e.position[t+r]=S[r]}if(t[0]!==t[1]||t[1]!==t[2]){b[0]=1/t[0],b[4]=1/t[1],b[8]=1/t[2];for(let t=0;t<e.normal.length;t+=3){for(let r=0;r<3;r++)S[r]=e.normal[t+r];r.transformMat3(S,S,b),r.normalize(S,S);for(let r=0;r<3;r++)e.normal[t+r]=S[r]}}}}const d={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},M={south:0,east:1,north:2,west:3,up:4,down:5},S=n.create(),b=t.create();e.boxFaceOrder=M,e.convertPlaneSizeParameter=u,e.convertUnitGeometry=m,e.createUnitSizeBox=s,e.createUnitSizeCylinder=f,e.createUnitSizePlane=h,e.createUnitSizeSphere=l,e.extractSingleFaceOfBox=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
