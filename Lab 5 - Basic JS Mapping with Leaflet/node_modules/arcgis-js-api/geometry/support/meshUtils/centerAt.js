/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../projection/projectPointToVector","../meshVertexSpaceUtils","./geographicUtils","./georeference"],(function(e,t,r,o,i,n,c,a){"use strict";const s="esri.geometry.support.meshUtils.centerAt";function l(e,t,r){if(!e.vertexAttributes?.position)return;const{vertexSpace:o}=e,i=r?.origin??e.anchor,a=r?.geographic,l=c.usesLocalTangentPlaneOnECEFForOperations(s,o,i.spatialReference,a);n.isRelativeVertexSpace(o)?p(e,t,i):l?f(e,t,i):g(e,t,i)}function p(e,c,a){const{vertexSpace:l}=e;if(!n.isRelativeVertexSpace(l))return;const p=b,f=u;if(!i.projectPointToVector(c,f,e.spatialReference))return void t.getLogger(s).error(`Failed to project centerAt location (wkid:${c.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!i.projectPointToVector(a,p,e.spatialReference)){const r=e.origin;p[0]=r.x,p[1]=r.y,p[2]=r.z,t.getLogger(s).error(`Failed to project specified origin (wkid:${a.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}const g=r.subtract(j,f,p);l.origin=r.add(o.create(),l.origin,g)}function f(e,t,r){const o=a.ungeoreferenceGlobal(e.vertexAttributes,r),{position:i,normal:n,tangent:c}=a.georeferenceGlobal(o,t,!1);e.vertexAttributes.position=i,e.vertexAttributes.normal=n,e.vertexAttributes.tangent=c,e.vertexAttributesChanged()}function g(e,r,o){const n=b,c=u;if(i.projectPointToVector(r,c,e.spatialReference)){if(!i.projectPointToVector(o,n,e.spatialReference)){const r=e.origin;n[0]=r.x,n[1]=r.y,n[2]=r.z,t.getLogger(s).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}d(e.vertexAttributes.position,c,n),e.vertexAttributesChanged()}else t.getLogger(s).error(`Failed to project centerAt location (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function d(e,t,r){if(e)for(let o=0;o<e.length;o+=3)for(let i=0;i<3;i++)e[o+i]+=t[i]-r[i]}const u=o.create(),b=o.create(),j=o.create();e.centerAt=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
