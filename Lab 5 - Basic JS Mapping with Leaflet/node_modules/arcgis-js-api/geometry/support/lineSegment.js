/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../core/mathUtils","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],(function(t,e,r,n,c,o){"use strict";function i(t){return t?{origin:c.clone(t.origin),vector:c.clone(t.vector)}:{origin:c.create(),vector:c.create()}}function s(t,e){const r=y.get();return r.origin=t,r.vector=e,r}function a(t,e=i()){return u(t.origin,t.vector,e)}function u(t,e,r=i()){return n.copy(r.origin,t),n.copy(r.vector,e),r}function d(t,e,r=i()){return n.copy(r.origin,t),n.subtract(r.vector,e,t),r}function g(t,r){const c=n.subtract(o.sv3d.get(),r,t.origin),i=n.dot(t.vector,c),s=n.dot(t.vector,t.vector),a=e.clamp(i/s,0,1),u=n.subtract(o.sv3d.get(),n.scale(o.sv3d.get(),t.vector,a),c);return n.dot(u,u)}function v(t,e,r){return l(t,e,0,1,r)}function f(t,e,r){return n.add(r,t.origin,n.scale(r,t.vector,e))}function l(t,r,c,i,s){const{vector:a,origin:u}=t,d=n.subtract(o.sv3d.get(),r,u),g=n.dot(a,d)/n.squaredLength(a);return n.scale(s,a,e.clamp(g,c,i)),n.add(s,s,t.origin)}function p(t,e){if(m(t,s(e.origin,e.direction),!1,h)){const{tA:e,pB:r,distance2:c}=h;if(e>=0&&e<=1)return c;if(e<0)return n.squaredDistance(t.origin,r);if(e>1)return n.squaredDistance(n.add(o.sv3d.get(),t.origin,t.vector),r)}return null}function b(t,e,r){return!!m(t,e,!0,h)&&(n.copy(r,h.pA),!0)}function m(t,r,c,i){const s=1e-6,a=t.origin,u=n.add(o.sv3d.get(),a,t.vector),d=r.origin,g=n.add(o.sv3d.get(),d,r.vector),v=o.sv3d.get(),f=o.sv3d.get();if(v[0]=a[0]-d[0],v[1]=a[1]-d[1],v[2]=a[2]-d[2],f[0]=g[0]-d[0],f[1]=g[1]-d[1],f[2]=g[2]-d[2],Math.abs(f[0])<s&&Math.abs(f[1])<s&&Math.abs(f[2])<s)return!1;const l=o.sv3d.get();if(l[0]=u[0]-a[0],l[1]=u[1]-a[1],l[2]=u[2]-a[2],Math.abs(l[0])<s&&Math.abs(l[1])<s&&Math.abs(l[2])<s)return!1;const p=v[0]*f[0]+v[1]*f[1]+v[2]*f[2],b=f[0]*l[0]+f[1]*l[1]+f[2]*l[2],m=v[0]*l[0]+v[1]*l[1]+v[2]*l[2],h=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],y=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*h-b*b;if(Math.abs(y)<s)return!1;let M=(p*b-m*h)/y,A=(p+b*M)/h;c&&(M=e.clamp(M,0,1),A=e.clamp(A,0,1));const S=o.sv3d.get(),j=o.sv3d.get();return S[0]=a[0]+M*l[0],S[1]=a[1]+M*l[1],S[2]=a[2]+M*l[2],j[0]=d[0]+A*f[0],j[1]=d[1]+A*f[1],j[2]=d[2]+A*f[2],i.tA=M,i.tB=A,i.pA=S,i.pB=j,i.distance2=n.squaredDistance(S,j),!0}const h={tA:0,tB:0,pA:c.create(),pB:c.create(),distance2:0},y=new r.ObjectStack((()=>i()));t.closestLineSegmentPoint=b,t.closestRayDistance2=p,t.copy=a,t.create=i,t.distance2=g,t.fromPoints=d,t.fromValues=u,t.pointAt=f,t.projectPoint=v,t.projectPointClamp=l,t.wrap=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
