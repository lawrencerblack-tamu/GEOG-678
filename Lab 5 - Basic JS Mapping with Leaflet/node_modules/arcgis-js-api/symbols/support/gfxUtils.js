/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../assets","../../Color","../../request","../../core/LRUCache","../../core/screenUtils","./cimSymbolUtils"],(function(t,e,o,r,s,n,l){"use strict";const a="picture-fill",i="simple-fill",c="simple-line",d="simple-marker",h="text",p="cim",u=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),y=new s.LRUCache(1e3);function f(t){const o=t.style;let r=null;if(t)switch(t.type){case d:"cross"!==o&&"x"!==o&&(r=t.color);break;case i:o&&"solid"!==o?"none"!==o&&(r={type:"pattern",x:0,y:0,src:e.getAssetUrl(`esri/symbols/patterns/${o}.png`),width:5,height:5}):r=t.color;break;case a:r={type:"pattern",src:t.url,width:n.pt2px(t.width)*t.xscale,height:n.pt2px(t.height)*t.yscale,x:n.pt2px(t.xoffset),y:n.pt2px(t.yoffset)};break;case h:r=t.color;break;case p:r=l.getCIMSymbolColor(t)}return r}function g(t,e){const o=t+"-"+e;return void 0!==y.get(o)?Promise.resolve(y.get(o)):r(t,{responseType:"image"}).then((t=>{const r=t.data,s=r.naturalWidth,n=r.naturalHeight,l=document.createElement("canvas");l.width=s,l.height=n;const a=l.getContext("2d");a.fillStyle=e,a.fillRect(0,0,s,n),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const i=l.toDataURL();return y.put(o,i),i}))}function m(t){if(!t)return null;let e=null;switch(t.type){case i:case a:case d:e=m(t.outline);break;case c:{const o=n.pt2px(t.width);null!=t.style&&"none"!==t.style&&0!==o&&(e={color:t.color,style:x(t.style),width:o,cap:t.cap,join:"miter"===t.join?n.pt2px(t.miterLimit):t.join},e.dashArray=b(e).join(",")||"none");break}default:e=null}return e}function b(t){if(!t?.style)return[];const{dashArray:e,style:o,width:r}=t;if("string"==typeof e&&"none"!==e)return e.split(",").map((t=>Number(t)));const s=r??0,n=u.has(o)?u.get(o).map((t=>t*s)):[];if("butt"!==t.cap)for(const[l,a]of n.entries())n[l]=l%2==1?a+s:Math.max(a-s,1);return n}const x=(()=>{const t={};return e=>{if(t[e])return t[e];const o=e.replaceAll("-","");return t[e]=o,o}})(),w=new o([128,128,128]);t.defaultThematicColor=w,t.dekebabifyLineStyle=x,t.getDashArray=b,t.getFill=f,t.getPatternUrlWithColor=g,t.getStroke=m,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
