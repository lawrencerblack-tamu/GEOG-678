/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../core/urlUtils","../../chunks/persistableUrlUtils"],(function(e,t,r){"use strict";function a(e,r,a){return r.imageData?t.makeData({mediaType:r.contentType||"image/png",isBase64:!0,data:r.imageData}):i(r.url,a)}function i(e,a){if(!t.isAbsolute(e)){const r=l(a);if(r)return t.join(r,"images",e)}return r.fromJSON(e,a)}function n(e,a,i,n){if(t.isDataProtocol(e)){const o=t.dataComponents(e);if(!o)return;a.contentType=o.mediaType,a.imageData=o.data,i&&i.imageData===a.imageData&&i.url&&r.write(i.url,a,"url",n)}else r.write(e,a,"url",n)}const o={json:{read:{source:["imageData","url"],reader:a},write:{writer(e,t,r,a){n(e,t,this.source,a)}}}},u={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const a={};return t.imageData&&(a.imageData=t.imageData),t.contentType&&(a.contentType=t.contentType),t.url&&(a.url=i(t.url,r)),a}}}};function l(e){if(!e)return null;const{origin:t,layer:r}=e;if("service"!==t&&"portal-item"!==t)return null;const a=r?.type;return"feature"===a||"stream"===a?r.parsedUrl?.path:"map-image"===a||"tile"===a?e.url?.path:null}e.read=i,e.readImageDataOrUrl=a,e.sourcePropertyDefinition=u,e.urlPropertyDefinition=o,e.writeImageDataAndUrl=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
