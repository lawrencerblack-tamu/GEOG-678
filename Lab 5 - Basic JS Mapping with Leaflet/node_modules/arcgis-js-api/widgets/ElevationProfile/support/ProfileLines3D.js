/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/tslib.es6","../../../Color","../../../core/Accessor","../../../core/reactiveUtils","../../../core/throttle","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/Polyline","../../../views/3d/interactive/visualElements/OutlineVisualElement","./constants"],(function(e,t,s,o,r,i,l,n,a,c,h,u,d,f,p){"use strict";const m=100;e.ProfileLines3D=class extends o{constructor(e){super(e),this._chartData=null,this._visualElements=[]}initialize(){const e=i.throttle((e=>{this._update(e)}),m);this.addHandles([r.watch((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),e,r.syncAndInitial),e])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(e){this._chartData=e}_update(e){const{chartData:t}=e;if(null==t)return this.remove();if(!t.refined)return;const o=this._visualElements,r=t.lines.filter((e=>e.viewVisualizationEnabled)),i=r.length;for(;o.length>i;)o.pop().destroy();const l=p.getConfig().profileLinesStyle3D;for(;o.length<i;){const e=new f.OutlineVisualElement({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:l.width-l.outlineSize,width:l.width,falloff:l.falloff,color:l.outlineColor,renderOccluded:l.renderOccluded,isDecoration:!0});o.push(e)}const n=e.spatialReference;for(let a=0;a<i;++a){const e=o[a],t=r[i-1-a];e.geometry=this._createLineGeometry(t,n),e.innerColor=u.fromArray(s.toUnitRGBA(t.color))}}_createLineGeometry(e,t){const s=e.samples??[],o=s.length-1,r=[];let i=[];for(let l=0;l<=o;l++){const{x:e,y:t,z:n}=s[l];null!=n&&i.push([e,t,n]),l!==o&&null!=n||!i.length||(r.push(i),i=[])}return new d({paths:r,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach((e=>e.destroy())),this._visualElements.length=0}},t.__decorate([l.property()],e.ProfileLines3D.prototype,"view",void 0),t.__decorate([l.property()],e.ProfileLines3D.prototype,"_chartData",void 0),e.ProfileLines3D=t.__decorate([h.subclass("esri.widgets.ElevationProfile.support.ProfileLines3D")],e.ProfileLines3D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
