/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../chunks/tslib.es6","../../Color","../../core/handleUtils","../../core/memoize","../../core/reactiveUtils","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ElevationProfileLine","./support/elevationQuerySourceUtils"],(function(e,r,o,t,n,i,s,a,l,u,c,p,d){"use strict";let y=class extends p{constructor(e){super(e),this.type="ground",this.color=new r("#ff7f00"),this.viewVisualizationEnabled=!0,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getQueryElevationDependencies=t.memoize(((e,r)=>({ground:e,groundLayers:r})))}get available(){const e=this._ground;return null!=e&&e.layers.some((e=>e.visible))}get minDemResolution(){return d.getGroundMinDemResolution(this._ground)}get _queryElevationDependencies(){return this._getQueryElevationDependencies(this._ground,this._groundLayers)}get _ground(){return this._viewModel?.view?.map?.ground}get _groundLayers(){return this._ground?.layers?.toArray()??[]}async queryElevation(e,r){const o=this._queryElevationDependencies;if(null==o)throw new Error("ElevationProfileLineGround: no dependencies");const{ground:t}=o;if(null==t)throw new Error("No ground configured in the view");const n=await t.queryElevation(e,r),s=i.getMetersPerVerticalUnitForSR(e.spatialReference),a=i.getMetersPerVerticalUnitForSR(t.layers.at(0).spatialReference);if(s!==a){const e=n.geometry;e.points=e.points.map((([e,o,t])=>[e,o,t===r.noDataValue?t:t*a/s]))}return n}attach(e){return o.handlesGroup([super.attach(e),n.watch((()=>this._queryElevationDependencies),(()=>this._onChange()))])}};e.__decorate([s.property({type:r,nonNullable:!0})],y.prototype,"color",void 0),e.__decorate([s.property()],y.prototype,"viewVisualizationEnabled",void 0),e.__decorate([s.property()],y.prototype,"available",null),e.__decorate([s.property({readOnly:!0})],y.prototype,"minDemResolution",null),e.__decorate([s.property()],y.prototype,"_queryElevationDependencies",null),e.__decorate([s.property()],y.prototype,"_ground",null),e.__decorate([s.property()],y.prototype,"_groundLayers",null),y=e.__decorate([c.subclass("esri.widgets.ElevationProfile.ElevationProfileLineGround")],y);return y}));
