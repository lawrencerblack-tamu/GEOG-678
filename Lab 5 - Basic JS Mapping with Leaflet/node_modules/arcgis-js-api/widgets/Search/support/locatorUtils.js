/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../../Graphic","../../../geometry/Polygon","../../../geometry/support/geometryUtils","../../../rest/locator/addressToLocations","../../../rest/locator/locationToAddress","../../../rest/locator/suggestLocations","../../../rest/support/AddressToLocationsParameters","../../../rest/support/LocationToAddressParameters","../../../rest/support/SuggestLocationsParameters"],(function(e,t,o,r,n,s,c,i,a,u){"use strict";const l="Single Line Input",d=3e5;function g(e,t){return e.location?v(e,t):I(e,t)}function f(e,t){if(t.localSearchDisabled)return null;const o=e?.scale;return"number"==typeof o&&o<=d?e?.extent?.center:null}async function m(e,t){const{source:o,spatialReference:r,view:n,suggestTerm:s,maxSuggestions:i,sourceIndex:a}=e,l=new u,{apiKey:d,url:g}=o,m=w(o,n),y=t?.signal;if(!g)return null;d&&(l.apiKey=d),o.categories&&(l.categories=o.categories),r&&(l.outSpatialReference=r);const p=f(n,o);p&&(l.location=p);if(!s.trim())return null;const{prefix:x="",suffix:S=""}=o,v=`${x}${s}${S}`;return l.text=v,m&&(l.searchExtent=m),l.maxSuggestions=i,o.countryCode&&(l.countryCode=o.countryCode),c.suggestLocations(g,l,{signal:y}).then((e=>G(e,a)))}function y(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function p(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function x(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const S="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";async function v(e,t){const{source:o,spatialReference:r,location:n,sourceIndex:c,view:i}=e,{apiKey:u,url:l,zoomScale:d,defaultZoomScale:g}=o;if(null==l)return[];const f=i?.scale,m=t?.signal,y=new a;y.location=n,u&&(y.apiKey=u),r&&(y.outSpatialReference=r);try{return b([await s.locationToAddress(l,y,{signal:m})],{sourceIndex:c,scale:f,view:i,zoomScale:d,defaultZoomScale:g})}catch(p){return[]}}function w(e,t){const{filter:o,withinViewEnabled:n}=e,s=t?.scale,c=t?.extent,i=o?.geometry;return(i?r.createExtentFromGeometry(i,t??void 0,s):void 0)||(n&&c?c:void 0)}async function I(e,t){const{source:o,suggestResult:r,spatialReference:s,view:c,maxResults:a,sourceIndex:u}=e,d=o?.zoomScale,g=o?.defaultZoomScale,m=r.text?.trim();if(!m)return null;const y=!r.key&&o.prefix?o.prefix:"",p=!r.key&&o.suffix?o.suffix:"",x=`${y}${r.text}${p}`,S=new i,{apiKey:v,url:I}=o,L=c?.scale,G=w(o,c),T=t?.signal;if(v&&(S.apiKey=v),!I)return null;o.categories&&(S.categories=o.categories),o.locationType&&(S.locationType=o.locationType),s&&(S.outSpatialReference=s);const h=f(c,o);h&&(S.location=h),S.maxLocations=a,G&&(S.searchExtent=G),o.countryCode&&(S.countryCode=o.countryCode);const{key:R}=r,$=`${R}`;return R&&(S.magicKey=$),S.address={},S.address[o.singleLineFieldName||l]=x,o.outFields&&(S.outFields=o.outFields),n.addressToLocations(I,S,{signal:T}).then((e=>b(e,{key:$,scale:L,sourceIndex:u,view:c,zoomScale:d,defaultZoomScale:g})))}function L(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function G(e,t){return e.map((e=>L(e,t)))}function T(e,n){const{key:s,scale:c,sourceIndex:i,view:a,zoomScale:u,defaultZoomScale:l}=n,{attributes:d,extent:g,location:f,address:m}=e,y=new t({geometry:f,attributes:d}),p=g||f,x=p?r.createExtentFromGeometry(p,a??void 0,c??void 0):void 0,S=x?"number"==typeof u?r.scaleExtent(x,a??void 0,u):"number"==typeof l&&"point"===p?.type?r.scaleExtent(x,a??void 0,l):x:null,v=f?`${f.x},${f.y}`:"",w=m||v,I=y.clone();return null!=S&&(I.geometry=o.fromExtent(S)),{extent:S,feature:y,target:I,key:s,name:w,sourceIndex:i}}function b(e,t){return e.filter(Boolean).map((e=>T(e,t)))}e.getLocation=f,e.getResults=g,e.getSuggestions=m,e.isArcGISWorldGeocoder=x,e.isMeteredArcGISWorldGeocoder=y,e.isProxiedArcGISWorldGeocoder=p,e.meteredArcGISLocatorUrl=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
