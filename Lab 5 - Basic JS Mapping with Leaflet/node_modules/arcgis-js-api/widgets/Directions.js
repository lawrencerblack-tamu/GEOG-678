/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../intl","../core/events","../core/handleUtils","../core/maybe","../core/reactiveUtils","../core/string","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/RandomLCG","../core/has","../core/accessorSupport/decorators/subclass","../properties/defaultUnit","../rest/support/Stop","../symbols/SimpleMarkerSymbol","./Search","./Widget","./Directions/css","./Directions/DirectionsViewModel","./Directions/components/SaveLayer","./Directions/support/directionsUtils","./Search/support/locatorUtils","../chunks/componentsUtils","./support/globalCss","./support/Heading","./support/legacyIcon","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/jsxFactory","./support/widgetUtils","../intl/number"],(function(e,t,n,o,i,r,s,a,l,c,d,u,h,p,v,m,g,f,_,b,y,w,S,C,D,M,T,x,E,I,k,P){"use strict";function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){N(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(){return B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},B.apply(this,arguments)}function H(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}function L(e,t){if(null==e)return{};var n,o,i=H(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var F="1.15.2";function U(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var z=U(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Y=U(/Edge/i),X=U(/firefox/i),j=U(/safari/i)&&!U(/chrome/i)&&!U(/android/i),$=U(/iP(ad|od|hone)/i),W=U(/chrome/i)&&U(/android/i),V={capture:!1,passive:!1};function G(e,t,n){e.addEventListener(t,n,!z&&V)}function q(e,t,n){e.removeEventListener(t,n,!z&&V)}function K(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(n){return!1}return!1}}function Z(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Q(e,t,n,o){if(e){n=n||document;do{if(null!=t&&(">"===t[0]?e.parentNode===n&&K(e,t):K(e,t))||o&&e===n)return e;if(e===n)break}while(e=Z(e))}return null}var J,ee=/\s+/g;function te(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var o=(" "+e.className+" ").replace(ee," ").replace(" "+t+" "," ");e.className=(o+(n?" "+t:"")).replace(ee," ")}}function ne(e,t,n){var o=e&&e.style;if(o){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in o||-1!==t.indexOf("webkit")||(t="-webkit-"+t),o[t]=n+("string"==typeof n?"":"px")}}function oe(e,t){var n="";if("string"==typeof e)n=e;else do{var o=ne(e,"transform");o&&"none"!==o&&(n=o+" "+n)}while(!t&&(e=e.parentNode));var i=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return i&&new i(n)}function ie(e,t,n){if(e){var o=e.getElementsByTagName(t),i=0,r=o.length;if(n)for(;i<r;i++)n(o[i],i);return o}return[]}function re(){var e=document.scrollingElement;return e||document.documentElement}function se(e,t,n,o,i){if(e.getBoundingClientRect||e===window){var r,s,a,l,c,d,u;if(e!==window&&e.parentNode&&e!==re()?(s=(r=e.getBoundingClientRect()).top,a=r.left,l=r.bottom,c=r.right,d=r.height,u=r.width):(s=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||n)&&e!==window&&(i=i||e.parentNode,!z))do{if(i&&i.getBoundingClientRect&&("none"!==ne(i,"transform")||n&&"static"!==ne(i,"position"))){var h=i.getBoundingClientRect();s-=h.top+parseInt(ne(i,"border-top-width")),a-=h.left+parseInt(ne(i,"border-left-width")),l=s+r.height,c=a+r.width;break}}while(i=i.parentNode);if(o&&e!==window){var p=oe(i||e),v=p&&p.a,m=p&&p.d;p&&(l=(s/=m)+(d/=m),c=(a/=v)+(u/=v))}return{top:s,left:a,bottom:l,right:c,width:u,height:d}}}function ae(e,t,n){for(var o=pe(e,!0),i=se(e)[t];o;){var r=se(o)[n];if(!("top"===n||"left"===n?i>=r:i<=r))return o;if(o===re())break;o=pe(o,!1)}return!1}function le(e,t,n,o){for(var i=0,r=0,s=e.children;r<s.length;){if("none"!==s[r].style.display&&s[r]!==Dt.ghost&&(o||s[r]!==Dt.dragged)&&Q(s[r],n.draggable,e,!1)){if(i===t)return s[r];i++}r++}return null}function ce(e,t){for(var n=e.lastElementChild;n&&(n===Dt.ghost||"none"===ne(n,"display")||t&&!K(n,t));)n=n.previousElementSibling;return n||null}function de(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Dt.clone||t&&!K(e,t)||n++;return n}function ue(e){var t=0,n=0,o=re();if(e)do{var i=oe(e),r=i.a,s=i.d;t+=e.scrollLeft*r,n+=e.scrollTop*s}while(e!==o&&(e=e.parentNode));return[t,n]}function he(e,t){for(var n in e)if(e.hasOwnProperty(n))for(var o in t)if(t.hasOwnProperty(o)&&t[o]===e[n][o])return Number(n);return-1}function pe(e,t){if(!e||!e.getBoundingClientRect)return re();var n=e,o=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var i=ne(n);if(n.clientWidth<n.scrollWidth&&("auto"==i.overflowX||"scroll"==i.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==i.overflowY||"scroll"==i.overflowY)){if(!n.getBoundingClientRect||n===document.body)return re();if(o||t)return n;o=!0}}}while(n=n.parentNode);return re()}function ve(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function me(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function ge(e,t){return function(){if(!J){var n=arguments,o=this;1===n.length?e.call(o,n[0]):e.apply(o,n),J=setTimeout((function(){J=void 0}),t)}}}function fe(){clearTimeout(J),J=void 0}function _e(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function be(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function ye(e,t,n){var o={};return Array.from(e.children).forEach((function(i){var r,s,a,l;if(Q(i,t.draggable,e,!1)&&!i.animated&&i!==n){var c=se(i);o.left=Math.min(null!==(r=o.left)&&void 0!==r?r:1/0,c.left),o.top=Math.min(null!==(s=o.top)&&void 0!==s?s:1/0,c.top),o.right=Math.max(null!==(a=o.right)&&void 0!==a?a:-1/0,c.right),o.bottom=Math.max(null!==(l=o.bottom)&&void 0!==l?l:-1/0,c.bottom)}})),o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}var we="Sortable"+(new Date).getTime();function Se(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==ne(e,"display")&&e!==Dt.ghost){t.push({target:e,rect:se(e)});var n=A({},t[t.length-1].rect);if(e.thisAnimationDuration){var o=oe(e,!0);o&&(n.top-=o.f,n.left-=o.e)}e.fromRect=n}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(he(t,{target:e}),1)},animateAll:function(n){var o=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof n&&n());var i=!1,r=0;t.forEach((function(e){var t=0,n=e.target,s=n.fromRect,a=se(n),l=n.prevFromRect,c=n.prevToRect,d=e.rect,u=oe(n,!0);u&&(a.top-=u.f,a.left-=u.e),n.toRect=a,n.thisAnimationDuration&&me(l,a)&&!me(s,a)&&(d.top-a.top)/(d.left-a.left)==(s.top-a.top)/(s.left-a.left)&&(t=De(d,l,c,o.options)),me(a,s)||(n.prevFromRect=s,n.prevToRect=a,t||(t=o.options.animation),o.animate(n,d,a,t)),t&&(i=!0,r=Math.max(r,t),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout((function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null}),t),n.thisAnimationDuration=t)})),clearTimeout(e),i?e=setTimeout((function(){"function"==typeof n&&n()}),r):"function"==typeof n&&n(),t=[]},animate:function(e,t,n,o){if(o){ne(e,"transition",""),ne(e,"transform","");var i=oe(this.el),r=i&&i.a,s=i&&i.d,a=(t.left-n.left)/(r||1),l=(t.top-n.top)/(s||1);e.animatingX=!!a,e.animatingY=!!l,ne(e,"transform","translate3d("+a+"px,"+l+"px,0)"),this.forRepaintDummy=Ce(e),ne(e,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),ne(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){ne(e,"transition",""),ne(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),o)}}}}function Ce(e){return e.offsetWidth}function De(e,t,n,o){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*o.animation}var Me=[],Te={initializeByDefault:!0},xe={mount:function(e){for(var t in Te)Te.hasOwnProperty(t)&&!(t in e)&&(e[t]=Te[t]);Me.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),Me.push(e)},pluginEvent:function(e,t,n){var o=this;this.eventCanceled=!1,n.cancel=function(){o.eventCanceled=!0};var i=e+"Global";Me.forEach((function(o){t[o.pluginName]&&(t[o.pluginName][i]&&t[o.pluginName][i](A({sortable:t},n)),t.options[o.pluginName]&&t[o.pluginName][e]&&t[o.pluginName][e](A({sortable:t},n)))}))},initializePlugins:function(e,t,n,o){for(var i in Me.forEach((function(o){var i=o.pluginName;if(e.options[i]||o.initializeByDefault){var r=new o(e,t,e.options);r.sortable=e,r.options=e.options,e[i]=r,B(n,r.defaults)}})),e.options)if(e.options.hasOwnProperty(i)){var r=this.modifyOption(e,i,e.options[i]);void 0!==r&&(e.options[i]=r)}},getEventProperties:function(e,t){var n={};return Me.forEach((function(o){"function"==typeof o.eventProperties&&B(n,o.eventProperties.call(t[o.pluginName],e))})),n},modifyOption:function(e,t,n){var o;return Me.forEach((function(i){e[i.pluginName]&&i.optionListeners&&"function"==typeof i.optionListeners[t]&&(o=i.optionListeners[t].call(e[i.pluginName],n))})),o}};function Ee(e){var t=e.sortable,n=e.rootEl,o=e.name,i=e.targetEl,r=e.cloneEl,s=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,p=e.putSortable,v=e.extraEventProperties;if(t=t||n&&n[we]){var m,g=t.options,f="on"+o.charAt(0).toUpperCase()+o.substr(1);!window.CustomEvent||z||Y?(m=document.createEvent("Event")).initEvent(o,!0,!0):m=new CustomEvent(o,{bubbles:!0,cancelable:!0}),m.to=s||n,m.from=a||n,m.item=i||n,m.clone=r,m.oldIndex=l,m.newIndex=c,m.oldDraggableIndex=d,m.newDraggableIndex=u,m.originalEvent=h,m.pullMode=p?p.lastPutMode:void 0;var _=A(A({},v),xe.getEventProperties(o,t));for(var b in _)m[b]=_[b];n&&n.dispatchEvent(m),g[f]&&g[f].call(t,m)}}var Ie=["evt"],ke=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.evt,i=L(n,Ie);xe.pluginEvent.bind(Dt)(e,t,A({dragEl:Re,parentEl:Ae,ghostEl:Oe,rootEl:Ne,nextEl:Be,lastDownEl:He,cloneEl:Le,cloneHidden:Fe,dragStarted:Qe,putSortable:$e,activeSortable:Dt.active,originalEvent:o,oldIndex:Ue,oldDraggableIndex:Ye,newIndex:ze,newDraggableIndex:Xe,hideGhostForTarget:yt,unhideGhostForTarget:wt,cloneNowHidden:function(){Fe=!0},cloneNowShown:function(){Fe=!1},dispatchSortableEvent:function(e){Pe({sortable:t,name:e,originalEvent:o})}},i))};function Pe(e){Ee(A({putSortable:$e,cloneEl:Le,targetEl:Re,rootEl:Ne,oldIndex:Ue,oldDraggableIndex:Ye,newIndex:ze,newDraggableIndex:Xe},e))}var Re,Ae,Oe,Ne,Be,He,Le,Fe,Ue,ze,Ye,Xe,je,$e,We,Ve,Ge,qe,Ke,Ze,Qe,Je,et,tt,nt,ot=!1,it=!1,rt=[],st=!1,at=!1,lt=[],ct=!1,dt=[],ut="undefined"!=typeof document,ht=$,pt=Y||z?"cssFloat":"float",vt=ut&&!W&&!$&&"draggable"in document.createElement("div"),mt=function(){if(ut){if(z)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),gt=function(e,t){var n=ne(e),o=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),i=le(e,0,t),r=le(e,1,t),s=i&&ne(i),a=r&&ne(r),l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+se(i).width,c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+se(r).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&s.float&&"none"!==s.float){var d="left"===s.float?"left":"right";return!r||"both"!==a.clear&&a.clear!==d?"horizontal":"vertical"}return i&&("block"===s.display||"flex"===s.display||"table"===s.display||"grid"===s.display||l>=o&&"none"===n[pt]||r&&"none"===n[pt]&&l+c>o)?"vertical":"horizontal"},ft=function(e,t,n){var o=n?e.left:e.top,i=n?e.right:e.bottom,r=n?e.width:e.height,s=n?t.left:t.top,a=n?t.right:t.bottom,l=n?t.width:t.height;return o===s||i===a||o+r/2===s+l/2},_t=function(e,t){var n;return rt.some((function(o){var i=o[we].options.emptyInsertThreshold;if(i&&!ce(o)){var r=se(o),s=e>=r.left-i&&e<=r.right+i,a=t>=r.top-i&&t<=r.bottom+i;return s&&a?n=o:void 0}})),n},bt=function(e){function t(e,n){return function(o,i,r,s){var a=o.options.group.name&&i.options.group.name&&o.options.group.name===i.options.group.name;if(null==e&&(n||a))return!0;if(null==e||!1===e)return!1;if(n&&"clone"===e)return e;if("function"==typeof e)return t(e(o,i,r,s),n)(o,i,r,s);var l=(n?o:i).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var n={},o=e.group;o&&"object"==O(o)||(o={name:o}),n.name=o.name,n.checkPull=t(o.pull,!0),n.checkPut=t(o.put),n.revertClone=o.revertClone,e.group=n},yt=function(){!mt&&Oe&&ne(Oe,"display","none")},wt=function(){!mt&&Oe&&ne(Oe,"display","")};ut&&!W&&document.addEventListener("click",(function(e){if(it)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),it=!1,!1}),!0);var St=function(e){if(Re){e=e.touches?e.touches[0]:e;var t=_t(e.clientX,e.clientY);if(t){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[we]._onDragOver(n)}}},Ct=function(e){Re&&Re.parentNode[we]._isOutsideThisEl(e.target)};function Dt(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=B({},t),e[we]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return gt(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Dt.supportPointer&&"PointerEvent"in window&&!j,emptyInsertThreshold:5};for(var o in xe.initializePlugins(this,e,n),n)!(o in t)&&(t[o]=n[o]);for(var i in bt(t),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=!t.forceFallback&&vt,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?G(e,"pointerdown",this._onTapStart):(G(e,"mousedown",this._onTapStart),G(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(G(e,"dragover",this),G(e,"dragenter",this)),rt.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),B(this,Se())}function Mt(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function Tt(e,t,n,o,i,r,s,a){var l,c,d=e[we],u=d.options.onMove;return!window.CustomEvent||z||Y?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=n,l.draggedRect=o,l.related=i||t,l.relatedRect=r||se(t),l.willInsertAfter=a,l.originalEvent=s,e.dispatchEvent(l),u&&(c=u.call(d,l,s)),c}function xt(e){e.draggable=!1}function Et(){ct=!1}function It(e,t,n){var o=se(le(n.el,0,n.options,!0)),i=ye(n.el,n.options,Oe),r=10;return t?e.clientX<i.left-r||e.clientY<o.top&&e.clientX<o.right:e.clientY<i.top-r||e.clientY<o.bottom&&e.clientX<o.left}function kt(e,t,n){var o=se(ce(n.el,n.options.draggable)),i=ye(n.el,n.options,Oe),r=10;return t?e.clientX>i.right+r||e.clientY>o.bottom&&e.clientX>o.left:e.clientY>i.bottom+r||e.clientX>o.right&&e.clientY>o.top}function Pt(e,t,n,o,i,r,s,a){var l=o?e.clientY:e.clientX,c=o?n.height:n.width,d=o?n.top:n.left,u=o?n.bottom:n.right,h=!1;if(!s)if(a&&tt<c*i){if(!st&&(1===et?l>d+c*r/2:l<u-c*r/2)&&(st=!0),st)h=!0;else if(1===et?l<d+tt:l>u-tt)return-et}else if(l>d+c*(1-i)/2&&l<u-c*(1-i)/2)return Rt(t);return(h=h||s)&&(l<d+c*r/2||l>u-c*r/2)?l>d+c/2?1:-1:0}function Rt(e){return de(Re)<de(e)?1:-1}function At(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,o=0;n--;)o+=t.charCodeAt(n);return o.toString(36)}function Ot(e){dt.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var o=t[n];o.checked&&dt.push(o)}}function Nt(e){return setTimeout(e,0)}function Bt(e){return clearTimeout(e)}Dt.prototype={constructor:Dt,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Je=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,Re):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,o=this.options,i=o.preventOnFilter,r=e.type,s=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(s||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,c=o.filter;if(Ot(n),!Re&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||o.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!j||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=Q(a,o.draggable,n,!1))&&a.animated||He===a)){if(Ue=de(a),Ye=de(a,o.draggable),"function"==typeof c){if(c.call(this,e,a,this))return Pe({sortable:t,rootEl:l,name:"filter",targetEl:a,toEl:n,fromEl:n}),ke("filter",t,{evt:e}),void(i&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some((function(o){if(o=Q(l,o.trim(),n,!1))return Pe({sortable:t,rootEl:o,name:"filter",targetEl:a,fromEl:n,toEl:n}),ke("filter",t,{evt:e}),!0}))))return void(i&&e.cancelable&&e.preventDefault());o.handle&&!Q(l,o.handle,n,!1)||this._prepareDragStart(e,s,a)}}},_prepareDragStart:function(e,t,n){var o,i=this,r=i.el,s=i.options,a=r.ownerDocument;if(n&&!Re&&n.parentNode===r){var l=se(n);if(Ne=r,Ae=(Re=n).parentNode,Be=Re.nextSibling,He=n,je=s.group,Dt.dragged=Re,We={target:Re,clientX:(t||e).clientX,clientY:(t||e).clientY},Ke=We.clientX-l.left,Ze=We.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,Re.style["will-change"]="all",o=function(){ke("delayEnded",i,{evt:e}),Dt.eventCanceled?i._onDrop():(i._disableDelayedDragEvents(),!X&&i.nativeDraggable&&(Re.draggable=!0),i._triggerDragStart(e,t),Pe({sortable:i,name:"choose",originalEvent:e}),te(Re,s.chosenClass,!0))},s.ignore.split(",").forEach((function(e){ie(Re,e.trim(),xt)})),G(a,"dragover",St),G(a,"mousemove",St),G(a,"touchmove",St),G(a,"mouseup",i._onDrop),G(a,"touchend",i._onDrop),G(a,"touchcancel",i._onDrop),X&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Re.draggable=!0),ke("delayStart",this,{evt:e}),!s.delay||s.delayOnTouchOnly&&!t||this.nativeDraggable&&(Y||z))o();else{if(Dt.eventCanceled)return void this._onDrop();G(a,"mouseup",i._disableDelayedDrag),G(a,"touchend",i._disableDelayedDrag),G(a,"touchcancel",i._disableDelayedDrag),G(a,"mousemove",i._delayedDragTouchMoveHandler),G(a,"touchmove",i._delayedDragTouchMoveHandler),s.supportPointer&&G(a,"pointermove",i._delayedDragTouchMoveHandler),i._dragStartTimer=setTimeout(o,s.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Re&&xt(Re),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;q(e,"mouseup",this._disableDelayedDrag),q(e,"touchend",this._disableDelayedDrag),q(e,"touchcancel",this._disableDelayedDrag),q(e,"mousemove",this._delayedDragTouchMoveHandler),q(e,"touchmove",this._delayedDragTouchMoveHandler),q(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?G(document,"pointermove",this._onTouchMove):G(document,t?"touchmove":"mousemove",this._onTouchMove):(G(Re,"dragend",this),G(Ne,"dragstart",this._onDragStart));try{document.selection?Nt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(n){}},_dragStarted:function(e,t){if(ot=!1,Ne&&Re){ke("dragStarted",this,{evt:t}),this.nativeDraggable&&G(document,"dragover",Ct);var n=this.options;!e&&te(Re,n.dragClass,!1),te(Re,n.ghostClass,!0),Dt.active=this,e&&this._appendGhost(),Pe({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Ve){this._lastX=Ve.clientX,this._lastY=Ve.clientY,yt();for(var e=document.elementFromPoint(Ve.clientX,Ve.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Ve.clientX,Ve.clientY))!==t;)t=e;if(Re.parentNode[we]._isOutsideThisEl(e),t)do{if(t[we]){if(t[we]._onDragOver({clientX:Ve.clientX,clientY:Ve.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);wt()}},_onTouchMove:function(e){if(We){var t=this.options,n=t.fallbackTolerance,o=t.fallbackOffset,i=e.touches?e.touches[0]:e,r=Oe&&oe(Oe,!0),s=Oe&&r&&r.a,a=Oe&&r&&r.d,l=ht&&nt&&ue(nt),c=(i.clientX-We.clientX+o.x)/(s||1)+(l?l[0]-lt[0]:0)/(s||1),d=(i.clientY-We.clientY+o.y)/(a||1)+(l?l[1]-lt[1]:0)/(a||1);if(!Dt.active&&!ot){if(n&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(Oe){r?(r.e+=c-(Ge||0),r.f+=d-(qe||0)):r={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");ne(Oe,"webkitTransform",u),ne(Oe,"mozTransform",u),ne(Oe,"msTransform",u),ne(Oe,"transform",u),Ge=c,qe=d,Ve=i}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Oe){var e=this.options.fallbackOnBody?document.body:Ne,t=se(Re,!0,ht,!0,e),n=this.options;if(ht){for(nt=e;"static"===ne(nt,"position")&&"none"===ne(nt,"transform")&&nt!==document;)nt=nt.parentNode;nt!==document.body&&nt!==document.documentElement?(nt===document&&(nt=re()),t.top+=nt.scrollTop,t.left+=nt.scrollLeft):nt=re(),lt=ue(nt)}te(Oe=Re.cloneNode(!0),n.ghostClass,!1),te(Oe,n.fallbackClass,!0),te(Oe,n.dragClass,!0),ne(Oe,"transition",""),ne(Oe,"transform",""),ne(Oe,"box-sizing","border-box"),ne(Oe,"margin",0),ne(Oe,"top",t.top),ne(Oe,"left",t.left),ne(Oe,"width",t.width),ne(Oe,"height",t.height),ne(Oe,"opacity","0.8"),ne(Oe,"position",ht?"absolute":"fixed"),ne(Oe,"zIndex","100000"),ne(Oe,"pointerEvents","none"),Dt.ghost=Oe,e.appendChild(Oe),ne(Oe,"transform-origin",Ke/parseInt(Oe.style.width)*100+"% "+Ze/parseInt(Oe.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,o=e.dataTransfer,i=n.options;ke("dragStart",this,{evt:e}),Dt.eventCanceled?this._onDrop():(ke("setupClone",this),Dt.eventCanceled||((Le=be(Re)).removeAttribute("id"),Le.draggable=!1,Le.style["will-change"]="",this._hideClone(),te(Le,this.options.chosenClass,!1),Dt.clone=Le),n.cloneId=Nt((function(){ke("clone",n),Dt.eventCanceled||(n.options.removeCloneOnHide||Ne.insertBefore(Le,Re),n._hideClone(),Pe({sortable:n,name:"clone"}))})),!t&&te(Re,i.dragClass,!0),t?(it=!0,n._loopId=setInterval(n._emulateDragOver,50)):(q(document,"mouseup",n._onDrop),q(document,"touchend",n._onDrop),q(document,"touchcancel",n._onDrop),o&&(o.effectAllowed="move",i.setData&&i.setData.call(n,o,Re)),G(document,"drop",n),ne(Re,"transform","translateZ(0)")),ot=!0,n._dragStartId=Nt(n._dragStarted.bind(n,t,e)),G(document,"selectstart",n),Qe=!0,j&&ne(document.body,"user-select","none"))},_onDragOver:function(e){var t,n,o,i,r=this.el,s=e.target,a=this.options,l=a.group,c=Dt.active,d=je===l,u=a.sort,h=$e||c,p=this,v=!1;if(!ct){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=Q(s,a.draggable,r,!0),I("dragOver"),Dt.eventCanceled)return v;if(Re.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||p._ignoreWhileAnimating===s)return P(!1);if(it=!1,c&&!a.disabled&&(d?u||(o=Ae!==Ne):$e===this||(this.lastPutMode=je.checkPull(this,c,Re,e))&&l.checkPut(this,c,Re,e))){if(i="vertical"===this._getDirection(e,s),t=se(Re),I("dragOverValid"),Dt.eventCanceled)return v;if(o)return Ae=Ne,k(),this._hideClone(),I("revert"),Dt.eventCanceled||(Be?Ne.insertBefore(Re,Be):Ne.appendChild(Re)),P(!0);var m=ce(r,a.draggable);if(!m||kt(e,i,this)&&!m.animated){if(m===Re)return P(!1);if(m&&r===e.target&&(s=m),s&&(n=se(s)),!1!==Tt(Ne,r,Re,t,s,n,e,!!s))return k(),m&&m.nextSibling?r.insertBefore(Re,m.nextSibling):r.appendChild(Re),Ae=r,R(),P(!0)}else if(m&&It(e,i,this)){var g=le(r,0,a,!0);if(g===Re)return P(!1);if(n=se(s=g),!1!==Tt(Ne,r,Re,t,s,n,e,!1))return k(),r.insertBefore(Re,g),Ae=r,R(),P(!0)}else if(s.parentNode===r){n=se(s);var f,_,b=0,y=Re.parentNode!==r,w=!ft(Re.animated&&Re.toRect||t,s.animated&&s.toRect||n,i),S=i?"top":"left",C=ae(s,"top","top")||ae(Re,"top","top"),D=C?C.scrollTop:void 0;if(Je!==s&&(f=n[S],st=!1,at=!w&&a.invertSwap||y),0!==(b=Pt(e,s,n,i,w?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,at,Je===s))){var M=de(Re);do{M-=b,_=Ae.children[M]}while(_&&("none"===ne(_,"display")||_===Oe))}if(0===b||_===s)return P(!1);Je=s,et=b;var T=s.nextElementSibling,x=!1,E=Tt(Ne,r,Re,t,s,n,e,x=1===b);if(!1!==E)return 1!==E&&-1!==E||(x=1===E),ct=!0,setTimeout(Et,30),k(),x&&!T?r.appendChild(Re):s.parentNode.insertBefore(Re,x?T:s),C&&_e(C,0,D-C.scrollTop),Ae=Re.parentNode,void 0===f||at||(tt=Math.abs(f-se(s)[S])),R(),P(!0)}if(r.contains(Re))return P(!1)}return!1}function I(a,l){ke(a,p,A({evt:e,isOwner:d,axis:i?"vertical":"horizontal",revert:o,dragRect:t,targetRect:n,canSort:u,fromSortable:h,target:s,completed:P,onMove:function(n,o){return Tt(Ne,r,Re,t,n,se(n),e,o)},changed:R},l))}function k(){I("dragOverAnimationCapture"),p.captureAnimationState(),p!==h&&h.captureAnimationState()}function P(t){return I("dragOverCompleted",{insertion:t}),t&&(d?c._hideClone():c._showClone(p),p!==h&&(te(Re,$e?$e.options.ghostClass:c.options.ghostClass,!1),te(Re,a.ghostClass,!0)),$e!==p&&p!==Dt.active?$e=p:p===Dt.active&&$e&&($e=null),h===p&&(p._ignoreWhileAnimating=s),p.animateAll((function(){I("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(s===Re&&!Re.animated||s===r&&!s.animated)&&(Je=null),a.dragoverBubble||e.rootEl||s===document||(Re.parentNode[we]._isOutsideThisEl(e.target),!t&&St(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),v=!0}function R(){ze=de(Re),Xe=de(Re,a.draggable),Pe({sortable:p,name:"change",toEl:r,newIndex:ze,newDraggableIndex:Xe,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){q(document,"mousemove",this._onTouchMove),q(document,"touchmove",this._onTouchMove),q(document,"pointermove",this._onTouchMove),q(document,"dragover",St),q(document,"mousemove",St),q(document,"touchmove",St)},_offUpEvents:function(){var e=this.el.ownerDocument;q(e,"mouseup",this._onDrop),q(e,"touchend",this._onDrop),q(e,"pointerup",this._onDrop),q(e,"touchcancel",this._onDrop),q(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;ze=de(Re),Xe=de(Re,n.draggable),ke("drop",this,{evt:e}),Ae=Re&&Re.parentNode,ze=de(Re),Xe=de(Re,n.draggable),Dt.eventCanceled||(ot=!1,at=!1,st=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Bt(this.cloneId),Bt(this._dragStartId),this.nativeDraggable&&(q(document,"drop",this),q(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),j&&ne(document.body,"user-select",""),ne(Re,"transform",""),e&&(Qe&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),Oe&&Oe.parentNode&&Oe.parentNode.removeChild(Oe),(Ne===Ae||$e&&"clone"!==$e.lastPutMode)&&Le&&Le.parentNode&&Le.parentNode.removeChild(Le),Re&&(this.nativeDraggable&&q(Re,"dragend",this),xt(Re),Re.style["will-change"]="",Qe&&!ot&&te(Re,$e?$e.options.ghostClass:this.options.ghostClass,!1),te(Re,this.options.chosenClass,!1),Pe({sortable:this,name:"unchoose",toEl:Ae,newIndex:null,newDraggableIndex:null,originalEvent:e}),Ne!==Ae?(ze>=0&&(Pe({rootEl:Ae,name:"add",toEl:Ae,fromEl:Ne,originalEvent:e}),Pe({sortable:this,name:"remove",toEl:Ae,originalEvent:e}),Pe({rootEl:Ae,name:"sort",toEl:Ae,fromEl:Ne,originalEvent:e}),Pe({sortable:this,name:"sort",toEl:Ae,originalEvent:e})),$e&&$e.save()):ze!==Ue&&ze>=0&&(Pe({sortable:this,name:"update",toEl:Ae,originalEvent:e}),Pe({sortable:this,name:"sort",toEl:Ae,originalEvent:e})),Dt.active&&(null!=ze&&-1!==ze||(ze=Ue,Xe=Ye),Pe({sortable:this,name:"end",toEl:Ae,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){ke("nulling",this),Ne=Re=Ae=Oe=Be=Le=He=Fe=We=Ve=Qe=ze=Xe=Ue=Ye=Je=et=$e=je=Dt.dragged=Dt.ghost=Dt.clone=Dt.active=null,dt.forEach((function(e){e.checked=!0})),dt.length=Ge=qe=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Re&&(this._onDragOver(e),Mt(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],n=this.el.children,o=0,i=n.length,r=this.options;o<i;o++)Q(e=n[o],r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||At(e));return t},sort:function(e,t){var n={},o=this.el;this.toArray().forEach((function(e,t){var i=o.children[t];Q(i,this.options.draggable,o,!1)&&(n[e]=i)}),this),t&&this.captureAnimationState(),e.forEach((function(e){n[e]&&(o.removeChild(n[e]),o.appendChild(n[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return Q(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(void 0===t)return n[e];var o=xe.modifyOption(this,e,t);n[e]=void 0!==o?o:t,"group"===e&&bt(n)},destroy:function(){ke("destroy",this);var e=this.el;e[we]=null,q(e,"mousedown",this._onTapStart),q(e,"touchstart",this._onTapStart),q(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(q(e,"dragover",this),q(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),rt.splice(rt.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Fe){if(ke("hideClone",this),Dt.eventCanceled)return;ne(Le,"display","none"),this.options.removeCloneOnHide&&Le.parentNode&&Le.parentNode.removeChild(Le),Fe=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Fe){if(ke("showClone",this),Dt.eventCanceled)return;Re.parentNode!=Ne||this.options.group.revertClone?Be?Ne.insertBefore(Le,Be):Ne.appendChild(Le):Ne.insertBefore(Le,Re),this.options.group.revertClone&&this.animate(Re,Le),ne(Le,"display",""),Fe=!1}}else this._hideClone()}},ut&&G(document,"touchmove",(function(e){(Dt.active||ot)&&e.cancelable&&e.preventDefault()})),Dt.utils={on:G,off:q,css:ne,find:ie,is:function(e,t){return!!Q(e,t,e,!1)},extend:ve,throttle:ge,closest:Q,toggleClass:te,clone:be,index:de,nextTick:Nt,cancelNextTick:Bt,detectDirection:gt,getChild:le},Dt.get=function(e){return e[we]},Dt.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Dt.utils=A(A({},Dt.utils),e.utils)),xe.mount(e)}))},Dt.create=function(e,t){return new Dt(e,t)},Dt.version=F;var Ht,Lt,Ft,Ut,zt,Yt,Xt=[],jt=!1;function $t(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?G(document,"dragover",this._handleAutoScroll):this.options.supportPointer?G(document,"pointermove",this._handleFallbackAutoScroll):t.touches?G(document,"touchmove",this._handleFallbackAutoScroll):G(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?q(document,"dragover",this._handleAutoScroll):(q(document,"pointermove",this._handleFallbackAutoScroll),q(document,"touchmove",this._handleFallbackAutoScroll),q(document,"mousemove",this._handleFallbackAutoScroll)),Vt(),Wt(),fe()},nulling:function(){zt=Lt=Ht=jt=Yt=Ft=Ut=null,Xt.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var n=this,o=(e.touches?e.touches[0]:e).clientX,i=(e.touches?e.touches[0]:e).clientY,r=document.elementFromPoint(o,i);if(zt=e,t||this.options.forceAutoScrollFallback||Y||z||j){Gt(e,this.options,r,t);var s=pe(r,!0);!jt||Yt&&o===Ft&&i===Ut||(Yt&&Vt(),Yt=setInterval((function(){var r=pe(document.elementFromPoint(o,i),!0);r!==s&&(s=r,Wt()),Gt(e,n.options,r,t)}),10),Ft=o,Ut=i)}else{if(!this.options.bubbleScroll||pe(r,!0)===re())return void Wt();Gt(e,this.options,pe(r,!1),!1)}}},B(e,{pluginName:"scroll",initializeByDefault:!0})}function Wt(){Xt.forEach((function(e){clearInterval(e.pid)})),Xt=[]}function Vt(){clearInterval(Yt)}var Gt=ge((function(e,t,n,o){if(t.scroll){var i,r=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,l=t.scrollSpeed,c=re(),d=!1;Lt!==n&&(Lt=n,Wt(),Ht=t.scroll,i=t.scrollFn,!0===Ht&&(Ht=pe(n,!0)));var u=0,h=Ht;do{var p=h,v=se(p),m=v.top,g=v.bottom,f=v.left,_=v.right,b=v.width,y=v.height,w=void 0,S=void 0,C=p.scrollWidth,D=p.scrollHeight,M=ne(p),T=p.scrollLeft,x=p.scrollTop;p===c?(w=b<C&&("auto"===M.overflowX||"scroll"===M.overflowX||"visible"===M.overflowX),S=y<D&&("auto"===M.overflowY||"scroll"===M.overflowY||"visible"===M.overflowY)):(w=b<C&&("auto"===M.overflowX||"scroll"===M.overflowX),S=y<D&&("auto"===M.overflowY||"scroll"===M.overflowY));var E=w&&(Math.abs(_-r)<=a&&T+b<C)-(Math.abs(f-r)<=a&&!!T),I=S&&(Math.abs(g-s)<=a&&x+y<D)-(Math.abs(m-s)<=a&&!!x);if(!Xt[u])for(var k=0;k<=u;k++)Xt[k]||(Xt[k]={});Xt[u].vx==E&&Xt[u].vy==I&&Xt[u].el===p||(Xt[u].el=p,Xt[u].vx=E,Xt[u].vy=I,clearInterval(Xt[u].pid),0==E&&0==I||(d=!0,Xt[u].pid=setInterval(function(){o&&0===this.layer&&Dt.active._onTouchMove(zt);var t=Xt[this.layer].vy?Xt[this.layer].vy*l:0,n=Xt[this.layer].vx?Xt[this.layer].vx*l:0;"function"==typeof i&&"continue"!==i.call(Dt.dragged.parentNode[we],n,t,e,zt,Xt[this.layer].el)||_e(Xt[this.layer].el,n,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==c&&(h=pe(h,!1)));jt=d}}),30),qt=function(e){var t=e.originalEvent,n=e.putSortable,o=e.dragEl,i=e.activeSortable,r=e.dispatchSortableEvent,s=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var l=n||i;s();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);a(),l&&!l.el.contains(d)&&(r("spill"),this.onSpill({dragEl:o,putSortable:n}))}};function Kt(){}function Zt(){}Kt.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var o=le(this.sortable.el,this.startIndex,this.options);o?this.sortable.el.insertBefore(t,o):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:qt},B(Kt,{pluginName:"revertOnSpill"}),Zt.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable||this.sortable;n.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),n.animateAll()},drop:qt},B(Zt,{pluginName:"removeOnSpill"}),Dt.mount(new $t),Dt.mount(Zt,Kt);const Qt={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function Jt(e){const{branchName:t,displayText:n,exitName:o,intersectingName:i,name:r,objectId:s,towardName:l}=e;if(null==n)return null;const c=[t,o,i,r,l].filter(Boolean).sort(((e,t)=>t.length-e.length)).map((e=>a.escapeRegExpString(e)));if(!c.length)return n;const d=new RegExp(c.join("|"),"g"),u=n.matchAll(d);let h=0;const p=[];for(const{0:a,index:v}of u)p.push(n.slice(h,v),I.tsx("span",{class:_.css.maneuverPlaceName},a)),h=v+a.length;return p.push(n.slice(h)),I.tsx("span",{id:`${_.css.maneuver}-${s}`},p)}function en(e){return!!e.composedPath?.().find((e=>e.classList?.contains("esri-search__suggestions-list")))}function tn(e){const t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())}const nn="search-term",on=100,rn=500;let sn=class extends f{constructor(e,t){super(e,t),this._activeStop=null,this._activeManeuver=null,this._autoStopRemovalDelay=on,this._autoStopRemovalTimeoutId=void 0,this._focusedManeuver=null,this._newPlaceholderStop=null,this._pointerDownUpHandle=null,this._pointerPressedSearchSuggestionStop=null,this._renderSavePopoverFunction=null,this._saveAsButtonNode=null,this._saveLayer=new y.SaveLayer,this._sections=null,this._sortable=null,this._stopsToSearches=new Map,this._viewClickHandle=null,this.headingLevel=2,this.iconClass=_.css.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new b,this.visibleElements={...Qt},this._setUpDragAndDropStops=e=>{this._sortable=Dt.create(e,{draggable:`.${_.css.validStopRow}`,ghostClass:_.css.stopRowGhost,handle:`.${_.css.stopHandle}`,onEnd:this._handleStopInputDragEnd})},this._handleDragHandlePointerDown=()=>this.viewModel.layer?.stops.forEach((e=>this.acquireSearch(e).activeMenu="none")),this._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:n})=>{if(e===t||null==t||null==e)return;const{children:o}=n,i=o[t],r=o[e],s=t-e<0;n.insertBefore(i,s?r.nextElementSibling:r);const{stops:a}=this.viewModel.layer;a.reorder(a.at(e),t);for(const l of a)l.sequence=null;this._solveRoute()}}initialize(){this.addHandles([s.watch((()=>this.viewModel.layer?.routeInfo),(()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()}),s.initial),s.when((()=>this.view),((e,t)=>{if(t&&(this._viewClickHandle=null,null!=t&&this.removeHandles(t)),e){const t=this._prepPointerDownUpClick(),n=this._prepViewClick();t.pause(),n.pause();const i=e.surface;this.addHandles([o.on(i,"mousedown",(()=>this._autoStopRemovalDelay=rn)),o.on(i,"mouseup",(()=>this._autoStopRemovalDelay=on)),t,n],e),this._pointerDownUpHandle=t,this._viewClickHandle=n}}),s.initial),s.when((()=>null==this.viewModel.serviceDescription),(()=>{try{this.viewModel.load()}catch{}}),s.initial),s.watch((()=>this._saveLayer.state),(()=>{this.scheduleRender()}))]),this.when((()=>{this.destroyed||this.visibleElements.saveAsButton&&(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))}))}loadDependencies(){return C.loadCalciteComponents({button:()=>new Promise(((t,n)=>e(["../chunks/calcite-button"],t,n))),icon:()=>new Promise(((t,n)=>e(["../chunks/calcite-icon"],t,n))),"input-date-picker":()=>new Promise(((t,n)=>e(["../chunks/calcite-input-date-picker"],t,n))),"input-time-picker":()=>new Promise(((t,n)=>e(["../chunks/calcite-input-time-picker"],t,n))),link:()=>new Promise(((t,n)=>e(["../chunks/calcite-link"],t,n))),popover:()=>new Promise(((t,n)=>e(["../chunks/calcite-popover"],t,n)))})}destroy(){for(const e of this._stopsToSearches.values())e.destroy();this._sortable?.destroy(),null!=this._renderSavePopoverFunction&&this._projector.detach(this._renderSavePopoverFunction)}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...Qt,...e}}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const n=this._stopsToSearches.get(e);return n.view=t,this._overrideDefaultSources(n),n}const n=new g({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(n),this.addHandles([s.on((()=>n.allSources),"change",(()=>this._normalizeSearchSources(n))),n.on("select-result",(()=>{e.geometry=n.selectedResult?.feature.geometry,e.name=n.selectedResult?.name,this._solveRoute()})),n.on("search-focus",(()=>this._handleStopInputFocus(n,e))),n.on("search-blur",(()=>this._handleStopInputBlur(n,e))),n.on("search-clear",(()=>{e.geometry=null,e.name=null,this._activeStop=e,this.viewModel.layer?.removeResult()})),s.watch((()=>n.searchTerm),(t=>{e.name=t}))],n),this._stopsToSearches.set(e,n),n}getDirections(){return this.viewModel.getDirections()}render(){return I.tsx("div",{class:this.classes(_.css.base,D.globalCss.widget,D.globalCss.panel,_.css.scroller)},this._renderPanelContent())}save(){return this.viewModel.save()}saveAs(e,t={}){return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_renderPanelContent(){const{layer:e,serviceDescription:t,state:n}=this.viewModel,o="initializing"===n,i="error"===n&&!t,r="unauthenticated"===n,s={[_.css.panelContentLoading]:o,[_.css.panelContentError]:i||!e,[_.css.panelContentSignIn]:r},a=o?"presentation":"group",l=e?r?this._renderSignIn():i?this._renderMessage(this._getErrorMessage()):o?this._renderLoader():this._renderReadyContent():this._renderMessage(this.messages.missingLayer);return I.tsx("div",{class:this.classes(_.css.panelContent,s),role:a},l)}_renderReadyContent(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]}_renderSignIn(){return I.tsx("div",{class:_.css.signInContent,key:"sign-in"},I.tsx(M.Heading,{class:_.css.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),I.tsx(M.Heading,{level:M.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),I.tsx("button",{bind:this,class:this.classes(D.globalCss.button,D.globalCss.buttonSecondary,_.css.signInButton),onclick:this._handleSignInClick,tabIndex:0,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch((()=>{}))}_renderTravelModeOptions(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(0===t.length)return null;const n=null!=e?e.name:this.messages.travelMode;return I.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(_.css.travelMode,this._saveLayer.opened&&D.globalCss.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},I.tsx("select",{"aria-label":n,bind:this,class:this.classes(_.css.travelModeSelect,D.globalCss.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:n},t.map(((t,n)=>{const o=e===t;return I.tsx("option",{"data-mode":t,key:`esri-directions__travel-mode-${n}`,selected:o,value:`${n}`},t.name)}))))}_handleTravelModeChange(e){const t=e.currentTarget;this.viewModel.selectedTravelMode=an(t.item(t.selectedIndex)),this._solveRoute()}_renderStopsContainer(){return this.visibleElements.stops?I.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(_.css.section,this._saveLayer.opened&&D.globalCss.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null}_renderDepartureTimeControls(){if(!this.visibleElements.departureTime)return null;const{messages:{departAt:e,departureTime:t,leaveNow:n,timeUnspecified:o},viewModel:{departureOption:i}}=this;return I.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(_.css.departureTime,this._saveLayer.opened&&D.globalCss.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},I.tsx("select",{"aria-label":t,bind:this,class:this.classes(_.css.departureTimeSelect,D.globalCss.select),onchange:this._handleDepartureOptionChange,title:t},I.tsx("option",{selected:i===w.DepartureTimeOption.NOW,value:w.DepartureTimeOption.NOW},n),I.tsx("option",{selected:i===w.DepartureTimeOption.DEPART_AT,value:w.DepartureTimeOption.DEPART_AT},e),I.tsx("option",{selected:i===w.DepartureTimeOption.UNSPECIFIED,value:w.DepartureTimeOption.UNSPECIFIED},o)),i===w.DepartureTimeOption.DEPART_AT?this._renderTimeControls():null)}_renderStops(){const{stops:e}=this.viewModel.layer;let t=0;for(const i of this._stopsToSearches.keys())e.includes(i)||this._disposeSearch(i);for(const i of e){const e=this.acquireSearch(i);"none"!==e.activeMenu&&(t+=1),null!=i.name&&(e.searchTerm=i.name)}const n=e.toArray().map(((n,o)=>{const i=e.length,r=o>1&&null==n.geometry,s={[T.legacyIcon.radioUnchecked]:o>=0&&o<i-1,[T.legacyIcon.radioChecked]:o===i-1},a={[_.css.lastStopIconContainer]:o===i-1},l={[_.css.validStopRow]:!r},c=e.at(o+1),d=o===i-1,u=o===i-2,h=2===i&&0===o||i>2&&!d&&!u||i>2&&u&&null!=c?.geometry||i>2&&d&&null==n.geometry,p=i<3,v=this.acquireSearch(n),{messages:m}=this,{removeStop:g,reverseStops:f,unlocated:b}=m,y=null!=n.geometry&&null!=n.name?n.name:b,w=P.formatNumber(o+1),S=`${m.stopLabel} ${w} (${y})`,C=`${this.id}__stop--${o}`,D=!!v.searchTerm&&!!v.selectedResult&&null!=n.geometry&&v.selectedResult.name===n.name,M={zIndex:"none"!==v.activeMenu?""+t--:""};return I.tsx("li",{afterCreate:this._handleStopFieldCreation,"aria-label":S,bind:this,class:this.classes(_.css.stopRow,l),"data-stop-index":o,id:C,key:o,styles:M},I.tsx("div",{class:_.css.stopHandle},I.tsx("span",{"aria-hidden":"true",class:this.classes(_.css.stopIcon,T.legacyIcon.handleVertical,_.css.stopHandleIcon,_.css.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),I.tsx("div",{"aria-labelledby":C,bind:this,class:this.classes(_.css.stopIconContainer,a),"data-stop-index":o,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},I.tsx("span",{class:this.classes(_.css.stopIcon,s),tabIndex:D?0:void 0}))),I.tsx("div",{class:_.css.stopInput},v.render()),I.tsx("div",{class:_.css.stopOptions,role:"group"},I.tsx("div",{"aria-label":g,bind:this,class:_.css.removeStopButton,"data-stop-index":o,hidden:p,onclick:this._handleRemoveStop,onkeydown:this._handleRemoveStop,role:"button",tabIndex:0,title:g},I.tsx("span",{"aria-hidden":"true",class:this.classes(_.css.stopIcon,_.css.removeStop,T.legacyIcon.trash,_.css.interactiveStopIcon)}),I.tsx("span",{class:T.legacyIcon.fontFallbackText},"removeStopTitle")),I.tsx("div",{"aria-label":f,bind:this,class:_.css.reverseStops,hidden:h,onclick:this._handleReverseStops,onkeydown:this._handleReverseStops,role:"button",tabIndex:0,title:f},I.tsx("span",{"aria-hidden":"true",class:this.classes(_.css.stopIcon,T.legacyIcon.upDownArrows,_.css.interactiveStopIcon)}),I.tsx("span",{class:T.legacyIcon.fontFallbackText},"removeStopTitle"))))})),o=this._renderAddStop();return I.tsx("div",null,I.tsx("ol",{afterCreate:this._setUpDragAndDropStops,class:_.css.stops,role:"group"},n),o)}_renderAddStop(){const e=this.viewModel.layer?.stops;if(!e)return null;const t=e.filter((({geometry:e})=>null!=e)),n=e.at(-1);return t.length>1&&t.length<this.maxStops&&null!=n?.geometry?I.tsx("div",{class:_.css.toolbarSection},I.tsx("div",{class:_.css.toolbarButtons},I.tsx("calcite-button",{appearance:"outline",class:_.css.addStopButton,iconStart:"plus",key:_.css.addStopButton,kind:"neutral",label:this.messages.addStop,onclick:()=>{this._addNewPlaceholder()},round:!0,scale:"s",width:"full"},this.messages.addStop))):null}_handleStopIconClick(e){const t=ln(e.currentTarget),n=null!=t?this.viewModel.layer?.stops.at(t):void 0;n?.geometry&&this._centerAtStop(n)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(e){this.viewModel.centerAt(e)}_handleStopFieldCreation(e){const t=this._newPlaceholderStop;if(!t)return;const n=ln(e),o=null!=n?this.viewModel.layer?.stops.at(n):void 0;if(t===o){const e=this.acquireSearch(o);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null}_handleStopInputBlur(e,t){if(this._saveLayer.opened)return;this.removeHandles(nn);if(!!e.selectedResult&&null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry===e.selectedResult?.feature.geometry)return void this._pointerDownUpHandle?.pause();const n=null==t.geometry&&null==e.selectedResult?.feature.geometry,o=null!=t.geometry&&null!=e.selectedResult?.feature.geometry&&t.geometry!==e.selectedResult?.feature.geometry;if((n||o)&&"none"===e.activeMenu&&e.searchTerm)return e.search(),void this._pointerDownUpHandle?.pause();e.searchTerm||(this._viewClickHandle?.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{this.destroyed||(this._viewClickHandle?.pause(),"searching"!==e.viewModel.state?this._pointerPressedSearchSuggestionStop||(null!=t.geometry&&(t.geometry=null,this._solveRoute()),this.scheduleRender()):this._pointerDownUpHandle?.pause())}),this._autoStopRemovalDelay))}_handleStopInputFocus(e,t){this._pointerDownUpHandle?.resume();const{view:n}=this;if(this.hasHandles(nn)||!n)return;const o=n.cursor;this.addHandles([i.makeHandle((()=>{n.cursor=o})),s.watch((()=>e.searchTerm),(t=>{e.destroyed||(n.cursor=t.length?o:"copy")}),s.initial)],nn),this._activeStop=t}_prepViewClick(){const{view:e}=this.viewModel;r.assertIsSome(e),r.assertIsSome(e.surface);const t=o.pausable(e,"click",this._handleViewClick.bind(this)),n=o.pausable(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),n.pause()}));return{remove(){n.remove(),t.remove()},pause(){n.pause(),t.pause()},resume(){n.resume(),t.resume()}}}_prepPointerDownUpClick(){const e=o.pausable(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=en(e)?this._activeStop:null})),t=o.pausable(document,"pointerup",(e=>{this._pointerDownUpHandle?.pause();const t=en(e),n=this._activeStop;t||n!==this._pointerPressedSearchSuggestionStop||this._removeStop(n),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?n:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}}_handleViewClick(e){e.stopPropagation();const t=this._activeStop,n=t?this._stopsToSearches.get(t):null;t&&n&&!n.searchTerm&&(n.search(e.mapPoint).then((e=>{const o=e?.results[0].results;if(!o)return;const{feature:i,name:r}=o[0];t.geometry=i.geometry,t.name=r,n.searchTerm=r})),this.scheduleRender()),this._viewClickHandle?.pause(),clearTimeout(this._autoStopRemovalTimeoutId)}_addNewPlaceholder(){if(this._pointerDownUpHandle?.pause(),this._newPlaceholderStop)return;const e=new v({symbol:new m});this.viewModel.layer?.stops.add(e),this._newPlaceholderStop=e}_handleReverseStops(){this._reverseStops()}_reverseStops(){const e=this.viewModel.layer?.stops??[];e.reverse();for(const t of e)t.sequence=null;this._solveRoute()}_handleRemoveStop(e){const{layer:t}=this.viewModel;if(!t)return;const n=ln(e.currentTarget);if(null==n)return;const{stops:o,routeInfo:i}=t,r=o.at(n);this._removeStop(r),null==r.geometry&&null!=i||this._solveRoute()}_removeStop(e){const{stops:t}=this.viewModel.layer;!e||t.length<=2||(this._disposeSearch(e),t.remove(e))}_handleDepartureOptionChange(e){const t=e.currentTarget,n=t.item(t.selectedIndex);this.viewModel.departureOption=n.value,this._solveRoute()}_renderTimeControls(){return this.viewModel.departureIsoDate&&this.viewModel.departureIsoTime?I.tsx("div",{class:_.css.departureTimeControls,key:_.css.departureTimeControls,role:"group"},I.tsx("div",{class:_.css.departureDateTimePickers},I.tsx("calcite-input-date-picker",{valueAsDate:tn(this.viewModel.departureIsoDate),onCalciteInputDatePickerChange:({target:e})=>{this.viewModel.departureIsoDate=e.value,this._solveRoute()}}),I.tsx("calcite-input-time-picker",{value:this.viewModel.departureIsoTime,onCalciteInputTimePickerChange:({target:e})=>{this.viewModel.departureIsoTime=e.value,this._solveRoute()}}))):null}_renderSectionSplitter(){return I.tsx("div",{class:_.css.sectionSplitter})}_renderSaveContainer(){const{saveButton:e,saveAsButton:t,printButton:n,layerDetails:o}=this.visibleElements;return e||t||n||o?I.tsx("div",{class:_.css.saveSection,key:_.css.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null}_renderSaveButtons(){const{saveButton:e,saveAsButton:t,printButton:n}=this.visibleElements;return e||t||n?I.tsx("div",{class:_.css.saveButtons,key:_.css.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null}_renderSaveButton(){if(!this.visibleElements.saveButton)return null;const{portalItem:e,routeInfo:t}=this.viewModel.layer,n=e?.itemControl,o=null!=t&&("admin"===n||"update"===n);return I.tsx("calcite-button",{appearance:"outline",class:_.css.saveButton,disabled:!o,iconStart:"save",key:_.css.saveButton,label:this.messagesCommon.save,onclick:()=>{this._handleSaveButtonClick()},width:"full"},this.messagesCommon.save)}_renderSaveAsButton(){if(!this.visibleElements.saveAsButton)return null;const e=null==this.viewModel.layer.routeInfo;return I.tsx("div",{class:_.css.saveAsButtonPopover,key:_.css.saveAsButtonPopover},I.tsx("calcite-button",{afterCreate:e=>{this._saveAsButtonNode=e},appearance:"outline",class:_.css.saveAsButton,disabled:e,iconStart:"duplicate",key:_.css.saveAsButton,label:this.messagesCommon.saveAs,onclick:()=>this._handleSaveAsButtonClick(),width:"full"},this.messagesCommon.saveAs))}_renderSavePopover(){return I.tsx("calcite-popover",{class:_.css.savePopover,label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:this._saveAsButtonNode,triggerDisabled:!0},this._saveLayer.render())}_handleSaveAsButtonClick(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)}_renderPrintButton(){return this.visibleElements.printButton?I.tsx("calcite-button",{appearance:"outline",class:_.css.printButton,iconStart:"print",key:_.css.printButton,label:this.messagesCommon.print}):null}_renderRouteLayerDetailsLink(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:n}}=e,o=`${n}/home/item.html?id=${t}`;return I.tsx("calcite-link",{class:_.css.layerDetailsLink,href:o,key:_.css.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)}_handleSaveButtonClick(){this.viewModel.layer.save()}_renderDirectionsContainer(){return I.tsx("div",{class:this.classes(_.css.directionsSection,_.css.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return I.tsx("div",{class:_.css.loader,key:"loader"})}_renderWarningCard(){return I.tsx("div",{class:_.css.warningCard,role:"alert"},I.tsx("div",{class:_.css.warningHeader},I.tsx("span",{"aria-hidden":"true",class:T.legacyIcon.noticeTriangle}),I.tsx(M.Heading,{class:_.css.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),I.tsx("div",{class:_.css.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{layer:e,state:t}=this.viewModel,n="routing"===t;return"error"===t?this._renderWarningCard():n?this._renderLoader():null!=e.directionLines?I.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(_.css.summary,this._saveLayer.opened&&D.globalCss.buttonDisabled),key:_.css.summary,role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):I.tsx("div",{class:D.globalCss.empty,key:"esri-directions__placeholder"},this._renderPlaceholder(),I.tsx(M.Heading,{class:_.css.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return I.tsx("svg",{class:D.globalCss.emptyIllustration,viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},I.tsx("path",{d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z",fill:"currentcolor"}))}_renderMessage(e){return I.tsx(M.Heading,{class:_.css.messageHeading,level:this.headingLevel},e)}_renderRouteActions(){return I.tsx("div",{class:_.css.routeActions},I.tsx("button",{"aria-label":this.messages.clearRoute,bind:this,class:this.classes(_.css.clearRouteButton,D.globalCss.button,D.globalCss.buttonTertiary),onclick:this._handleClearRouteClick,tabIndex:0,type:"button"},this.messages.clearRoute))}_getSections(){const{layer:e}=this.viewModel;if(!e)return null;const{directionPoints:t,directionLines:n,stops:o}=e;if(null==t||null==n)return null;const i=[];let r=null;for(const s of t){const{objectId:e,stopId:t}=s;if(null!=t){const e=o.find((({objectId:e})=>e===t)),n=0===i.length;null!=r&&r.stop===e||(r={stop:e,directions:[],open:n},i.push(r));continue}if(null==r)continue;const a=n.find((({directionPointId:t})=>t===e));null!=a&&r.directions.push({directionPoint:s,directionLine:a})}return i}_renderManeuverSections(){return null==this._sections?null:I.tsx("div",{class:_.css.maneuvers,role:"group"},this._sections.map(((e,t)=>{const{open:n}=e;let o;e.directions.length>0&&n&&(o=I.tsx("ol",{class:_.css.maneuverList},e.directions.map((e=>this._renderManeuver(e)))));const i=this._sections.length>2,r=t===this._sections.length-1,s={[_.css.collapsibleSection]:i},a={[T.legacyIcon.down]:!n,[T.legacyIcon.up]:n};let l;if(i&&!r){const t=n?this.messagesCommon.close:this.messagesCommon.open;l=I.tsx("header",{class:this.classes(_.css.maneuverSectionHeader,_.css.maneuverSectionToggle),key:_.css.maneuverSectionHeader},I.tsx("div",{"aria-expanded":n.toString(),"aria-label":t,bind:this,class:_.css.maneuverSectionHeaderButton,"data-maneuver-section":e,onclick:this._handleSectionToggle,onkeydown:this._handleSectionToggle,role:"button",tabIndex:0,title:t},I.tsx(M.Heading,{class:_.css.maneuverSectionTitle,level:this.headingLevel},e.stop.name),I.tsx("span",{"aria-hidden":"true",class:this.classes(a)})))}else l=I.tsx("header",{class:_.css.maneuverSectionHeader,key:_.css.maneuverSectionHeader},I.tsx(M.Heading,{class:_.css.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return I.tsx("section",{class:this.classes(_.css.maneuverSection,s),key:t},l,o)})))}_handleSectionToggle(e){const t=cn(e.currentTarget);t&&(t.open=!t.open)}_renderCosts(){const e=this._getCostSummary(),{directionPoints:t}=this.viewModel.layer;if(null==t||null==e)return null;const{distance:n,duration:o}=e,{primaryCosts:i,secondaryCosts:r,zoomToRoute:s}=this.messages,a=this._renderEta();return I.tsx("div",{"aria-label":s,bind:this,class:_.css.directionCosts,onclick:this._handleSummaryInteraction,onkeydown:this._handleSummaryInteraction,role:"button",tabIndex:0,title:s},I.tsx("div",{class:_.css.costsDetails,role:"group"},I.tsx("div",{class:_.css.primaryCosts,title:i},o),I.tsx("div",{class:_.css.verticalSplitter}),I.tsx("div",{class:_.css.secondaryCosts,title:r},n)),a)}_renderEta(){return this.viewModel.departureOption===w.DepartureTimeOption.UNSPECIFIED?null:I.tsx("div",{class:_.css.arrivalTimeContainer,title:this.messages.eta},I.tsx("span",{class:_.css.arrivalTime},this.viewModel.formattedEta))}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()}_getErrorMessage(){switch(this.viewModel.lastError?.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))}_applyLocatorSourceOverrides({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??="street",S.isArcGISWorldGeocoder(t.url)&&this.apiKey&&null==t.apiKey&&(t.apiKey=this.apiKey,t.url=S.meteredArcGISLocatorUrl))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_renderManeuver(e){const{directionPoint:t,directionLine:n}=e,{distance:o,duration:i}=n,{messages:r,messagesUnits:s,unit:a}=this,l=w.formatDistance(s,o??0,a),c=w.formatDuration(i??0),d=l&&c?`${l}&nbsp;&middot;&nbsp;${c}`:`${l}${c}`,u=Jt(t),{objectId:h,directionPointType:p}=t,v=w.getIconName(p),m=`${_.css.maneuver}-${h}`,g=`${_.css.intermediateCost}-${h}`,f={[_.css.maneuverActive]:this._activeManeuver===n};return I.tsx("li",{"aria-labelledby":`${m} ${g}`,bind:this,class:this.classes(_.css.maneuver,f),"data-maneuver":n,key:n,onblur:this._handleManeuverBlur,onclick:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onkeydown:this._handleManeuverClick,onmouseout:this._handleManeuverMouseOut,onmouseover:this._handleManeuverMouseOver,tabIndex:0},I.tsx("calcite-icon",{alt:"",class:_.css.maneuverIcon,icon:v}),I.tsx("div",{class:_.css.maneuverCostsContainer},u,I.tsx("div",{class:_.css.maneuverCosts},I.tsx("div",{class:_.css.horizontalSplitter}),I.tsx("div",{"aria-hidden":"true",class:_.css.intermediateCost,id:g,innerHTML:d,title:r.intermediateCosts}))))}_handleManeuverClick(e){const t=dn(e.currentTarget);if(!t)return;if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:n}=t;this.viewModel.centerAt(n),this.viewModel.highlight(t)}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=dn(e.currentTarget);t&&this.viewModel.highlight(t)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=dn(e.currentTarget);t&&(this._focusedManeuver=t,this.viewModel.highlight(t))}_getCostSummary(){const{messagesUnits:e,unit:t,viewModel:n}=this,{routeInfo:o}=n.layer;if(null==o)return null;const i=o.totalDistance??0,r=o.totalDuration??0;return{distance:w.formatDistance(e,i,t),duration:w.formatDuration(r)}}async _solveRoute(){this.viewModel.updateDepartureTime();const e=this.viewModel.layer?.stops.filter((({geometry:e})=>null!=e));if(e&&!(e.length<2))try{await this.viewModel.getDirections()}catch{}}};t.__decorate([l.property()],sn.prototype,"apiKey",null),t.__decorate([l.property(p.defaultUnitPropertyMetadata)],sn.prototype,"defaultUnit",void 0),t.__decorate([l.property()],sn.prototype,"goToOverride",null),t.__decorate([l.property()],sn.prototype,"headingLevel",void 0),t.__decorate([l.property()],sn.prototype,"iconClass",void 0),t.__decorate([l.property()],sn.prototype,"icon",void 0),t.__decorate([l.property()],sn.prototype,"label",null),t.__decorate([l.property({readOnly:!0})],sn.prototype,"lastRoute",null),t.__decorate([l.property()],sn.prototype,"layer",null),t.__decorate([l.property()],sn.prototype,"maxStops",null),t.__decorate([l.property(),E.messageBundle("esri/widgets/Directions/t9n/Directions")],sn.prototype,"messages",void 0),t.__decorate([l.property(),E.messageBundle("esri/t9n/common")],sn.prototype,"messagesCommon",void 0),t.__decorate([l.property(),E.messageBundle("esri/core/t9n/Units")],sn.prototype,"messagesUnits",void 0),t.__decorate([l.property()],sn.prototype,"searchProperties",void 0),t.__decorate([l.property()],sn.prototype,"unit",null),t.__decorate([l.property()],sn.prototype,"view",null),t.__decorate([l.property({type:b})],sn.prototype,"viewModel",void 0),t.__decorate([l.property()],sn.prototype,"visibleElements",void 0),t.__decorate([c.cast("visibleElements")],sn.prototype,"castVisibleElements",null),t.__decorate([x.accessibleHandler()],sn.prototype,"_handleStopIconClick",null),t.__decorate([x.accessibleHandler()],sn.prototype,"_handleClearRouteClick",null),t.__decorate([x.accessibleHandler()],sn.prototype,"_handleReverseStops",null),t.__decorate([x.accessibleHandler()],sn.prototype,"_handleRemoveStop",null),t.__decorate([x.accessibleHandler()],sn.prototype,"_handleSectionToggle",null),t.__decorate([x.accessibleHandler()],sn.prototype,"_handleSummaryInteraction",null),t.__decorate([x.accessibleHandler()],sn.prototype,"_handleManeuverClick",null),sn=t.__decorate([h.subclass("esri.widgets.Directions")],sn);function an(e){return e?.["data-mode"]}function ln(e){return e?.["data-stop-index"]}function cn(e){return e?.["data-maneuver-section"]}function dn(e){return e?.["data-maneuver"]}return sn}));
