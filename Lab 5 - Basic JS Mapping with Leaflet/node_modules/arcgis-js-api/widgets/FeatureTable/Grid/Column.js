/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../../../chunks/tslib.es6","../../../core/Evented","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./support/ButtonMenu","../../support/legacyIcon","../../support/widgetUtils"],(function(e,t,o,r,i,n,s,a,d,c,l){"use strict";const p="esri-column",h={menuContainer:`${p}__menu-container`,sorter:`${p}__sorter`,headerContent:`${p}__header-content`,headerLabel:`${p}__header-label`},u={keyboardSort1:"Enter",keyboardSort2:"Spacebar"};let y=class extends t.EventedAccessor{constructor(e){super(e),this._menuContainer=document.createElement("div"),this.activeRowIndex=null,this.autoWidth=!1,this.cellValueFormatFunction=({value:e})=>l.renderingSanitizer.sanitize(e),this.direction=null,this.flexGrow=1,this.footerRenderFunction=null,this.frozen=!1,this.frozenToEnd=!1,this.grid=null,this.header=null,this.headerRenderFunction=e=>{const{root:t}=e;if(this.removeCellContent(t),t.classList.add(h.headerContent),this.sortable)this.headerSorterRenderFunction(e);else{const e=document.createElement("div");e.classList.add(h.headerLabel);const o=document.createElement("span");o.textContent=this.label,o.setAttribute("title",this.label),e.appendChild(o),t.appendChild(e)}this.headerMenuEnabled&&this.headerMenuRenderFunction(e)},this.headerMenuRenderFunction=({root:e})=>{this.menu?.items?.length&&e.appendChild(this._menuContainer)},this.headerSorterRenderFunction=({root:e})=>{const{label:t,sortElement:o}=this;if(!o)return void(e.textContent=t);o.textContent!==t&&o.setAttribute("textContent",t),e.appendChild(o);const r=this.grid?.getSlotElementByName(e.slot),i=r?.parentElement;i&&!i.onkeydown&&(i.onkeydown=({key:e})=>{e!==u.keyboardSort1&&e!==u.keyboardSort2||o.click()})},this.hidden=!1,this.headerMenuEnabled=!0,this.initialSortPriority=null,this.menu=null,this.menuConfig=null,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.path=null,this.renderFunction=({root:e,column:t,rowData:o})=>{const r=this.getCellValue(t,o),i=this.cellValueFormatFunction({column:t,rowData:o,value:r});e.innerHTML!==i&&(e.innerHTML=i)},this.resizable=!0,this.sortable=!1,this.textAlign="start",this.timeZone=null,this.timeZoneName=null,this.width=200}initialize(){const{messages:e,path:t}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",t??""),this._menuContainer.classList.add(h.menuContainer),this.menu=new d({container:this._menuContainer,label:e?.options,iconClass:c.legacyIcon.handleHorizontal,...this.menuConfig}),this.menu.set("items",this.getMenuItems()),this.addHandles([o.watch((()=>this.direction),(e=>{const{sortElement:t}=this;this.sortable&&t&&(e?this.sortElement.direction!==e&&t.setAttribute("direction",e):t.removeAttribute("direction"))})),o.watch((()=>this.hidden),(()=>this.menu?.set("open",!1))),o.watch((()=>this.path),(e=>{const{sortElement:t}=this,o=e??"";t&&t.path!==o&&t.setAttribute("path",o)}))])}destroy(){this.menu?.destroy()}set invalid(e){this._set("invalid",e),this.grid?.generateCellPartNames()}get label(){return l.renderingSanitizer.sanitize(this.header??this.path??"")}getMenuItems(){const{menuConfig:e,sortable:t}=this,o=e?.items,r=this.getSortMenuItems(),i=[];return t&&i.push(...r),o?.length&&i.push(...o),i.length?i:null}getSortMenuItems(){const{messages:e}=this;return[{selected:"asc"===this.direction,iconClass:c.legacyIcon.arrowUp,label:e?.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:c.legacyIcon.arrowDown,label:e?.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]}getCellValue(e,t){return e.path&&t?.item?t.item[e.path]:""}createSortElement(){const{direction:e,label:t,path:o,initialSortPriority:r}=this,i=document.createElement("vaadin-grid-sorter");return i.classList.add(h.sorter),i.setAttribute("path",o??""),i.setAttribute("title",t),i.textContent=t,e&&i.setAttribute("direction",e),null!=r&&(i._initialOrder=r),i.addEventListener("direction-changed",(()=>{this.direction!==i.direction&&this._set("direction",i.direction)})),i}createCalciteAction(e){const t=document.createElement("calcite-action"),{click:o,icon:r,text:i}=e;return t.scale="s",t.text=i,t.title=i,t.icon=r,t.onclick=o,t}removeCellContent(e){if(e&&e.firstChild)try{for(;e?.firstChild;)e?.removeChild(e.firstChild)}catch(t){}}};e.__decorate([r.property()],y.prototype,"activeRowIndex",void 0),e.__decorate([r.property()],y.prototype,"autoWidth",void 0),e.__decorate([r.property()],y.prototype,"cellValueFormatFunction",void 0),e.__decorate([r.property()],y.prototype,"direction",void 0),e.__decorate([r.property()],y.prototype,"flexGrow",void 0),e.__decorate([r.property()],y.prototype,"footerRenderFunction",void 0),e.__decorate([r.property()],y.prototype,"frozen",void 0),e.__decorate([r.property()],y.prototype,"frozenToEnd",void 0),e.__decorate([r.property()],y.prototype,"grid",void 0),e.__decorate([r.property()],y.prototype,"header",void 0),e.__decorate([r.property()],y.prototype,"invalid",null),e.__decorate([r.property()],y.prototype,"headerRenderFunction",void 0),e.__decorate([r.property()],y.prototype,"headerMenuRenderFunction",void 0),e.__decorate([r.property()],y.prototype,"headerSorterRenderFunction",void 0),e.__decorate([r.property()],y.prototype,"hidden",void 0),e.__decorate([r.property()],y.prototype,"headerMenuEnabled",void 0),e.__decorate([r.property({constructOnly:!0})],y.prototype,"initialSortPriority",void 0),e.__decorate([r.property({readOnly:!0})],y.prototype,"label",null),e.__decorate([r.property()],y.prototype,"menu",void 0),e.__decorate([r.property()],y.prototype,"menuConfig",void 0),e.__decorate([r.property()],y.prototype,"messages",void 0),e.__decorate([r.property()],y.prototype,"messagesCommon",void 0),e.__decorate([r.property()],y.prototype,"messagesURIUtils",void 0),e.__decorate([r.property()],y.prototype,"path",void 0),e.__decorate([r.property()],y.prototype,"renderFunction",void 0),e.__decorate([r.property()],y.prototype,"resizable",void 0),e.__decorate([r.property()],y.prototype,"sortable",void 0),e.__decorate([r.property({readOnly:!0})],y.prototype,"sortElement",void 0),e.__decorate([r.property()],y.prototype,"textAlign",void 0),e.__decorate([r.property()],y.prototype,"timeZone",void 0),e.__decorate([r.property()],y.prototype,"timeZoneName",void 0),e.__decorate([r.property()],y.prototype,"width",void 0),y=e.__decorate([a.subclass("esri.widgets.FeatureTable.Grid.Column")],y);return y}));
