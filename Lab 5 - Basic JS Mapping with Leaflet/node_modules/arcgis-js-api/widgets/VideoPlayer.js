/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["require","../chunks/tslib.es6","../core/lang","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","../intl/date","../views/VideoView","./Slider","./Widget","../chunks/componentsUtils","./support/globalCss","./support/widgetUtils","./support/jsxFactory","./VideoPlayer/VideoPlayerViewModel","./VideoPlayer/components/MetadataSection","./VideoPlayer/components/PlayerActionsGroup","./VideoPlayer/components/PlayerControlsGroup","./VideoPlayer/components/SettingsButton"],(function(e,t,i,r,s,o,n,a,l,d,c,p,u,h,v,w,g,y,m,_,M){"use strict";const V="esri-video-player",b={sliderProgressContainer:"esri-slider-progress-container",progress:"esri-progress",slider:"esri-slider",rangeSlider:"esri-range-slider",videoView:"esri-video-view"};let P=class extends p{constructor(e,t){super(e,t),this._settings=i.clone(M.defaultSettings),this._metadataVisible=!1,this._slider=new c({visibleElements:{labels:!1,rangeLabels:!1},min:0,max:100,values:[0],thumbsConstrained:!1}),this.videoView=new d({container:document.createElement("div")}),this.viewModel=new g}initialize(){this.addHandles([r.watch((()=>this.viewModel.layer),(()=>{this.videoView.layer=this.viewModel.layer}),r.initial),this._slider.on(["thumb-change","thumb-drag"],(({value:e})=>{const t=e*this.viewModel.duration/100;this.viewModel.seekTo(t)}))])}loadDependencies(){return Promise.all([u.loadCalciteComponents({"action-bar":()=>new Promise(((t,i)=>e(["../chunks/calcite-action-bar"],t,i))),progress:()=>new Promise(((t,i)=>e(["../chunks/calcite-progress"],t,i))),shell:()=>new Promise(((t,i)=>e(["../chunks/calcite-shell"],t,i))),panel:()=>new Promise(((t,i)=>e(["../chunks/calcite-panel"],t,i))),scrim:()=>new Promise(((t,i)=>e(["../chunks/calcite-scrim"],t,i)))}),m.loadPlayerActionsGroupComponents(),_.loadPlayerControlsGroupComponents(),y.loadMetadataSectionComponents()])}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return w.tsx("calcite-shell",{class:this.classes(V,h.globalCss.widget)},w.tsx("calcite-panel",{heading:this.layer?.title||"Video Player"},this._renderLoadingScrim(),this._renderBuffering(),this._renderVideoSection(),this._renderActionBar(),this._renderMetadataSection()))}_renderLoadingScrim(){const{state:e}=this.viewModel;return this.videoView.ready?null:w.tsx("calcite-scrim",{loading:"error"!==e},"error"===e?"Error loading the layer":null)}_renderBuffering(){const{currentTime:e,buffered:t,duration:i}=this.viewModel,r=t/(i||1),s=e/(i||1);return this.viewModel.ended||r>s?null:w.tsx("calcite-progress",{type:"indeterminate"})}_renderVideoSection(){const{buffered:e,currentTime:t,duration:i}=this.viewModel,r=this.videoView.container;if(!r)return null;r.className=b.videoView;const s=e/(i||1),o=t/(i||1);return this._slider.values=[100*o],w.tsx("section",{afterCreate:f,bind:r},w.tsx("div",{class:b.sliderProgressContainer},w.tsx("progress",{class:b.progress,max:"1",value:`${s}`}),w.tsx("div",{class:b.slider},this._slider.render())))}_renderActionBar(){return w.tsx("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",styles:{padding:"5px"}},w.tsx(m.PlayerActionsGroup,{viewModel:this.viewModel}),w.tsx("div",{styles:{display:"flex",alignItems:"center",padding:"5px"}},x(this.viewModel.currentTime)," / ",x(this.viewModel.duration)),w.tsx(_.PlayerControlsGroup,{settings:this._settings,toggleMetadata:()=>this._metadataVisible=!this._metadataVisible,viewModel:this.viewModel}))}_renderMetadataSection(){return this._metadataVisible?w.tsx(y.MetadataSection,{viewModel:this.viewModel}):null}};function x(e){return l.formatDate(1e3*Math.round(e),{minute:"2-digit",second:"2-digit"})}function f(e){const t=this;e.prepend(t)}t.__decorate([s.property()],P.prototype,"_settings",void 0),t.__decorate([s.property()],P.prototype,"layer",null),t.__decorate([s.property()],P.prototype,"videoView",void 0),t.__decorate([s.property({type:g})],P.prototype,"viewModel",void 0),t.__decorate([s.property()],P.prototype,"view",null),P=t.__decorate([a.subclass("esri.widgets.VideoPlayer")],P);return P}));
