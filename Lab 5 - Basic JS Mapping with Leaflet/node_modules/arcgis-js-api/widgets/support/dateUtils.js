/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../intl","../../core/has","../../core/Error","../../core/mathUtils","../../core/maybe","../../intl/date","../../time/timeZoneUtils","./dataUtils","../../chunks/datetime","../../intl/locale"],(function(e,t,n,a,i,o,l,r,m,u,s){"use strict";const f=r.utc,c={date:null,time:null,timeZoneOffset:null},d=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),p="yyyy-MM-dd",T="TT";var y;e.TimeStampOffsetPattern=void 0,(y=e.TimeStampOffsetPattern||(e.TimeStampOffsetPattern={})).HM="HH:mm",y.HMS="HH:mm:ss",y.HMS_MS="HH:mm:ss.SSS";const S=[e.TimeStampOffsetPattern.HMS_MS,e.TimeStampOffsetPattern.HMS,e.TimeStampOffsetPattern.HM,T],O="latn",D=new Set(["date-only","time-only","timestamp-offset"]),F=e=>"valueAsDate"in e;function v(e){return{locale:s.getLocale(),numberingSystem:O,zone:e??f}}function g(e){return e?.isValid?e.toMillis():null}function h(e,t){return null===e?null:u.DateTime.fromMillis(e,v(t))}function M(t,n){if(null==t||!m.isString(t)||""===t){if(n){const e=u.DateTime.local().setZone(n);return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return c}const a=u.DateTime.fromISO(t,{setZone:!0});return{date:a.toFormat(p,v()),time:a.toFormat(e.TimeStampOffsetPattern.HMS_MS,v()),timeZoneOffset:a.offset.toString()}}function I(e,t){if(null==e||!m.isNumber(e)||isNaN(e))return c;const n=h(e,t);return n?{date:n.toFormat(p,v(t)),time:n.toFormat(T,v(t))}:c}function V(e){switch(e.type){case"date":default:return l.convertDateFormatToIntlOptions("short-date-short-time");case"date-only":return l.convertDateFormatToIntlOptions("short-date");case"time-only":return l.convertDateFormatToIntlOptions("short-time");case"timestamp-offset":return{...l.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}}function w(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return l.formatDate(t,n);case"date-only":return l.formatDateOnly(t,n);case"time-only":return l.formatTimeOnly(t,n);case"timestamp-offset":return l.formatTimestamp(t,n);default:return null}}function Z(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:a,timeZoneComponent:i,oldValue:o}=e;if(!t?.value||!a?.value)return null;const{year:l,month:m,day:s}=u.DateTime.fromFormat(t.value,p),{hour:f,minute:c,second:d,millisecond:T}=C(a,r.utc)??u.DateTime.now(),y=M(o,n),S=null!=i?.value?parseInt(i.value,10):null!=y.timeZoneOffset?parseInt(y.timeZoneOffset,10):(new Date).getTimezoneOffset(),O=u.FixedOffsetZone.instance(S),D=u.DateTime.fromObject({year:l,month:m,day:s,hour:f,minute:c,second:d,millisecond:T},{zone:O});return D.isValid?D.toISO({includeOffset:!0}):null}function x(e){const{dateComponent:t,timeComponent:n,timeZone:a,max:i,min:o,oldValue:l}=e,r=C(t,a);let m=!!e.applyRange;if(!r)return null;let s=null;if(null!=n?.value){const e=C(n,a),t=Date.now(),o=null!=i&&i<t?i:t,l=u.DateTime.fromMillis(o,v(a)),m=r||l,{year:f,month:c,day:d}=m,{hour:p,minute:T,second:y,millisecond:S}=e||l;s=m.set({year:f,month:c,day:d,hour:p,minute:T,second:y,millisecond:S})}else{const e=h(b({value:l??Date.now(),max:i,min:o}),a),{year:t,month:n,day:u}=r,{hour:f,minute:c,second:d,millisecond:p}=e;m=!0,s=r.set({year:t,month:n,day:u,hour:f,minute:c,second:d,millisecond:p})}if(!s.isValid)return null;const f=s.toMillis();return m?b({value:f,max:i,min:o}):f}function C(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=F(e)?u.DateTime.fromFormat(e.value,p,v(t)):U(e.value),n?.isValid?n:null}function H(e){const{max:t,min:n,value:a}=e;return!isNaN(a)&&(!(null!=t&&a>t)&&!(null!=n&&a<n))}function b(e){const{max:t,min:n,value:a}=e;return null!=t&&null!=n?i.clamp(a,n,t):null!=t&&a>t?t:null!=n&&a<n?n:a}function P(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new a("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),i=new Array(3);for(let a=0;a<3;a++){const e=n.at(a)??"";i[a]=e.padStart(2,"0")}return i.join(":")}function N(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return P(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}}function A(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e}function R(e){if(!e||!m.isString(e))return null;const t=u.DateTime.fromFormat(e,p);return t.isValid?t:null}function U(e){return e&&m.isString(e)?o.mappedFind(S,(t=>{const n=u.DateTime.fromFormat(e,t);return n.isValid?n:null}))??null:null}function j(e){if(!e||!m.isString(e))return null;const t=u.DateTime.fromISO(e);return t.isValid?t:null}function z(e){const{type:t,range:n,value:a}=e;if(null==a||!n||a===n.min||a===n.max)return!0;if("date"===t)return H({value:a,min:n.min,max:n.max});const{rawMax:i,rawMin:o}=n;let l=null,r=null,m=null;switch(t){case"date-only":l=R(i),r=R(o),m=R(a);break;case"time-only":l=U(i),r=U(o),m=U(a);break;case"timestamp-offset":l=j(i),r=j(o),m=j(a)}return!m||H({value:m.valueOf(),min:r?.valueOf(),max:l?.valueOf()})}e.arcadeDateToFieldValue=N,e.clampValueToRange=b,e.createDateTimeFromFieldValue=h,e.dateFieldsWithStringFieldValue=D,e.dateOnlyToDateTime=R,e.dateTimeIsInRange=z,e.dateTimeToFieldValue=g,e.defaultDatePattern=p,e.defaultTimePattern=T,e.getDefaultLocaleOptions=v,e.getISOFieldValueFromDateComponents=Z,e.getIntlOptionsForField=V,e.getLabelForDateFieldValue=w,e.getLocalDateTimeFromComponent=C,e.getUnixFieldValueFromDateComponents=x,e.isArcadeDate=A,e.isCalciteDateComponent=F,e.normalizeTimeOnlyString=P,e.numberingSystem=O,e.prepareISOFieldValueForDateComponents=M,e.prepareUnixFieldValueForDateComponents=I,e.supportedTimeFormats=S,e.timeOnlyToDateTime=U,e.timeResolutionToStepMap=d,e.timestampOffsetToDateTime=j,e.valueIsInRange=H,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
