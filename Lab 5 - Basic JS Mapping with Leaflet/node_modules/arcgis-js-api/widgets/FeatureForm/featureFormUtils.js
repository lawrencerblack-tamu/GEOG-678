/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../../intl","../../core/arrayUtils","../../core/compilerUtils","../../core/string","../../layers/support/domainUtils","../../layers/support/fieldUtils","../../smartMapping/support/utils","../support/dateUtils","../../intl/substitute"],(function(e,t,n,i,l,r,o,a,s,u){"use strict";const p=e=>"field"===e?.type,d=e=>"group"===e?.type,m=e=>"relationship"===e?.type,c=e=>!d(e)&&null!=e.group,y=e=>"field"===e.type,f=e=>"group"===e.type,g=e=>"relationship"===e.type,T=e=>e.reduce(((e,t)=>d(t)?[...e,...t.inputs]:[...e,t]),[]),b=e=>T(e).filter(p),I=e=>T(e).filter(m),E=e=>null!=e&&(F(e,"combo-box")||F(e,"radio-buttons")),F=(e,t)=>null!=e&&e.input?.type===t,V=e=>null!=e&&(F(e,"text-box")||F(e,"text-area")),h=({domain:e,inputType:t="text-box",dataType:n})=>"number"===n&&"text-box"===t&&(!e||"coded-value"!==e.type),O=e=>"items"in e,v={typeFieldName:null,types:[]};function x(e){const{attributes:t,fieldsIndex:i,label:r,timeZone:o}=e;if(!t||"object"!=typeof t)return r;const a=Object.keys(t).filter((e=>l.templateHasKey(r,e))),s=a.map((e=>t[e])),u=a.map((e=>i.get(e))).filter(n.isSome);return L(r,N({values:s,fields:u,timeZone:o}))}function N(e){const{fields:t,values:n}=e,i=e.timeZone??void 0,l=t.map(((e,t)=>{let l=n[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===l));t?.name&&(l=t.name)}return(a.isAnyDateField(e)||o.isTimeOnlyField(e))&&(l=s.getLabelForDateFieldValue(e,l,{timeZone:i,...s.getIntlOptionsForField(e)})),[e.name,l]}));return Object.fromEntries(l)}function L(e,t){return l.replace(l.replace(e,(e=>`{${e.toLowerCase()}}`)),Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t]))))}const R=e=>e?"subtype-sublayer"===e.type?{typeFieldName:e.parent?.subtypeField,types:e.parent?.subtypes??[]}:"types"in e&&e.types?{typeFieldName:e.typeIdField,types:e.types.map((({id:e,name:t,domains:n})=>({code:e,name:t,domains:n})))}:v:v,A=(e,t)=>{if(!e)return!0;const{operations:n}=e;switch(t){case"INSERT":return n.supportsAdd;case"UPDATE":case"DELETE":return n.supportsUpdate;default:return!0}};e.LengthValidationError=void 0,(e.LengthValidationError||(e.LengthValidationError={})).TOO_SHORT="length-validation-error::too-short";const D={type:"number"},S={type:"number",intlOptions:{notation:"scientific"}};function U(e){return e>=1e7||e<=-1e7}function _(e,{validationErrors:t}){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin}const j=(t,n,i)=>{const{dataType:l,error:a,minLength:p,value:d,required:m}=t,c=n?.validationErrors;if(!c||!a)return null;if(m&&null===d)return c.cannotBeNull;if(a===r.DomainValidationError.VALUE_OUT_OF_RANGE||a===o.NumericRangeValidationError.OUT_OF_RANGE){const{field:e,range:r}=t,o={type:"date",intlOptions:{timeZone:"date"===e.type&&i?i:void 0,...s.getIntlOptionsForField(e)}},a=_(r,n);return u.substitute(a,r,{format:{max:"date"===l?o:null!=r.max&&U(r.max)?S:D,min:"date"===l?o:null!=r.min&&U(r.min)?S:D}})}return a===r.DomainValidationError.INVALID_CODED_VALUE?c.invalidCodedValue:a===o.TypeValidationError.INVALID_TYPE?c.invalidType:a===e.LengthValidationError.TOO_SHORT?u.substitute(c.tooShort,{min:p}):null},w=e=>{if(!e)return;const t=e.layer,n=t&&"geometryType"in t?t.geometryType:void 0,i=e.geometry?.type;return"polyline"===i||"polyline"===n?"line":i||n||"table"},C=e=>{const t=[];if(e.formTemplate){const{description:n,title:i}=e.formTemplate;e.fields?.forEach((e=>{const r=i&&l.templateHasKey(i,e.name),o=n&&l.templateHasKey(n,e.name);(r||o)&&t.push(e.name)}))}return t};function G(e,t){const n=t??("formTemplate"in e&&e.formTemplate);if(n){return(n.elements?.filter(y)??[]).some((({fieldName:t})=>!e.fieldsIndex.get(t)))}return!1}function H(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function M(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return i.neverReached(t.objectType),!1}}e.capabilitiesAllowEditType=A,e.flattenFieldInputs=b,e.flattenInputs=T,e.flattenRelationshipInputs=I,e.formTemplateHasInvalidFields=G,e.getComputedAttributes=N,e.getErrorMessageForFieldInput=j,e.getFieldsInTitleAndDesc=C,e.getIconForFeature=w,e.getNormalizedFeatureTypeInfo=R,e.isFieldElement=y,e.isFieldElementWithInputType=F,e.isFieldElementWithShowNoValueOptionInput=E,e.isFieldElementWithTextInput=V,e.isFieldInput=p,e.isGroupElement=f,e.isGroupInput=d,e.isInputInGroupInput=c,e.isNumberFieldInput=h,e.isRelationshipElement=g,e.isRelationshipInput=m,e.isTemplateItemGroup=O,e.parseFormTemplateString=x,e.substituteFieldTemplatesInString=L,e.valueIsInvalidSwitchValue=H,e.valueIsValidContingentValue=M,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
