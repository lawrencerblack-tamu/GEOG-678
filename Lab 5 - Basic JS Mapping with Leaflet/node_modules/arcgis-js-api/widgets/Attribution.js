/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["../chunks/tslib.es6","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","./Attribution/AttributionViewModel","./support/globalCss","./support/legacyIcon","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/jsxFactory","./support/widgetUtils"],(function(e,t,r,i,s,o,n,c,d,p,l,a,_,h,u){"use strict";const v="esri-attribution",g={base:v,poweredBy:`${v}__powered-by`,sources:`${v}__sources`,open:`${v}--open`,sourcesOpen:`${v}__sources--open`,link:`${v}__link`,widgetIcon:l.legacyIcon.description};let b=class extends c{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver((e=>e.forEach((({target:e})=>this._checkSourceTextOverflow(e))))),this.iconClass=g.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new d}initialize(){this.addHandles(t.on((()=>this.viewModel?.items),"change",(()=>this.scheduleRender())))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(e.includes(t.text)||e.push(t.text),e)),[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[g.open]:this._isOpen};return h.tsx("div",{bind:this,class:this.classes(g.base,p.globalCss.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return h.tsx("div",{class:g.poweredBy},"Powered by"," ",h.tsx("a",{class:g.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?0:void 0,{attributionText:i}=this,s={[g.sourcesOpen]:e,[p.globalCss.interactive]:t};return h.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(g.sources,s),innerHTML:i,tabIndex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:s}=e,o=s>i,n=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,n&&(t=!0),this._isOpen){const e=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};e.__decorate([r.property()],b.prototype,"_isOpen",void 0),e.__decorate([r.property()],b.prototype,"_isInteractive",null),e.__decorate([r.property()],b.prototype,"_attributionTextOverflowed",void 0),e.__decorate([r.property()],b.prototype,"_prevSourceNodeHeight",void 0),e.__decorate([r.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],b.prototype,"attributionText",null),e.__decorate([r.property()],b.prototype,"iconClass",void 0),e.__decorate([r.property()],b.prototype,"icon",void 0),e.__decorate([r.property()],b.prototype,"itemDelimiter",void 0),e.__decorate([r.property()],b.prototype,"label",null),e.__decorate([r.property(),_.messageBundle("esri/widgets/Attribution/t9n/Attribution")],b.prototype,"messages",void 0),e.__decorate([r.property()],b.prototype,"view",null),e.__decorate([r.property({type:d})],b.prototype,"viewModel",void 0),e.__decorate([a.accessibleHandler()],b.prototype,"_toggleState",null),b=e.__decorate([n.subclass("esri.widgets.Attribution")],b);return b}));
