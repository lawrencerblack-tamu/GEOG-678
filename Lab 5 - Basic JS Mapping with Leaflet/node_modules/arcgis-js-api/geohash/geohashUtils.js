/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
define(["exports","../core/has","../core/mathUtils","../geometry/Extent","../geometry/Polygon","../geometry/SpatialReference","../geometry/support/Ellipsoid","../layers/graphics/featureConversionUtils","../layers/graphics/OptimizedGeometry","../layers/graphics/data/projectionSupport"],(function(t,e,o,n,r,a,s,c,h,u){"use strict";const l=16,i=8,f=4,d=2,g=1,y=new Float64Array(2),m=new Float64Array(2),p=-90,x=90,G=-180,M=180,S="0123456789bcdefghjkmnpqrstuvwxyz",B=64;function v(t,e,o,s){const l=[t.xmin,t.ymin,t.xmax,t.ymax],i=r.fromExtent(n.fromBounds(l,s)),f=u.project(i,s,a.WGS84,{densificationStep:e*B});if(!f)return null;const d=c.convertFromPolygon(new h,f,!1,!1),g=d.coords.filter(((t,e)=>!(e%2))),y=d.coords.filter(((t,e)=>e%2)),m=Math.min(...g),p=Math.min(...y),x=Math.max(...g),G=Math.max(...y),M=X(m,p,o,a.WGS84),S=X(x,G,o,a.WGS84);return M&&S?{bounds:l,geohashBounds:{xLL:M[0],yLL:M[1],xTR:S[0],yTR:S[1]},level:o}:null}function X(t,e,n,r){if(r.isWebMercator){const r=o.rad2deg(t/s.earth.radius),a=r-360*Math.floor((r+180)/360),c=[0,0];return T(c,0,o.rad2deg(Math.PI/2-2*Math.atan(Math.exp(-e/s.earth.radius))),a,n),c}const c={x:t,y:e},h=u.project(c,r,a.WGS84);if(!h)return null;const l=[0,0];return T(l,0,h.y,h.x,n),l}function Y(t){return t<=57?t-48:t<=104?t-88:t<=107?t-89:t<=110?t-90:t-91}function b(t){return S[t]}function C(t){return(t[0]+t[1])/2}function j(t,e,o){return t[0]=e,t[1]=o,t}function A(t,e){const o=C(t),n=e,r=!e;t[0]=r*t[0]+n*o,t[1]=r*o+n*t[1]}function W(t,e){const o=e>C(t);return A(t,o),o}function w(t,e){const o=j(y,p,x),n=j(m,G,M);for(let r=0;r<e.length;r++){const t=Y(e.charCodeAt(r));r%2==0?(A(n,!!(l&t)),A(n,!!(f&t)),A(n,!!(g&t)),A(o,!!(i&t)),A(o,!!(d&t))):(A(o,!!(l&t)),A(o,!!(f&t)),A(o,!!(g&t)),A(n,!!(i&t)),A(n,!!(d&t)))}return t[0]=C(o),t[1]=C(n),t}function L(t,e){let o=0,n=0,r=30,a=30;for(let s=0;s<e.length;s++){const t=Y(e.charCodeAt(s)),c=s%2==0;r-=c?3:2,a-=c?2:3,o|=F(t,c)<<r,n|=z(t,c)<<a}return{geohashX:o,geohashY:n}}function P(t,e){let o=-90,n=90,r=-180,a=180;for(let s=0;s<e;s++){const e=Math.ceil((s+1)/2),c=Math.floor((s+1)/2),h=1-s%2,u=30-(3*e+2*c),l=30-(2*e+3*c),i=3*h+2*(1-h),f=2*h+3*(1-h),d=3*h+7*(1-h)<<l,g=(7*h+3*(1-h)<<u&t.geohashX)>>u,y=(d&t.geohashY)>>l;for(let t=i-1;t>=0;t--){const e=(r+a)/2,o=g&1<<t?1:0;r=(1-o)*r+o*e,a=(1-o)*e+o*a}for(let t=f-1;t>=0;t--){const e=(o+n)/2,r=y&1<<t?1:0;o=(1-r)*o+r*e,n=(1-r)*e+r*n}}return[r,o,a,n]}function R(t,e,o,n){n%2&&(n+=1);let r=0,a=0,s=-90,c=90,h=-180,u=180;for(let l=0;l<n/2;l++){for(let t=0;t<5;t++){const e=(h+u)/2,n=o>e?1:0;r|=n<<29-(t+5*l),h=(1-n)*h+n*e,u=(1-n)*e+n*u}for(let t=0;t<5;t++){const o=(s+c)/2,n=e>o?1:0;a|=n<<29-(t+5*l),s=(1-n)*s+n*o,c=(1-n)*o+n*c}}t.geohashX=r,t.geohashY=a}function T(t,e,o,n,r){r%2&&(r+=1);let a=0,s=0,c=-90,h=90,u=-180,l=180;for(let i=0;i<r/2;i++){for(let t=0;t<5;t++){const e=(u+l)/2,o=n>e?1:0;a|=o<<29-(t+5*i),u=(1-o)*u+o*e,l=(1-o)*e+o*l}for(let t=0;t<5;t++){const e=(c+h)/2,n=o>e?1:0;s|=n<<29-(t+5*i),c=(1-n)*c+n*e,h=(1-n)*e+n*h}}t[2*e]=a,t[2*e+1]=s}function k(t,e,o){let n="";const r=j(y,-90,90),a=j(m,-180,180);for(let s=0;s<o;s++){let o=0;!(s%2)?(o|=W(a,e)<<4,o|=W(r,t)<<3,o|=W(a,e)<<2,o|=W(r,t)<<1,o|=W(a,e)<<0):(o|=W(r,t)<<4,o|=W(a,e)<<3,o|=W(r,t)<<2,o|=W(a,e)<<1,o|=W(r,t)<<0),n+=b(o)}return n}function E(t,e,o){return o?t&g|(e&g)<<1|(t&d)<<1|(e&d)<<2|(t&f)<<2:e&g|(t&g)<<1|(e&d)<<1|(t&d)<<2|(e&f)<<2}function F(t,e){return e?g&t|(f&t)>>1|(l&t)>>2:(d&t)>>1|(i&t)>>2}function z(t,e){return e?(d&t)>>1|(i&t)>>2:g&t|(f&t)>>1|(l&t)>>2}function O(t,e,o){const n=!((t.length-1)%2),r=t.substring(0,t.length-1),a=Y(t.charCodeAt(t.length-1));let s=0,c=0,h=0,u=0;n?(s=8,c=4,h=g&a|(f&a)>>1|(l&a)>>2,u=(d&a)>>1|(i&a)>>2):(s=4,c=8,u=g&a|(f&a)>>1|(l&a)>>2,h=(d&a)>>1|(i&a)>>2);const y=h+e,m=u+o,p=Math.floor(y/s),x=Math.floor(m/c),G=b(E(y-p*s,m-x*c,n));return t.length>1&&(p||x)?O(r,p,x)+G:r+G}t.convertGeohash32ToXY=L,t.decodeBase32Char=Y,t.decodeGeohash=w,t.decodeGeohashXY=P,t.encodeBase32Char=b,t.encodeGeohash=k,t.getGeohash=X,t.getGeohashBounds=v,t.getRelativeGeohash=O,t.setGeohashBuf=T,t.setGeohashXY=R,t.unpackXBits=F,t.unpackYBits=z,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
